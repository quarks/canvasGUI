class GUI{constructor(a,b=p5.instance){this._renderer=a;this._p=b;this._is3D=!1;this._controls=new Map;this._ctrls=[];this._corners=[4,4,4,4];this._optionGroups=new Map;this._textSize=12;this._tipTextSize=10;this._panesEast=[];this._panesSouth=[];this._panesWest=[];this._panesNorth=[];this._initColorSchemes();this._initMouseEventHandlers(a)}scroller(a,b,c,d,e){return this.addControl(new GScroller(this,a,b,c,d,e))}slider(a,b,c,d,e){return this.addControl(new GSlider(this,a,b,c,d,e))}ranger(a,b,c,d,
e){return this.addControl(new GRanger(this,a,b,c,d,e))}button(a,b,c,d,e){return this.addControl(new GButton(this,a,b,c,d,e))}checkbox(a,b,c,d,e){return this.addControl(new GCheckbox(this,a,b,c,d,e))}option(a,b,c,d,e){return this.addControl(new GOption(this,a,b,c,d,e))}label(a,b,c,d,e){return this.addControl(new GLabel(this,a,b,c,d,e))}viewer(a,b,c,d,e){return this.addControl(new GViewer(this,a,b,c,d,e))}__tooltip(a){return this.addControl(new GTooltip(this,a))}pane(a,b,c){switch(b){case "north":a=
new GPaneNorth(this,a,c);break;case "south":a=new GPaneSouth(this,a,c);break;case "west":a=new GPaneWest(this,a,c);break;default:a=new GPaneEast(this,a,c)}return this.addControl(a)}getControl(a){return"string"===typeof a?this._controls.get(a):a}$(a){return"string"===typeof a?this._controls.get(a):a}addControl(a){console.assert(!this._controls.has(a._name),`Control '${a._name}' already exists and will be replaced.`);this._controls.set(a._name,a);this._ctrls=[...this._controls.values()];this._ctrls.sort((b,
c)=>b.z()-c.z());return a}listControls(){console.log("List of controls");for(let a of this._ctrls)console.log(a.name());console.log("--------------------------------------------------------------")}getOptionGroup(a){this._optionGroups.has(a)||this._optionGroups.set(a,new GOptionGroup(a));return this._optionGroups.get(a)}textSize(a){if(!Number.isFinite(a))return this._textSize;this._textSize=a;this._controls.forEach(b=>{b.invalidateBuffer()});return this}tipTextSize(a){return a?(this._tipTextSize=
a,this):this._tipTextSize}canvasWidth(){return this._renderer.width}canvasHeight(){return this._renderer.height}corners(a){Array.isArray(a)&&4==a.length&&(this._corners=Array.from(a));return Array.from(this._corners)}context(){return this._renderer}is3D(){return this._is3D}_closeAll(){for(let a of this._panesEast)a.close();for(let a of this._panesWest)a.close();for(let a of this._panesSouth)a.close();for(let a of this._panesNorth)a.close()}hideAll(){this._closeAll();for(let a of this._panesEast)a.hide();
for(let a of this._panesWest)a.hide();for(let a of this._panesSouth)a.hide();for(let a of this._panesNorth)a.hide()}showAll(){for(let a of this._panesEast)a.show();for(let a of this._panesWest)a.show();for(let a of this._panesSouth)a.show();for(let a of this._panesNorth)a.show()}validateTabsEast(){let a=this._panesEast,b=a.length,c=2*(b-1);a.forEach(e=>c+=e.tab()._w);let d=(this.canvasHeight()-c)/2;for(let e=0;e<b;e++){let f=a[e].tab(),g=-f._h,h=d;d+=f._w+2;f._x=g;f._y=h}}validateTabsWest(){let a=
this._panesWest,b=a.length,c=2*(b-1);a.forEach(f=>c+=f.tab()._w);let d=(this.canvasHeight()-c)/2;for(let f=0;f<b;f++){var e=a[f];let g=e.tab();e=e.size();let h=d;d+=g._w+2;g._x=e;g._y=h}}validateTabsSouth(){let a=this._panesSouth,b=a.length,c=2*(b-1);a.forEach(e=>c+=e.tab()._w);let d=(this.canvasWidth()-c)/2;for(let e=0;e<b;e++){let f=a[e].tab(),g=d,h=-f._h;d+=f._w+2;f._x=g;f._y=h}}validateTabsNorth(){let a=this._panesNorth,b=a.length,c=2*(b-1);a.forEach(f=>c+=f.tab()._w);let d=(this.canvasWidth()-
c)/2;for(let f=0;f<b;f++){var e=a[f];let g=e.tab(),h=d;e=e.size();d+=g._w+2;g._x=h;g._y=e}}_initColorSchemes(){this._schemes=[];this._schemes.blue=Object.assign(Object.assign({},GUI._baseScheme),GUI._blueScheme);this._schemes.green=Object.assign(Object.assign({},GUI._baseScheme),GUI._greenScheme);this._schemes.red=Object.assign(Object.assign({},GUI._baseScheme),GUI._redScheme);this._schemes.cyan=Object.assign(Object.assign({},GUI._baseScheme),GUI._cyanScheme);this._schemes.yellow=Object.assign(Object.assign({},
GUI._baseScheme),GUI._yellowScheme);this._schemes.purple=Object.assign(Object.assign({},GUI._baseScheme),GUI._purpleScheme);this._schemes.orange=Object.assign(Object.assign({},GUI._baseScheme),GUI._orangeScheme);this._schemes.dark=Object.assign(Object.assign({},GUI._baseScheme),GUI._darkScheme);this._scheme=this._schemes.blue}scheme(a){if(!a)return this._scheme;this._schemes[a]?(this._scheme=this._schemes[a],this._controls.forEach(b=>{b.scheme()||b.invalidateBuffer()})):console.error(`'${a}' is not a valid color scheme`);
return this}getScheme(a){if(a&&this._schemes[a])return Object.assign({},this._schemes[a]);console.warn(`Unable to retrieve color scheme '${a}'`)}deleteScheme(a){a&&this._schemes[a]&&(this._schemes[a]=void 0,this._schemes=this._schemes.filter(Boolean));return this}addScheme(a,b){"string"!==typeof a||b||(this._schemes[a]?console.error(`Cannot add scheme '${a}' because it already exists.'`):this._schemes[a]=b);return this}_initMouseEventHandlers(a){let b=a.canvas;b.addEventListener("mousemove",c=>{this._handleMouseEvents(c)});
b.addEventListener("mousedown",c=>{this._handleMouseEvents(c)});b.addEventListener("mouseup",c=>{this._handleMouseEvents(c)});b.addEventListener("wheel",c=>{this._handleMouseEvents(c)});b.addEventListener("mouseout",c=>{this._handleMouseEvents(c)});this.draw=(this._is3D=void 0!=a.GL&&null!=a.GL)?this._drawControlsWEBGL:this._drawControlsP2D}_handleMouseEvents(a){let b=void 0;for(let c of this._ctrls)if(c.isActive()){b=c;c._handleMouse(a);break}if(void 0==b)for(let c of this._ctrls)c.isEnabled()&&
c._handleMouse(a)}draw(){}_drawControlsP2D(){this._p.push();for(let a of this._ctrls)a.getParent()||a._renderP2D();this._p.pop()}_drawControlsWEBGL(){this._p.push();let a=this._renderer,b=a.drawingContext,c=a.width,d=a.height,e=Number.MAX_VALUE;b.flush();let f=a.uMVMatrix.copy(),g=a.uPMatrix.copy();b.disable(b.DEPTH_TEST);a.resetMatrix();a._curCamera.ortho(0,c,-d,0,-e,e);for(let h of this._ctrls)h.getParent()||h._renderWEBGL();b.flush();a.uMVMatrix.set(f);a.uPMatrix.set(g);b.enable(b.DEPTH_TEST);
this._p.pop()}static get(a,b=p5.instance){GUI.announce();if(GUI._guis.has(b))return GUI._guis.get(b);a=new GUI(a,b);GUI._guis.set(b,a);return a}static announce(){GUI._announced||(console.log("================================================"),console.log("  canvasGUI (0.0.1)   \u00a9 2022 Peter Lager"),console.log("================================================"),GUI._announced=!0)}}GUI._guis=new Map;GUI._announced=!1;
GUI._baseScheme={track_back:"hsb(0, 0%, 75%)",track_border:"hsb(0, 0%, 53%)",white:"rgb(255, 255, 255)",white0:"rgba(255, 255, 255, 0.2)",white1:"rgba(255, 255, 255, 0.3)",white2:"rgba(255, 255, 255, 0.4)",white3:"rgba(255, 255, 255, 0.5)",white4:"rgba(255, 255, 255, 0.6)",white5:"rgba(255, 255, 255, 0.7)",white6:"rgba(255, 255, 255, 0.8)",white7:"rgba(255, 255, 255, 0.9)",black:"rgb(0, 0, 0)",black0:"rgba(0, 0, 0, 0.2)",black1:"rgba(0, 0, 0, 0.3)",black2:"rgba(0, 0, 0, 0.4)",black3:"rgba(0, 0, 0, 0.5)",
black4:"rgba(0, 0, 0, 0.6)",black5:"rgba(0, 0, 0, 0.7)",black6:"rgba(0, 0, 0, 0.8)",black7:"rgba(0, 0, 0, 0.9)",dark_grey:"rgb(64, 64, 64)",mid_grey:"rgb(128, 128, 128)",light_grey:"rgb(192, 192, 192)",clear:"rgba(0, 0, 0, 0)"};
GUI._blueScheme={back:"hsb(240, 45%, 100%)",back0:"hsba(240, 45%, 100%, 0.2)",back1:"hsba(240, 45%, 100%, 0.3)",back2:"hsba(240, 45%, 100%, 0.4)",back3:"hsba(240, 45%, 100%, 0.5)",back4:"hsba(240, 45%, 100%, 0.6)",back5:"hsba(240, 45%, 100%, 0.7)",back6:"hsba(240, 45%, 100%, 0.8)",back7:"hsba(240, 45%, 100%, 0.9)",fore:"hsb(240, 100%, 66%)",thumb:"hsb(240, 45%, 85%)",track_fore:"hsb(240, 14%, 100%)",highlight:"hsb(240, 100%, 50%)",opaque:"hsb(240, 45%, 100%)",ttfore:"hsb(240, 100%, 70%)",ttback:"hsb(240, 5%, 100%)"};
GUI._greenScheme={back:"hsb(120, 45%, 90%)",back0:"hsba(120, 45%, 90%, 0.2)",back1:"hsba(120, 45%, 90%, 0.3)",back2:"hsba(120, 45%, 90%, 0.4)",back3:"hsba(120, 45%, 90%, 0.5)",back4:"hsba(120, 45%, 90%, 0.6)",back5:"hsba(120, 45%, 90%, 0.7)",back6:"hsba(120, 45%, 90%, 0.8)",back7:"hsba(120, 45%, 90%, 0.9)",fore:"hsb(120, 90%, 40%)",thumb:"hsb(120, 45%, 80%)",track_fore:"hsb(120, 14%, 100%)",highlight:"hsb(120, 100%, 50%)",opaque:"hsb(120, 45%, 100%)",ttfore:"hsb(120, 100%, 50%)",ttback:"hsb(120, 5%, 100%)"};
GUI._redScheme={back:"hsb(1, 45%, 100%)",back0:"hsba(1, 45%, 100%, 0.2)",back1:"hsba(1, 45%, 100%, 0.3)",back2:"hsba(1, 45%, 100%, 0.4)",back3:"hsba(1, 45%, 100%, 0.5)",back4:"hsba(1, 45%, 100%, 0.6)",back5:"hsba(1, 45%, 100%, 0.7)",back6:"hsba(1, 45%, 100%, 0.8)",back7:"hsba(1, 45%, 100%, 0.9)",fore:"hsb(1, 100%, 66%)",thumb:"hsb(1, 45%, 85%)",track_fore:"hsb(1, 14%, 100%)",highlight:"hsb(1, 100%, 50%)",opaque:"hsb(1, 45%, 100%)",ttfore:"hsb(1, 100%, 70%)",ttback:"hsb(1, 5%, 100%)"};
GUI._cyanScheme={back:"hsb(180, 45%, 100%)",back0:"hsba(180, 45%, 100%, 0.2)",back1:"hsba(180, 45%, 100%, 0.3)",back2:"hsba(180, 45%, 100%, 0.4)",back3:"hsba(180, 45%, 100%, 0.5)",back4:"hsba(180, 45%, 100%, 0.6)",back5:"hsba(180, 45%, 100%, 0.7)",back6:"hsba(180, 45%, 100%, 0.8)",back7:"hsba(180, 45%, 100%, 0.9)",fore:"hsb(180, 100%, 50%)",thumb:"hsb(180, 45%, 85%)",track_fore:"hsb(180, 14%, 100%)",highlight:"hsb(180, 100%, 50%)",opaque:"hsb(180, 45%, 100%)",ttfore:"hsb(180, 100%, 40%)",ttback:"hsb(180, 5%, 100%)"};
GUI._yellowScheme={back:"hsb(60, 45%, 100%)",back0:"hsba(60, 45%, 100%, 0.2)",back1:"hsba(60, 45%, 100%, 0.3)",back2:"hsba(60, 45%, 100%, 0.4)",back3:"hsba(60, 45%, 100%, 0.5)",back4:"hsba(60, 45%, 100%, 0.6)",back5:"hsba(60, 45%, 100%, 0.7)",back6:"hsba(60, 45%, 100%, 0.8)",back7:"hsba(60, 45%, 100%, 0.9)",fore:"hsb(60, 100%, 50%)",thumb:"hsb(60, 70%, 80%)",track_back:"hsb(0, 0%, 75%)",track_fore:"hsb(60, 14%, 100%)",track_border:"hsb(0, 0%, 53%)",highlight:"hsb(60, 100%, 50%)",opaque:"hsb(60, 45%, 100%)",
ttfore:"hsb(60, 100%, 40%)",ttback:"hsb(60, 5%, 100%)"};
GUI._purpleScheme={back:"hsb(300, 45%, 100%)",back0:"hsba(300, 45%, 100%, 0.2)",back1:"hsba(300, 45%, 100%, 0.3)",back2:"hsba(300, 45%, 100%, 0.4)",back3:"hsba(300, 45%, 100%, 0.5)",back4:"hsba(300, 45%, 100%, 0.6)",back5:"hsba(300, 45%, 100%, 0.7)",back6:"hsba(300, 45%, 100%, 0.8)",back7:"hsba(300, 45%, 100%, 0.9)",fore:"hsb(300, 100%, 66%)",thumb:"hsb(300, 45%, 85%)",track_fore:"hsb(300, 14%, 100%)",highlight:"hsb(300, 100%, 50%)",opaque:"hsb(300, 45%, 100%)",ttfore:"hsb(300, 100%, 80%)",ttback:"hsb(300, 5%, 100%)"};
GUI._orangeScheme={back:"hsb(30, 60%, 100%)",back0:"hsba(30, 60%, 100%, 0.2)",back1:"hsba(30, 60%, 100%, 0.3)",back2:"hsba(30, 60%, 100%, 0.4)",back3:"hsba(30, 60%, 100%, 0.5)",back4:"hsba(30, 60%, 100%, 0.6)",back5:"hsba(30, 60%, 100%, 0.7)",back6:"hsba(30, 60%, 100%, 0.8)",back7:"hsba(30, 60%, 100%, 0.9)",fore:"hsb(30, 100%, 50%)",thumb:"hsb(30, 45%, 85%)",track_fore:"hsb(30, 14%, 100%)",highlight:"hsb(30, 100%, 50%)",opaque:"hsb(30, 45%, 100%)",ttfore:"hsb(30, 100%, 80%)",ttback:"hsb(30, 5%, 100%)"};
GUI._darkScheme={back:"rgb(64, 64, 64)",fore:"rgb(224, 224, 224)",thumb:"rgb(64, 64, 64)",track_fore:"rgb(124, 124, 124)",highlight:"rgb(250, 250, 250)",opaque:"hsb(1, 45%, 100%)"};class North{_renderP2D(a,b,c,d){a.push();a.translate(0,b);a.rotate(1.5*Math.PI);a.image(d,0,0);a.pop()}_renderWEBGL(a,b,c,d){a.textureMode(a.NORMAL);a.texture(d);a.beginShape(a.TRIANGLE_STRIP);a.vertex(0,0,0,1,0);a.vertex(0,b,0,0,0);a.vertex(c,0,0,1,1);a.vertex(c,b,0,0,1);a.endShape()}xy(a,b,c,d){return{x:c-b,y:a,w:d,h:c}}wh(a,b){return{w:b,h:a}}}
class South{_renderP2D(a,b,c,d){a.push();a.translate(c,0);a.rotate(Math.PI/2);a.image(d,0,0);a.pop()}_renderWEBGL(a,b,c,d){a.textureMode(a.NORMAL);a.texture(d);a.beginShape(a.TRIANGLE_STRIP);a.vertex(0,0,0,0,1);a.vertex(0,b,0,1,1);a.vertex(c,0,0,0,0);a.vertex(c,b,0,1,0);a.endShape()}xy(a,b,c,d){return{x:b,y:d-a,w:d,h:c}}wh(a,b){return{w:b,h:a}}}
class East{_renderP2D(a,b,c,d){a.push();a.translate(0,0);a.rotate(0);a.image(d,0,0);a.pop()}_renderWEBGL(a,b,c,d){a.textureMode(a.NORMAL);a.texture(d);a.beginShape(a.TRIANGLE_STRIP);a.vertex(0,0,0,0,0);a.vertex(0,c,0,0,1);a.vertex(b,0,0,1,0);a.vertex(b,c,0,1,1);a.endShape()}xy(a,b,c,d){return{x:a,y:b,w:c,h:d}}wh(a,b){return{w:a,h:b}}}
class West{_renderP2D(a,b,c,d){a.push();a.translate(b,c);a.rotate(Math.PI);a.image(d,0,0);a.pop()}_renderWEBGL(a,b,c,d){a.textureMode(a.NORMAL);a.texture(d);a.beginShape(a.TRIANGLE_STRIP);a.vertex(0,0,0,1,1);a.vertex(0,c,0,1,0);a.vertex(b,0,0,0,1);a.vertex(b,c,0,0,0);a.endShape()}xy(a,b,c,d){return{x:c-a,y:d-b,w:c,h:d}}wh(a,b){return{w:a,h:b}}}
class GObject{constructor(a,b,c,d,e,f){this._h=this._w=this._y=this._x=0;this._gui=a;this._p=this._gui._p;this._name=b;this._x=c;this._y=d;this._w=e;this._h=f;this._children=[];this._parent=void 0;this._enabled=this._visible=!0;this._scheme=void 0;this._Z=0;this._orientation=GObject.EAST;this._dragging=!1;this._bufferInvalid=!0;this._pover=this._over=0;this._clickAllowed=!1;this._c=a.corners(void 0);this._active=!1;this._opaque=!0;this.setAction(g=>{console.warn(`No action set for control '${null===
g||void 0===g?void 0:g.source._name}`)})}name(){return this._name}getAbsXY(){if(this._parent){let a=this._parent.getAbsXY();a.x+=this._x;a.y+=this._y;return a}return{x:this._x,y:this._y}}scheme(a,b){if(a){this._scheme=this._gui.getScheme(a);this._bufferInvalid=!0;if(b)for(let c of this._children)c.scheme(a,b);return this}return this._scheme}addChild(a,b,c){a=this._gui.getControl(a);b=Number.isFinite(b)?Number(b):a._x;c=Number.isFinite(c)?Number(c):a._y;a._parent||a.leaveParent();a._x=b;a._y=c;a._parent=
this;this._children.push(a);return this}removeChild(a){a=this._gui.getControl(a);for(let b=0;b<this._children.length;b++)if(a===this._children[b]){let c=a.getAbsXY();a._x=c.x;a._y=c.y;a._parent=null;this._children[b]=void 0;break}this._children=this._children.filter(Boolean);return this}parent(a,b,c){a&&a.addChild(this,b,c);return this}leaveParent(){this._parent&&this._parent.removeChild(this);return this}getParent(){return this._parent}setAction(a){"function"===typeof a?this.action=a:console.error("The action for '$(this._name)' must be a function definition");
return this}orient(a){a=a.toString().toLowerCase();switch(a){case "north":this._orientation=GObject.NORTH;break;case "south":this._orientation=GObject.SOUTH;break;case "west":this._orientation=GObject.WEST;break;default:this._orientation=GObject.EAST}return this}isActive(){return this._active}isEnabled(){return this._enabled}enable(a){this._enabled=!0;if(a)for(let b of this._children)b.enable(a);return this}disable(a){this._enabled&&(this._enabled=!1,this._bufferInvalid=!0);if(a)for(let b of this._children)b.disable(a);
return this}show(a){this._visible=!0;if(a)for(let b of this._children)b.show(a);return this}hide(a){this._visible=!1;if(a)for(let b of this._children)b.hide(a);return this}opaque(){this._opaque=!0;return this}transparent(){this._opaque=!1;return this}shrink(a){let b=this._minControlSize();switch(a){case "w":this._w=b.w;break;case "h":this._h=b.h;break;default:this._w=b.w,this._h=b.h}this._bufferInvalid=!0;return this}_whereOver(a,b){return 0<a&&a<this._w&&0<b&&b<this._h?1:0}_minControlSize(){return null}_validateBuffer(){let a=
this._buffer;if(a.width!=this._w||a.height!=this._h)this._buffer=this._p.createGraphics(this._w,this._h),this._bufferInvalid=!0;this._bufferInvalid&&(this._updateControlVisual(),this._bufferInvalid=!1)}invalidateBuffer(){this._bufferInvalid=!0;return this}_renderWEBGL(){this._validateBuffer();let a=this._p;a.push();a.translate(this._x,this._y);this._visible&&this._orientation._renderWEBGL(a,this._w,this._h,this._buffer);for(let b of this._children)b._visible&&b._renderWEBGL();a.pop()}_renderP2D(){this._validateBuffer();
let a=this._p;a.push();a.translate(this._x,this._y);this._visible&&this._orientation._renderP2D(a,this._w,this._h,this._buffer);for(let b of this._children)b._visible&&b._renderP2D();a.pop()}_disable_hightlight(a,b,c,d,e,f){a.fill(b.black1);a.noStroke();a.rect(c,d,e,f,this._c[0],this._c[1],this._c[2],this._c[3])}_eq(a,b){return.001>Math.abs(a-b)}_neq(a,b){return.001<=Math.abs(a-b)}z(){return this._Z}x(){return this._x}y(){return this._y}w(){return this._w}h(){return this._h}over(){return this._over}pover(){return this._pover}orientation(){return this._orientation}_updateControlVisual(){}_handleMouse(a){return!0}}
GObject.NORTH=new North;GObject.SOUTH=new South;GObject.EAST=new East;GObject.WEST=new West;
class GControl extends GObject{constructor(a,b,c,d,e,f){super(a,b,c,d,e,f);this._buffer=this._p.createGraphics(this._w,this._h);this._tooltip=void 0}tooltip(a,b){a=this._gui.__tooltip(this._name+".tooltip").text(a).showTime(b||1600).shrink();this.addChild(a);a instanceof GTooltip&&(a._validatePosition(),this._tooltip=a);return this}tipTextSize(a){this._tooltip&&a&&0<a&&this._tooltip.textSize(a);return this}}
class GSlider extends GControl{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||100,f||20);this._t01=.5;this._limit0=0;this._limit1=1;this._minorTicks=this._majorTicks=0;this._opaque=this._s2ticks=!1}limits(a,b){Number.isFinite(a)&&Number.isFinite(b)&&(this._limit0=a,this._limit1=b);return this}ticks(a,b,c){this._majorTicks=a;this._minorTicks=b;this._s2ticks=!!c;return this}value(a){return Number.isFinite(a)&&0>=(a-this._limit0)*(a-this._limit1)?(this._bufferInvalid=!0,this._t01=this._norm01(a),this):
this._t2v(this._t01)}_t2v(a){return this._limit0+a*(this._limit1-this._limit0)}_v2t(a){return(a-this._limit0)/(this._limit1-this._limit0)}_norm01(a,b=this._limit0,c=this._limit1){return this._p.constrain(this._p.map(a,b,c,0,1),0,1)}_whereOver(a,b){let c=this._buffer.height/2;return 8>=Math.abs(this._t01*(this._buffer.width-20)-(a-10))&&8>=Math.abs(b-c)?1:0}_handleMouse(a){let b=!1;var c=this.getAbsXY(),d=this._p.mouseX-c.x;c=this._p.mouseY-c.y;c=this._orientation.xy(d,c,this._w,this._h);d=c.x;c=c.y;
this._pover=this._over;this._over=this._whereOver(d,c);this._bufferInvalid=this._bufferInvalid||this._pover!=this._over;this._tooltip&&this._tooltip._updateState(this._pover,this._over);switch(a.type){case "mousedown":0<this._over&&(this._bufferInvalid=this._active=!0);break;case "mouseout":case "mouseup":this._active&&(this.action({source:this,p5Event:a,value:this.value(),final:!0}),this._active=!1,b=this._bufferInvalid=!0);break;case "mousemove":this._active&&(d=this._norm01(d-10,0,this._buffer.width-
20),this._s2ticks&&(d=this._nearestTickT(d)),this._t01!=d&&(this._t01=d,this.action({source:this,p5Event:a,value:this.value(),final:!1})),this._bufferInvalid=!0)}return b}_nearestTickT(a){let b=0<this._minorTicks?this._minorTicks*this._majorTicks:this._majorTicks;return 0<b?Math.round(a*b)/b:a}_updateControlVisual(){let a=this._buffer,b=this._scheme||this._gui.scheme();var c=a.width-20;a.push();a.clear();this._opaque&&(a.noStroke(),a.fill(b.back7),a.rect(0,0,this._w,this._h,this._c[0],this._c[1],
this._c[2],this._c[3]));a.translate(10,a.height/2);a.stroke(b.track_border);a.strokeWeight(1);let d,e;d=this._majorTicks*this._minorTicks;if(2<=d){e=c/d;for(var f=0;f<=d;f++){var g=f*e;a.line(g,-7,g,7)}}d=this._majorTicks;if(2<=d)for(e=c/d,f=0;f<=d;f++)g=f*e,a.line(g,-10,g,10);a.fill(b.track_back);a.rect(0,-4,c,8);c*=this._t01;a.fill(b.track_fore);a.rect(0,-4,c,8,this._c[0],this._c[1],this._c[2],this._c[3]);a.fill(b.thumb);a.noStroke();if(this._active||0<this._over)a.strokeWeight(2),a.stroke(b.highlight);
a.rect(c-6,-6,12,12,this._c[0],this._c[1],this._c[2],this._c[3]);this._enabled||this._disable_hightlight(a,b,0,-this._h/2,this._w-20,this._h);a.pop();a.updatePixels();this._bufferInvalid=!1}_minControlSize(){return{w:this._w,h:20}}}
class GRanger extends GSlider{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||100,f||20);this._t=[.25,.75];this._tIdx=-1;this._limit0=0;this._limit1=1;this._opaque=!1}range(a,b){if(!a||!b)return{low:Math.min(a,b),high:Math.max(a,b)};a=this._norm01(a);b=this._norm01(b);this._bufferInvalid=this._t[0]!=a||this._t[1]!=b;this._t[0]=Math.min(a,b);this._t[1]=Math.max(a,b);return this}value(a){console.warn("Ranger controls require 2 values - use range(v0, v1) instead")}_whereOver(a,b){if(8>=Math.abs(b-this._buffer.height/
2)){b=this._buffer.width-20;let c=this._t;a-=10;if(8>=Math.abs(c[0]*b-a))return 1;if(8>=Math.abs(c[1]*b-a))return 2}return 0}_handleMouse(a){var b=!1,c=this.getAbsXY(),d=this._p.mouseX-c.x;c=this._p.mouseY-c.y;c=this._orientation.xy(d,c,this._w,this._h);d=c.x;c=c.y;this._pover=this._over;this._over=this._whereOver(d,c);this._tIdx=this._active?this._tIdx:this._over-1;this._bufferInvalid=this._bufferInvalid||this._pover!=this._over;this._tooltip&&this._tooltip._updateState(this._pover,this._over);switch(a.type){case "mousedown":0<
this._over&&(this._active=!0,this._tIdx=this._over-1,this._bufferInvalid=!0);break;case "mouseout":case "mouseup":this._active&&(b=Math.min(this._t[0],this._t[1]),d=Math.max(this._t[0],this._t[1]),this._t[0]=b,this._t[1]=d,this._tIdx=-1,this.action({source:this,p5Event:a,low:this._t2v(b),high:this._t2v(d),final:!0}),this._active=!1,b=this._bufferInvalid=!0);break;case "mousemove":this._active&&(d=this._norm01(d-10,0,this._buffer.width-20),this._s2ticks&&(d=this._nearestTickT(d)),this._t[this._tIdx]!=
d&&(this._t[this._tIdx]=d,d=Math.max(this._t[0],this._t[1]),this.action({source:this,p5Event:a,low:this._t2v(Math.min(this._t[0],this._t[1])),high:this._t2v(d),final:!1})),this._bufferInvalid=!0)}return b}_updateControlVisual(){let a=this._buffer,b=this._scheme||this._gui.scheme(),c=a.width-20;a.push();a.clear();this._opaque&&(a.noStroke(),a.fill(b.back7),a.rect(0,0,this._w,this._h,this._c[0],this._c[1],this._c[2],this._c[3]));a.translate(10,a.height/2);a.stroke(b.track_border);a.strokeWeight(1);
var d=this._majorTicks*this._minorTicks;if(2<=d){var e=c/d;for(var f=0;f<=d;f++){var g=f*e;a.line(g,-7,g,7)}}d=this._majorTicks;if(2<=d)for(e=c/this._majorTicks,f=0;f<=d;f++)g=f*e,a.line(g,-10,g,10);a.fill(b.track_back);a.rect(0,-4,c,8);d=c*Math.min(this._t[0],this._t[1]);e=c*Math.max(this._t[0],this._t[1]);a.fill(b.track_fore);a.rect(d,-4,e-d,8,this._c[0],this._c[1],this._c[2],this._c[3]);for(d=0;2>d;d++)a.fill(b.thumb),a.noStroke(),(this._active||0<this._over)&&d==this._tIdx&&(a.strokeWeight(2),
a.stroke(b.highlight)),a.rect(this._t[d]*c-6,-6,12,12,this._c[0],this._c[1],this._c[2],this._c[3]);this._enabled||this._disable_hightlight(a,b,0,-this._h/2,this._w-20,this._h);a.pop();a.updatePixels();this._bufferInvalid=!1}}
class GText extends GControl{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||80,f||16);this._lines=[];this._textSize=void 0;this._textAlign=this._p.CENTER;this._tbox={w:0,h:0};this._gap=2}text(a,b){if(void 0==a)return{text:this._text,icon:void 0};if(Array.isArray(a))this._lines=a;else{a=a.toString().split("\n");this._lines=[];for(let c of a)this._lines.push(c)}this.textAlign(b);b=this._minControlSize();this._w=Math.max(this._w,b.w);this._h=Math.max(this._h,b.h);this._bufferInvalid=!0;return this}textAlign(a){!a||
a!=this._p.LEFT&&a!=this._p.CENTER&&a!=this._p.RIGHT||(this._textAlign=a);return this}noText(){this._lines=[];this._textAlign=this._p.CENTER;this._tbox={w:0,h:0};return this}textSize(a){a=Number(a);let b=this._textSize||this._gui.textSize();if(Number.isNaN(a)||0==a)return b;a!=b&&(this._textSize=a,a=this._minControlSize(),this._w=Math.max(this._w,a.w),this._h=Math.max(this._h,a.h),this._bufferInvalid=!0);return this}_minControlSize(){let a=this._buffer,b=this._lines,c=this._textSize||this._gui.textSize(),
d=this._tbox,e=0,f=0,g=this._gap;0<b.length&&(a||this._validateBuffer(),a.textSize(c),d.w=c+b.map(h=>a.textWidth(h)).reduce((h,k)=>h>k?h:k),d.h=(b.length-1)*a.textLeading()+a.textAscent()+a.textDescent(),g+=this._gap);e+=d.w+g;f=Math.max(d.h,f)+2*g;return{w:e,h:f}}}
class GTextIcon extends GText{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||80,f||16);this._icon=void 0;this._iconAlign=this._p.LEFT}icon(a,b){if(!a)return{text:this._text,icon:this._icon};this._icon=a;!b||b!=this._p.LEFT&&b!=this._p.RIGHT||(this._iconAlign=b);a=this._minControlSize();this._w=Math.max(this._w,a.w);this._h=Math.max(this._h,a.h);this._bufferInvalid=!0;return this}noIcon(){this._icon=void 0;this._iconAlign=this._p.LEFT;this._bufferInvalid=!0;return this}_minControlSize(){let a=this._buffer,
b=this._lines,c=this._icon,d=this._textSize||this._gui.textSize(),e=this._tbox,f=0,g=0,h=this._gap;c&&(f=c.width,g=c.height,h+=this._gap);0<b.length&&(a||this._validateBuffer(),a.textSize(d),e.w=d+b.map(k=>a.textWidth(k)).reduce((k,l)=>k>l?k:l),e.h=(b.length-1)*a.textLeading()+a.textAscent()+a.textDescent(),h+=this._gap);f+=e.w+h;g=Math.max(this._tbox.h,g)+h;return{w:f,h:g}}}
class GButton extends GTextIcon{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||80,f||16)}_updateControlVisual(){var a=this._textSize||this._gui.textSize();let b=this._scheme||this._gui.scheme(),c=this._buffer;var d=this._icon,e=this._iconAlign;let f=this._textAlign,g=this._lines,h=this._gap;c.push();c.clear();this._opaque&&(c.noStroke(),c.fill(b.back),c.rect(1,1,this._w-1,this._h-1,this._c[0],this._c[1],this._c[2],this._c[3]));if(d){var k=0;switch(e){case this._p.LEFT:k=h;break;case this._p.RIGHT:k=
this._w-d.width-h}0==g.length&&(k=(this._w-d.width)/2);c.image(this._icon,k,(this._h-d.height)/2)}if(0<g.length){c.textSize(a);a=h;k=this._w-h;let l=0;d&&e==this._p.LEFT&&(a+=d.width);d&&e==this._p.RIGHT&&(k-=d.width);d=k-a;e=this._tbox.h;e=c.textAscent()+(this._h-e)/2;c.fill(b.fore);for(let m of g){switch(f){case this._p.LEFT:l=a;break;case this._p.CENTER:l=a+(d-c.textWidth(m))/2;break;case this._p.RIGHT:l=k-c.textWidth(m)-h}c.text(m,l,e);e+=c.textLeading()}}0<this._over&&(c.stroke(b.highlight),
c.strokeWeight(2),c.noFill(),c.rect(1,1,this._w-2,this._h-2,this._c[0],this._c[1],this._c[2],this._c[3]));this._enabled||this._disable_hightlight(c,b,0,0,this._w,this._h);c.pop();c.updatePixels();this._bufferInvalid=!1;this._parent instanceof GPane&&this._parent.validateTabs()}_handleMouse(a){let b=!1;var c=this.getAbsXY();let d=this._p.mouseX-c.x;c=this._p.mouseY-c.y;c=this._orientation.xy(d,c,this._w,this._h);d=c.x;c=c.y;this._pover=this._over;this._over=this._whereOver(d,c);this._bufferInvalid=
this._bufferInvalid||this._pover!=this._over;this._tooltip&&this._tooltip._updateState(this._pover,this._over);switch(a.type){case "mousedown":0<this._over&&(b=this._bufferInvalid=this._active=this._dragging=this._clickAllowed=!0);break;case "mouseout":case "mouseup":this._active&&(this._clickAllowed&&this.action({source:this,p5Event:a}),this._over=0,this._active=this._dragging=this._clickAllowed=!1,b=this._bufferInvalid=!0);break;case "mousemove":this._clickAllowed=!1}return b}}
class GCheckbox extends GText{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||80,f||18);this._selected=!1;this._textAlign=this._iconAlign=this._p.LEFT}iconAlign(a){if(!a)return this._iconAlign;if(a==this._p.LEFT||a==this._p.RIGHT)this._iconAlign=a,this._bufferInvalid=!0;return this}select(){this._selected||(this._bufferInvalid=this._selected=!0);return this}deselect(){this._selected&&(this._selected=!1,this._bufferInvalid=!0);return this}isSelected(){return this._selected}_handleMouse(a){let b=!1;
var c=this.getAbsXY();let d=this._p.mouseX-c.x;c=this._p.mouseY-c.y;c=this._orientation.xy(d,c,this._w,this._h);d=c.x;c=c.y;this._pover=this._over;this._over=this._whereOver(d,c);this._bufferInvalid=this._bufferInvalid||this._pover!=this._over;this._tooltip&&this._tooltip._updateState(this._pover,this._over);switch(a.type){case "mousedown":0<this._over&&(b=this._bufferInvalid=this._active=this._dragging=this._clickAllowed=!0);break;case "mouseout":case "mouseup":this._active&&(this._clickAllowed&&
(this._selected=!this._selected,this.action({source:this,p5Event:a,selected:this._selected})),this._over=0,this._active=this._dragging=this._clickAllowed=!1,b=this._bufferInvalid=!0);break;case "mousemove":this._clickAllowed=!1}return b}_updateControlVisual(){var a=this._textSize||this._gui.textSize();let b=this._scheme||this._gui.scheme(),c=this._buffer;var d=this._iconAlign,e=this._p.constrain(.7*Number(a),12,16);let f=this._textAlign,g=this._lines,h=this._gap;c.push();c.clear();this._opaque&&(c.noStroke(),
c.fill(b.back7),c.rect(0,0,this._w,this._h,this._c[0],this._c[1],this._c[2],this._c[3]));c.push();c.translate(d==this._p.RIGHT?this._w-h-e/2:h+e/2,c.height/2);c.stroke(b.fore);c.fill(b.white);c.strokeWeight(1.5);c.rect(-e/2,-e/2,e,e,3);this._selected&&(c.stroke(b.fore),c.strokeWeight(2.5),c.line(-.281*e,0,-.188*e,.313*e),c.line(.27*e,-.27*e,-.188*e,.313*e));c.pop();if(0<g.length){c.textSize(a);a=h;let k=this._w-h,l=0;d==this._p.LEFT&&(a+=e+h);d==this._p.RIGHT&&(k-=e+h);d=k-a;e=this._tbox.h;e=c.textAscent()+
(this._h-e)/2;c.fill(b.fore);for(let m of g){switch(f){case this._p.LEFT:l=a;break;case this._p.CENTER:l=a+(d-c.textWidth(m))/2;break;case this._p.RIGHT:l=k-c.textWidth(m)-h}c.text(m,l,e);e+=c.textLeading()}}0<this._over&&(c.stroke(b.highlight),c.strokeWeight(2),c.noFill(),c.rect(1,1,this._w-2,this._h-2,this._c[0],this._c[1],this._c[2],this._c[3]));this._enabled||this._disable_hightlight(c,b,0,0,this._w,this._h);c.pop();c.updatePixels();this._bufferInvalid=!1}_minControlSize(){let a=this._buffer,
b=this._lines,c=this._tbox,d=0;var e=0;e=this._gap;var f=this._textSize||this._gui.textSize();f=this._p.constrain(.7*Number(f),12,16);if(0<b.length){a||this._validateBuffer();let g=this._textSize||this._gui.textSize();a.textSize(g);c.w=g+b.map(h=>a.textWidth(h)).reduce((h,k)=>h>k?h:k);c.h=(b.length-1)*a.textLeading()+a.textAscent()+a.textDescent()}d+=c.w+e+f;e=Math.max(this._tbox.h,f+e)+2*e;return{w:d,h:e}}}
class GOptionGroup{constructor(a){this._name=a;this._group=new Set}add(a){if(a.isSelected())for(let b of this._group)b._deselect();this._group.add(a)}remove(a){this._group.delete(a)}_prev(){let a=void 0;for(let b of this._group)if(b.isSelected()){a=b;break}return a}}
class GOption extends GText{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||100,f||18);this._selected=!1;this._optGroup=null;this._textAlign=this._iconAlign=this._p.LEFT}iconAlign(a){if(!a)return this._iconAlign;if(a==this._p.LEFT||a==this._p.RIGHT)this._iconAlign=a,this._bufferInvalid=!0;return this}select(){var a;let b=null===(a=this._optGroup)||void 0===a?void 0:a._prev();b&&(b._selected=!1,b._bufferInvalid=!0);this._bufferInvalid=this._selected=!0;return this}_deselect(){this._selected=!1;return this}isSelected(){return this._selected}group(a){this._optGroup=
this._gui.getOptionGroup(a);this._optGroup.add(this);return this}_handleMouse(a){let b=!1;var c=this.getAbsXY();let d=this._p.mouseX-c.x;c=this._p.mouseY-c.y;c=this._orientation.xy(d,c,this._w,this._h);d=c.x;c=c.y;this._pover=this._over;this._over=this._whereOver(d,c);this._bufferInvalid=this._bufferInvalid||this._pover!=this._over;this._tooltip&&this._tooltip._updateState(this._pover,this._over);switch(a.type){case "mousedown":0<this._over&&(b=this._bufferInvalid=this._active=this._dragging=this._clickAllowed=
!0);break;case "mouseout":case "mouseup":this._active&&this._clickAllowed&&!this._selected&&this._optGroup&&(this.select(),this.action({source:this,p5Event:a,selected:!0}));this._over=0;this._active=this._dragging=this._clickAllowed=!1;b=this._bufferInvalid=!0;break;case "mousemove":this._clickAllowed=!1}return b}_updateControlVisual(){var a=this._textSize||this._gui.textSize();let b=this._scheme||this._gui.scheme(),c=this._buffer,d=this._p;var e=this._iconAlign,f=d.constrain(.7*Number(a),12,16);
let g=this._textAlign,h=this._lines,k=this._gap;c.push();c.clear();this._opaque&&(c.noStroke(),c.fill(b.back7),c.rect(0,0,this._w,this._h,this._c[0],this._c[1],this._c[2],this._c[3]));c.push();c.translate(e==d.RIGHT?this._w-k-f/2:k+f/2,c.height/2);c.stroke(b.fore);c.fill(b.white);c.strokeWeight(1.5);c.ellipse(0,0,f,f);this._selected&&(c.fill(b.fore),c.noStroke(),c.ellipse(0,0,f/2,f/2));c.pop();if(0<h.length){c.textSize(a);a=k;let l=this._w-k,m=0;e==d.LEFT&&(a+=f+k);e==d.RIGHT&&(l-=f+k);e=l-a;f=this._tbox.h;
f=c.textAscent()+(this._h-f)/2;c.fill(b.fore);for(let n of h){switch(g){case d.LEFT:m=a;break;case d.CENTER:m=a+(e-c.textWidth(n))/2;break;case d.RIGHT:m=l-c.textWidth(n)-k}c.text(n,m,f);f+=c.textLeading()}}0<this._over&&(c.stroke(b.highlight),c.strokeWeight(2),c.noFill(),c.rect(1,1,this._w-2,this._h-2,this._c[0],this._c[1],this._c[2],this._c[3]));this._enabled||this._disable_hightlight(c,b,0,0,this._w,this._h);c.pop();c.updatePixels();this._bufferInvalid=!1}_minControlSize(){let a=this._buffer,b=
this._lines,c=this._tbox,d=0;var e=0;e=this._gap;var f=this._textSize||this._gui.textSize();f=this._p.constrain(.7*Number(f),12,16);if(0<b.length){a||this._validateBuffer();let g=this._textSize||this._gui.textSize();a.textSize(g);c.w=g+b.map(h=>a.textWidth(h)).reduce((h,k)=>h>k?h:k);c.h=(b.length-1)*a.textLeading()+a.textAscent()+a.textDescent()}d+=c.w+e+f;e=Math.max(this._tbox.h,f+e)+2*e;return{w:d,h:e}}}
class GLabel extends GTextIcon{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||60,f||16)}_updateControlVisual(){var a=this._textSize||this._gui.textSize();let b=this._scheme||this._gui.scheme(),c=this._buffer,d=this._p;var e=this._icon,f=this._iconAlign;let g=this._textAlign,h=this._lines,k=this._gap;c.push();c.clear();this._opaque&&(c.noStroke(),c.fill(b.back7),c.rect(0,0,this._w,this._h,this._c[0],this._c[1],this._c[2],this._c[3]));if(e){var l=0;switch(f){case d.LEFT:l=k;break;case d.RIGHT:l=this._w-
e.width-k}0==h.length&&(l=(this._w-e.width)/2);c.image(this._icon,l,(this._h-e.height+k)/2)}if(0<h.length){c.textSize(a);a=k;l=this._w-k;let m=0;e&&f==d.LEFT&&(a+=e.width);e&&f==d.RIGHT&&(l-=e.width);e=l-a;f=this._tbox.h;f=c.textAscent()+(this._h-f)/2;c.fill(b.fore);for(let n of h){switch(g){case d.LEFT:m=a;break;case d.CENTER:m=a+(e-c.textWidth(n))/2;break;case d.RIGHT:m=l-c.textWidth(n)-k}c.text(n,m,f);f+=c.textLeading()}}c.pop();c.updatePixels();this._bufferInvalid=!1}}
class GTooltip extends GText{constructor(a,b){super(a,b);this._gap=1;this._visible=!1;this._showTime=0}text(a){if(Array.isArray(a))this._lines=a;else{a=a.toString().split("\n");this._lines=[];for(var b of a)this._lines.push(b)}b=this._minControlSize();this._w=Math.max(this._w,b.w);this._h=Math.max(this._h,b.h);this._bufferInvalid=!0;return this}showTime(a){this._showTime=a;return this}_updateState(a,b){a!=b&&0<b&&(this.show(),setTimeout(()=>{this.hide()},this._showTime))}_validatePosition(){var a=
this._parent,b=a.getAbsXY();let c=b.x;b=b.y;a=a.orientation().wh(a.w(),a.h());let d=a.h;this._x=0;this._y=-this._h;0>b+this._y&&(this._y+=this._h+d);c+this._x+this._w>this._gui.canvasWidth()&&(this._x-=this._w-a.w)}_updateControlVisual(){var a=this._textSize||this._gui.tipTextSize(),b=this._scheme||this._gui.scheme();let c=this._buffer;var d=this._lines;let e=this._gap;c.push();c.clear();c.stroke(b.ttfore);c.fill(b.ttback);c.rect(0,0,this._w-1,this._h-1);c.fill(b.ttfore).noStroke();if(0<d.length){c.textSize(a);
a=this._w-e-e;b=this._tbox.h;b=c.textAscent()+(this._h-b)/2;for(let f of d)d=e+(a-c.textWidth(f))/2,c.text(f,d,b),b+=c.textLeading()}c.pop();c.updatePixels();this._bufferInvalid=!1}_minControlSize(){let a=this._buffer,b=this._lines,c=this._textSize||this._gui.tipTextSize(),d=this._tbox,e=0,f=0,g=this._gap;0<b.length&&(a||this._validateBuffer(),a.textSize(c),d.w=c+b.map(h=>a.textWidth(h)).reduce((h,k)=>h>k?h:k),d.h=(b.length-1)*a.textLeading()+a.textAscent()+a.textDescent(),g+=this._gap);e+=d.w+g;
f=Math.max(d.h,f)+2*g;return{w:e,h:f}}}
class GScroller extends GControl{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||100,f||20);this._updateTrackInfo();this._capacity=1;this._used=.3;this._minV=this._used/2;this._maxV=1-this._used/2;this._value=.5;this._c=a.corners();this._opaque=!0;this._my1=this._my0=this._mx1=this._mx0=this._mdelta=0}_updateTrackInfo(){this._BORDER=10;this._TLENGTH=this._w-2*this._BORDER;this._THEIGHT=10}value(a){if(!Number.isFinite(a))return this._value*this._capacity;this._validateValue(a/this._capacity);return this}used(a){if(!Number.isFinite(a))return this._used*
this._capacity;a/=this._capacity;a=this._p.constrain(a,0,1);this._bufferInvalid=this._bufferInvalid||this._neq(a,this._used);this._used=a;this._minV=this._used/2;this._maxV=1-this._used/2;1<=this._used?this.hide():this.show();this._validateValue(this._value);return this}_validateValue(a){a=this._p.constrain(a,this._minV,this._maxV);a!=this._value&&(this._value=a,this.action({source:this,value:this.value(),final:!0}),this._bufferInvalid=!0)}capacity(a){if(!Number.isFinite(a))return this._capacity;
this._capacity=a;this._bufferInvalid=this._bufferInvalid||this._neq(a,this._capacity);return this}_whereOver(a,b){let c=this._h/2;return Math.abs(this._BORDER+this._value*this._TLENGTH-a)<=Math.max(this._used*this._TLENGTH,12)/2&&Math.abs(c-b)<=this._THEIGHT/2?1:0}_handleMouse(a){let b=!1;var c=this.getAbsXY(),d=this._p.mouseX-c.x;c=this._p.mouseY-c.y;c=this._orientation.xy(d,c,this._w,this._h);d=c.x;c=c.y;this._pover=this._over;this._over=this._whereOver(d,c);this._bufferInvalid=this._bufferInvalid||
this._pover!=this._over;this._tooltip&&this._tooltip._updateState(this._pover,this._over);switch(a.type){case "mousedown":0<this._over&&(this._bufferInvalid=this._active=!0,this._mdelta=d-(this._value*this._TLENGTH+this._BORDER));break;case "mouseout":case "mouseup":this._active&&(this.action({source:this,p5Event:a,value:this.value(),final:!0}),this._active=!1,b=this._bufferInvalid=!0);break;case "mousemove":this._active&&(d=(d-this._mdelta-this._BORDER)/this._TLENGTH,this._value=d=this._p.constrain(d,
this._minV,this._maxV),this.action({source:this,p5Event:a,value:this.value(),final:!1}),this._bufferInvalid=!0)}return b}_updateControlVisual(){let a=this._buffer,b=this._scheme||this._gui.scheme(),c=Math.max(this._used*this._TLENGTH,12),d=this._value*this._TLENGTH;a.push();a.clear();this._opaque&&(a.noStroke(),a.fill(b.back7),a.rect(0,0,this._w,this._h,this._c[0],this._c[1],this._c[2],this._c[3]));a.translate(this._BORDER,a.height/2);a.fill(b.track_back);a.stroke(b.track_border);a.strokeWeight(1);
a.rect(0,-this._THEIGHT/2,this._TLENGTH,this._THEIGHT);a.fill(b.thumb);a.noStroke();if(this._active||0<this._over)a.strokeWeight(2),a.stroke(b.highlight);a.rect(d-c/2,-7,c,14,this._c[0],this._c[1],this._c[2],this._c[3]);this._enabled||this._disable_hightlight(a,b,0,-this._h/2,this._w-20,this._h);a.pop();a.updatePixels();this._bufferInvalid=!1}_minControlSize(){return{w:this._w,h:20}}}
class GViewer extends GControl{constructor(a,b,c,d,e,f){super(a,b,c,d,e,f);this._layers=[];this._hidden=new Set;this._usedY=this._usedX=this._wscale=this._wcy=this._wcx=this._lh=this._lw=0;this._o={valid:!1};this._scrH=a.scroller(this._name+"-scrH",0,f,e,20).setAction(g=>{this.view(g.value,this._wcy);this._bufferInvalid=!0});this._scrV=a.scroller(this._name+"-scrV",e,0,f,20).orient("south").setAction(g=>{this.view(this._wcx,g.value);this._bufferInvalid=!0});this.addChild(this._scrH);this.addChild(this._scrV)}scale(a,
b,c){if(!a&&!b&&!c)return this._wscale;isFinite(b)&&isFinite(c)&&(this._scaler||(this._scaler=this._gui.slider(this._name+"-scaler",.25*this._w,.5*this._h-10,.5*this._w,20).hide().limits(b,c).value((b+c)/2).setAction(d=>{this.scale(d.value);this._bufferInvalid=!0}),this.addChild(this._scaler)),this._scaler.limits(Math.min(b,c),Math.max(b,c)));isFinite(a)&&(this._scaler&&this._scaler.value(a),this._wscale=a,this.view(this._wcx,this._wcy,this._wscales));this._bufferInvalid=!0;return this}status(){return{cX:this._wcx,
cY:this._wcy,scale:this._wscale}}hide(){return super.hide(!0)}show(){return super.show(!0)}hideLayer(a){Number.isInteger(a)&&0<=a&&a<this._layers.length&&!this._hidden.has(a)&&(this._hidden.add(a),this._bufferInvalid=!0);return this}showLayer(a){Number.isInteger(a)&&0<=a&&a<this._layers.length&&this._hidden.has(a)&&(this._hidden.delete(a),this._bufferInvalid=!0);return this}view(a,b,c){if(Number.isFinite(a)&&Number.isFinite(b)){if(this._neq(this._wcx,a)||this._neq(this._wcy,b))this._wcx=a,this._wcy=
b,this._scrH.value(a),this._scrV.value(b),this._bufferInvalid=!0;this._neq(this._wscale,c)&&(this._wscale=c,this._scaler&&this._scaler.value(c),this._bufferInvalid=!0);this.action({source:this,p5Event:void 0,cX:this._wcx,cY:this._wcy,scale:this._wscale})}return this}layers(a){Array.isArray(a)?this._layers=Array.from(a):this._layers[0]=a;a=this._lw=this._layers[0].width;let b=this._lh=this._layers[0].height;for(let c=1;c<this._layers[c];c++){let d=this._layers[c];d.width==a&&d.height==b||d.resize(a,
b)}this._scrH.capacity(a);this._scrV.capacity(b);this._bufferInvalid=!0;return this}_overScaler(){return!!(this._scaler&&0<this._scaler.over())}_handleMouse(a){var b=this.getAbsXY();let c=this._p.mouseX-b.x;b=this._p.mouseY-b.y;this._pover=this._over;this._over=this._whereOver(c,b);this._bufferInvalid=this._bufferInvalid||this._pover!=this._over;this._tooltip&&this._tooltip._updateState(this._pover,this._over);this._scaler&&(1<this._over?this._scaler.show():this._scaler.hide());switch(a.type){case "mousedown":0<
this._over&&!this._overScaler()&&(this._clickAllowed=!1,this._bufferInvalid=this._active=this._dragging=!0,this._mx0=this._pmx=c,this._my0=this._pmy=b,this._dcx=this._wcx,this._dcy=this._wcy);break;case "mouseout":this._active&&(this._over=0,this._active=this._dragging=this._clickAllowed=!1,this._bufferInvalid=!0);case "mouseup":this._active&&(this._active=this._dragging=!1,this._bufferInvalid=!0);break;case "mousemove":this._active&&this._dragging&&(this._scaler&&this._scaler.hide(),this._validateMouseDrag(this._dcx+
(this._mx0-c)/this._wscale,this._dcy+(this._my0-b)/this._wscale))}return!1}_validateMouseDrag(a,b){let c=Math.round(.5*this._w/this._wscale);var d=Math.round(.5*this._h/this._wscale);let e=this._wcx+c;var f=this._wcy+d;f=0>this._wcy-d&&f>this._lh;let g=a-c,h=a+c,k=b-d;d=b+d;0>this._wcx-c&&e>this._lw||0>g&&h>this._lw?a=this._lw/2:this._xor(0>g,h>this._lw)&&(a=0>g?a-g:a+(this._lw-h));f||0>k&&d>this._lh?b=this._lh/2:this._xor(0>k,d>this._lh)&&(b=0>k?b-k:b+(this._lh-d));this.view(a,b);this._bufferInvalid=
!0}_xor(a,b){return(a||b)&&!(a&&b)}_updateControlVisual(){let a=this._buffer;var b=this._scheme||this._gui.scheme();a.background(b.dark_grey);b=this._wscale;var c=this._wcx;let d=this._wcy,e=Math.round(.5*this._w/b),f=Math.round(.5*this._h/b);this._o=this._overlap(0,0,this._lw,this._lh,c-e,d-f,c+e,d+f);if(this._o.valid){c=this._o;let g;for(let h=0,k=this._layers.length;h<k;h++)!this._hidden.has(h)&&this._layers[h]&&(g=this._layers[h].get(c.left,c.top,c.width,c.height),.01<Math.abs(b-1)&&g.resize(Math.round(b*
c.width),Math.round(b*c.height)),a.image(g,c.offsetX*b,c.offsetY*b,g.width,g.height));this._usedX=g.width/b;this._scrH.used(this._usedX);this._usedY=g.height/b;this._scrV.used(this._usedY)}}_overlap(a,b,c,d,e,f,g,h){var k=Math.min(b,d);b=Math.max(b,d);d=Math.min(a,c);c=Math.max(a,c);a=Math.min(f,h);h=Math.max(f,h);f=Math.min(e,g);g=Math.max(e,g);if(b<=a||h<=k||c<=f||g<=d)return{valid:!1};e=d<f?f:d;g=c>g?g:c;b=b>h?h:b;k=k<a?a:k;return{valid:!0,left:e,right:g,top:k,bottom:b,width:g-e,height:b-k,offsetX:e-
f,offsetY:k-a}}_whereOver(a,b){let c=this._w,d=this._h;return this._scaler&&a>.2*c&&a<.8*c&&b>.3*d&&b<.7*d?2:0<a&&a<c&&0<b&&b<d?1:0}shrink(a){console.warn("Cannot change 'shrink' a viewer");return this}orient(a){console.warn(`Cannot change orientation of a viewer to ${a}`);return this}_minControlSize(){return{w:this._w,h:this._h}}}
class GPane extends GObject{constructor(a,b,c,d,e,f){super(a,b,c,d,e,f);this._x=c;this._y=d;this._w=e;this._h=f;this._cornerRadius=5;this._status="closed";this._timer=0;this._Z=128}size(){return this._size}close(){switch(this._status){case "opening":clearInterval(this._timer);case "open":this._timer=setInterval(()=>{this._closing()},GPane._dI),this._status="closing"}return this}open(){switch(this._status){case "closing":clearInterval(this._timer);case "closed":this._gui._closeAll(),this._timer=setInterval(()=>
{this._opening()},GPane._dI),this._status="opening"}}_tabAction(a){a=a.source._parent;switch(a._status){case "open":a.close();break;case "closed":a.open()}}_renderWEBGL(){let a=this._p;a.push();a.translate(this._x,this._y);if(this._visible&&"closed"!=this._tabstate){let b=this._scheme||this._gui.scheme();a.noStroke();a.fill(b.black4);a.beginShape(a.TRIANGLE_STRIP);a.vertex(0,0);a.vertex(0,this._h);a.vertex(this._w,0);a.vertex(this._w,this._h);a.endShape()}for(let b of this._children)b._visible&&b._renderWEBGL();
a.pop()}_renderP2D(){let a=this._p;a.push();a.translate(this._x,this._y);if(this._visible&&"closed"!=this._tabstate){let b=this._scheme||this._gui.scheme();a.noStroke();a.fill(b.black4);a.rect(0,0,this._w,this._h)}for(let b of this._children)b._visible&&b._renderP2D();a.pop()}text(a,b){this.tab().text(a,b);return this}noText(){this.tab().noText();return this}icon(a,b){this.tab().icon(a,b);return this}noIcon(){this.tab().noIcon();return this}textSize(a){this.tab().textSize(a);return this}shrink(a){return this.tab().shrink()}opaque(a){console.warn("This methis is not applicable to a pane");
return this}transparent(a){console.warn("This methis is not applicable to a pane");return this}orient(a){console.warn("Cannot change orientation of a pane}");return this}tab(){return this._children[0]}enable(){this.tab().enable();return this}disable(){this.close();this.tab().disable();return this}hide(){this.close();this.tab().hide();return this}show(){this.tab().show();return this}_minControlSize(){return{w:this._w,h:this._h}}}GPane._dI=20;GPane._dC=40;GPane._dO=20;GPane._wExtra=20;
GPane._tabID=1;
class GPaneNorth extends GPane{constructor(a,b,c){super(a,b,0,-c,a.canvasWidth(),c);this._size=c;this._status="closed";b=this._tab=this._gui.button("Tab "+GPane._tabID++);b.text(b._name).setAction(this._tabAction);c=b._minControlSize();b._w=c.w+GPane._wExtra;b._c=[0,0,this._cornerRadius,this._cornerRadius];this.addChild(b);a._panesNorth.push(this);this._gui.validateTabsNorth()}_opening(){let a=this._y+GPane._dO;0<a&&(a=0,clearInterval(this._timer),this._status="open");this._y=a}_closing(){let a=this._y-
GPane._dC;a<-this._size&&(a=-this._size,clearInterval(this._timer),this._status="closed");this._y=a}validateTabs(){this._gui.validateTabsNorth();return this}}
class GPaneSouth extends GPane{constructor(a,b,c){super(a,b,0,a.canvasHeight(),a.canvasWidth(),c);this._size=c;this._status="closed";a=this._tab=this._gui.button("Tab "+GPane._tabID++);a.text(a._name).setAction(this._tabAction);b=a._minControlSize();a._w=b.w+GPane._wExtra;a._c=[this._cornerRadius,this._cornerRadius,0,0];this.addChild(a);this._gui._panesSouth.push(this);this._gui.validateTabsSouth()}_opening(){let a=this._y-GPane._dO;a<this._gui.canvasHeight()-this._size&&(a=this._gui.canvasHeight()-
this._size,clearInterval(this._timer),this._status="open");this._y=a}_closing(){let a=this._y+GPane._dC;a>this._gui.canvasHeight()&&(a=this._gui.canvasHeight(),clearInterval(this._timer),this._status="closed");this._y=a}validateTabs(){this._gui.validateTabsSouth();return this}}
class GPaneEast extends GPane{constructor(a,b,c){super(a,b,a.canvasWidth(),0,c,a.canvasHeight());this._size=c;this._status="closed";a=this._tab=this._gui.button("Tab "+GPane._tabID++);a.text(a._name).orient("north").setAction(this._tabAction);b=a._minControlSize();a._w=b.w+GPane._wExtra;a._c=[this._cornerRadius,this._cornerRadius,0,0];this.addChild(a);this._gui._panesEast.push(this);this._gui.validateTabsEast()}_opening(){let a=this._x-GPane._dO;a<this._gui.canvasWidth()-this._size&&(a=this._gui.canvasWidth()-
this._size,clearInterval(this._timer),this._status="open");this._x=a}_closing(){let a=this._x+GPane._dC;a>this._gui.canvasWidth()&&(a=this._gui.canvasWidth(),clearInterval(this._timer),this._status="closed");this._x=a}validateTabs(){this._gui.validateTabsEast();return this}}
class GPaneWest extends GPane{constructor(a,b,c){super(a,b,-c,0,c,a.canvasHeight());this._size=c;this._status="closed";a=this._tab=this._gui.button("Tab "+GPane._tabID++);a.text(a._name).orient("south").setAction(this._tabAction);b=a._minControlSize();a._w=b.w+GPane._wExtra;a._c=[this._cornerRadius,this._cornerRadius,0,0];this.addChild(a);this._gui._panesWest.push(this);this._gui.validateTabsWest()}_opening(){let a=this._x+GPane._dO;0<a&&(a=0,clearInterval(this._timer),this._status="open");this._x=
a}_closing(){let a=this._x-GPane._dC;a<-this._size&&(a=-this._size,clearInterval(this._timer),this._status="closed");this._x=a}validateTabs(){this._gui.validateTabsWest();return this}};
