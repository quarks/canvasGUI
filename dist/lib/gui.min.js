/*
 canvasGUI    (c) Peter Lager  2025
 @license MIT
 @version 2.0.0
*/
const CANVAS_GUI_VERSION="2.0.0",[CLOG,CWARN,CERROR,CASSERT,CCLEAR]=[console.log,console.warn,console.error,console.assert,console.clear],DELTA_Z=64,PANEL_Z=2048,PANE_Z=4096,TT_SHOW_TIME=1600,TT_REPEAT_TIME=1E4,FONTS=new Set("arial;verdana;tahoma;trebuchet ms;times new roman;georgia;courier new;brush script mt;impact;serif;sans-serif;monospace".split(";")),IS_VALID_FONT=function(a){return FONTS.has(a)},MEASURE_TEXT=function(a,b,c,d,e){b.push();b.textAlign("left");b.textFont(c);b.textStyle(d);b.textSize(e);
a=b.drawingContext.measureText(a);b.pop();return{left:a.actualBoundingBoxLeft,right:a.actualBoundingBoxRight,tw:a.actualBoundingBoxLeft+a.actualBoundingBoxRight,fw:a.width,ascent:a.actualBoundingBoxAscent,descent:a.actualBoundingBoxDescent}};
class GUI{constructor(a,b=p5.instance){this._keyListenersCreated=this._mouseListenersCreated=this._touchListenersCreated=!1;this._enabled=this._visible=!0;this._show_time=TT_SHOW_TIME;this._repeat_time=TT_REPEAT_TIME;this._renderer=a;this._canvas=a.canvas;this._target=document.getElementById(a.canvas.id);this._p=b;this._controls=new Map;this._ctrls=[];this._corners=[4,4,4,4];this._optionGroups=new Map;this._textSize=12;this._textFont="sans-serif";this._textStyle="normal";this._tipTextSize=10;this._COLOR_STEP=
8;this._PART_MASK=this._COLOR_STEP-1;this._COLOR_MASK=16777215^this._PART_MASK;this._NEXT_COLOR=this._COLOR_STEP;this._colorKey=new Map;this._ctrlKey=new Map;this._panesEast=[];this._panesSouth=[];this._panesWest=[];this._panesNorth=[];this._initColorSchemes();this._addFocusHandlers();this._addMouseEventHandlers();this._addTouchEventHandlers();this._activeCtrl=this._currOver=null;this._activePart=0;this._drawHud=a.GL?this._drawHudWEBGL:this._drawHudP2D;this._validateGuiBuffers();this._getCamera=1==
Number(b.VERSION.split(".")[0])?function(){return this._renderer._curCamera}:function(){return this._renderer.states.curCamera}}_validateGuiBuffers(){let a=this._p;this._hud&&this._hud.width==a.width&&this._hud.height==a.height||(this._hud=a.createGraphics(a.width,a.height),this._hud.pixelDensity(window.devicePixelRatio),this._hud.clear(),this._pickbuffer=a.createGraphics(a.width,a.height),this._pickbuffer.pixelDensity(window.devicePixelRatio),this._pickbuffer.clear())}slider(a,b,c,d,e){return this.addControl(new CvsSlider(this,
a,b,c,d,e),!0)}ranger(a,b,c,d,e){return this.addControl(new CvsRanger(this,a,b,c,d,e),!0)}button(a,b,c,d,e){return this.addControl(new CvsButton(this,a,b,c,d,e),!0)}textfield(a,b,c,d,e){this._addKeyEventHandlers();return this.addControl(new CvsTextField(this,a,b,c,d,e),!0)}checkbox(a,b,c,d,e){return this.addControl(new CvsCheckbox(this,a,b,c,d,e),!0)}option(a,b,c,d,e){return this.addControl(new CvsOption(this,a,b,c,d,e),!0)}label(a,b,c,d,e){return this.addControl(new CvsLabel(this,a,b,c,d,e),!1)}panel(a,
b,c,d,e){return this.addControl(new CvsPanel(this,a,b,c,d,e),!0)}viewer(a,b,c,d,e){return this.addControl(new CvsViewer(this,a,b,c,d,e),!0)}joystick(a,b,c,d,e){return this.addControl(new CvsJoystick(this,a,b,c,d,e),!0)}knob(a,b,c,d,e){return this.addControl(new CvsKnob(this,a,b,c,d,e),!0)}__scroller(a,b,c,d,e){return this.addControl(new CvsScroller(this,a,b,c,d,e),!0)}__tooltip(a){return this.addControl(new CvsTooltip(this,a),!1)}pane(a,b,c){c=Math.round(c);switch(b){case "north":a=new CvsPaneNorth(this,
a,c);break;case "south":a=new CvsPaneSouth(this,a,c);break;case "west":a=new CvsPaneWest(this,a,c);break;default:a=new CvsPaneEast(this,a,c)}return this.addControl(a,!1)}get isEnabled(){return this._enabled}get isVisible(){return this._visible}grid(a,b,c,d){return new GridLayout(a,b,c,d)}name(){return this._uid}show(){this._visible=!0;return this}hide(){this._visible=!1;return this}enable(){this._enabled=!0;return this}disable(){this._enabled=!1;return this}tooltipTimes(a=TT_SHOW_TIME,b=TT_REPEAT_TIME){this._show_time=
a;this._repeat_time=b;return this}_addFocusHandlers(){let a=this._canvas;a.addEventListener("focusout",b=>{this._processFocusEvent(b)});a.addEventListener("focusin",b=>{this._processFocusEvent(b)})}_addMouseEventHandlers(){if(!this._mouseListenersCreated){let a=this._canvas;a.addEventListener("mousedown",b=>{this._processMouseEvent(b)});a.addEventListener("mouseup",b=>{this._processMouseEvent(b)});a.addEventListener("mousemove",b=>{this._processMouseEvent(b)});a.addEventListener("wheel",b=>{this._processMouseEvent(b)});
a.addEventListener("mouseout",b=>{this._processMouseEvent(b)});a.addEventListener("mouseenter",b=>{this._processMouseEvent(b)});this._mouseListenersCreated=!0}}_addKeyEventHandlers(){this._keyListenersCreated||(this._target.setAttribute("tabindex","0"),this._target.focus(),this._target.addEventListener("keydown",a=>{this._processKeyEvent(a);return!1}),this._target.addEventListener("keyup",a=>{this._processKeyEvent(a);return!1}),this._keyListenersCreated=!0)}_addTouchEventHandlers(){if(!this._touchListenersCreated){let a=
this._canvas;a.addEventListener("touchstart",b=>{this._processTouchEvent(b)});a.addEventListener("touchend",b=>{this._processTouchEvent(b)});a.addEventListener("touchmove",b=>{this._processTouchEvent(b)});a.addEventListener("touchcancel",b=>{this._processTouchEvent(b)});this._touchListenersCreated=!0}}_processMouseEvent(a){if(this._visible&&this._enabled){const b=this._canvas.getBoundingClientRect();this._processEvent(a,a.clientX-b.left,a.clientY-b.top)}}_processTouchEvent(a){if(this._visible&&this._enabled){const b=
this._canvas.getBoundingClientRect(),c=a.changedTouches[0];this._processEvent(a,c.clientX-b.left,c.clientY-b.top)}}_processEvent(a,b,c){if(!(this._activeCtrl instanceof CvsTextField)){var d=this.getPicked(b,c),e=(this._currOver=d.control)&&this._currOver!=this._prevOver;this._activeCtrl?this._activeCtrl=this._activeCtrl._doEvent(a,b,c,d,e):"mousemove"==a.type||"touchmove"==a.type?(this._prevOver?._doEvent(a,b,c,d,!1),this._currOver?._doEvent(a,b,c,d,e)):this._activeCtrl=this._currOver?._doEvent(a,
b,c,d,e);this._prevOver=this._currOver}}_processKeyEvent(a){this._visible&&this._enabled&&this._activeCtrl instanceof CvsTextField&&(this._activeCtrl=this._activeCtrl._doKeyEvent(a))}_processFocusEvent(a){switch(a.type){case "focusout":console.log(`Focus out ${this._activeCtrl?.id}`);this._activeCtrl instanceof CvsTextField&&(this._activeCtrl._deactivate(),this._activeCtrl=null);break;case "focusin":console.log(`Focus in ${this._activeCtrl?.id}`)}}$(a){return"string"===typeof a?this._controls.get(a):
a}addControl(a,b=!1){CASSERT(!this._controls.has(a.id),`Control '${a.id}' already exists and will be replaced.`);this._controls.set(a.id,a);this._ctrls=[...this._controls.values()];this.setRenderOrder();b&&this.register(a);return a}setRenderOrder(){this._ctrls.sort((a,b)=>a.z-b.z)}register(a){a&&!this._ctrlKey.has(a)&&(this._ctrlKey.set(a,this._NEXT_COLOR),this._colorKey.set(this._NEXT_COLOR,a),this._NEXT_COLOR+=this._COLOR_STEP)}deregister(a){if(a&&this._ctrlKey.has(a)){let b=this._ctrlKey.get(a);
this._ctrlKey.delete(a);this._colorKey.delete(b)}}pickColor(a){if(this._ctrlKey.has(a))return a=this._ctrlKey.get(a),{r:a>>16&255,g:a>>8&255,b:a&255}}showBuffer(a,b=this._pickbuffer){var c=document.getElementById(a);c||(c=document.createElement("canvas"),c.setAttribute("id",a),document.getElementsByTagName("body")[0].append(c));c.setAttribute("width",`${b.width}`);c.setAttribute("height",`${b.height}`);c.setAttribute("padding","3px");c.style.border="2px solid #000000";if(c instanceof HTMLCanvasElement){a=
window.devicePixelRatio;let [d,e,f]=[b.canvas,b.width*a,b.height*a];b=c.getContext("2d");c=b.canvas;b.drawImage(d,0,0,e,f,0,0,c.width,c.height)}}listControls(){CLOG("--------------------   List of controls   --------------------");this._ctrls.forEach(a=>{let b=`${a.id}                               `.substring(0,15),c=`${a.constructor.name}                   `.substring(0,15),d=`Z: ${a.z}      `.substring(0,10);a=`Color key: ${this._ctrlKey.get(a)}`;CLOG(b+c+d+a)});CLOG("--------------------------------------------------------------")}getOptionGroup(a){this._optionGroups.has(a)||
this._optionGroups.set(a,new CvsOptionGroup(a));return this._optionGroups.get(a)}textSize(a){if(!Number.isFinite(a))return this._textSize;this._textSize=a;this._controls.forEach(b=>{b.invalidateBuffer()});return this}textFont(a){if(!a)return this._textFont;a instanceof p5.Font?this._textFont=a:IS_VALID_FONT(a.toLowerCase())?this._textFont=a:CWARN(`The font '${a}' was not recognized so will be ignored!`);return this}textStyle(a){if(!a)return this._textStyle;a=a.toLowerCase();switch(a){case "normal":case "bold":case "italic":case "bold italic":this._textStyle=
a;break;default:CWARN(`The text style '${a}' was not recognized so will be ignored!`)}return this}tipTextSize(a){return a?(this._tipTextSize=a,this):this._tipTextSize}canvasWidth(){return this._renderer.width}canvasHeight(){return this._renderer.height}corners(a){Array.isArray(a)&&4==a.length&&(this._corners=[...a]);return[...this._corners]}context(){return this._renderer}_closePanes(){for(let a of this._panesEast)a.close();for(let a of this._panesWest)a.close();for(let a of this._panesSouth)a.close();
for(let a of this._panesNorth)a.close()}hidePanes(){this._closePanes();for(let a of this._panesEast)a.hide();for(let a of this._panesWest)a.hide();for(let a of this._panesSouth)a.hide();for(let a of this._panesNorth)a.hide()}showPanes(){for(let a of this._panesEast)a.show();for(let a of this._panesWest)a.show();for(let a of this._panesSouth)a.show();for(let a of this._panesNorth)a.show()}validateTabsEast(){let a=this._panesEast,b=a.length,c=2*(b-1);a.forEach(e=>c+=e.tab()._w);let d=(this.canvasHeight()-
c)/2;for(let e=0;e<b;e++){let f=a[e].tab(),h=-f._h,g=d;d+=f._w+2;f._x=h;f._y=g}}validateTabsWest(){let a=this._panesWest,b=a.length,c=2*(b-1);a.forEach(f=>c+=f.tab()._w);let d=(this.canvasHeight()-c)/2;for(let f=0;f<b;f++){var e=a[f];let h=e.tab();e=e.depth();let g=d;d+=h._w+2;h._x=e;h._y=g}}validateTabsSouth(){let a=this._panesSouth,b=a.length,c=2*(b-1);a.forEach(e=>c+=e.tab()._w);let d=(this.canvasWidth()-c)/2;for(let e=0;e<b;e++){let f=a[e].tab(),h=d,g=-f._h;d+=f._w+2;f._x=h;f._y=g}}validateTabsNorth(){let a=
this._panesNorth,b=a.length,c=2*(b-1);a.forEach(f=>c+=f.tab()._w);let d=(this.canvasWidth()-c)/2;for(let f=0;f<b;f++){var e=a[f];let h=e.tab(),g=d;e=e.depth();d+=h._w+2;h._x=g;h._y=e}}_initColorSchemes(){this._schemes=[];this._schemes.blue=new BlueScheme;this._schemes.green=new GreenScheme;this._schemes.red=new RedScheme;this._schemes.cyan=new CyanScheme;this._schemes.yellow=new YellowScheme;this._schemes.purple=new PurpleScheme;this._schemes.orange=new OrangeScheme;this._schemes.light=new LightScheme;
this._schemes.dark=new DarkScheme;this._scheme=this._schemes.blue}scheme(a){if(!a)return this._scheme;this._schemes[a]?(this._scheme=this._schemes[a],this._controls.forEach(b=>{b.scheme()||b.invalidateBuffer()})):CERROR(`'${a}' is not a valid color scheme`);return this}_getScheme(a){if(a&&this._schemes[a])return Object.assign({},this._schemes[a]);CWARN(`Unable to retrieve color scheme '${a}'`)}addScheme(a,b){"string"!==typeof a||b||(this._schemes[a]?CERROR(`Cannot add scheme '${a}' because it already exists.'`):
this._schemes[a]=b);return this}draw(){this._hud.clear();this._pickbuffer.clear();if(this._visible){this._p.push();for(let a of this._ctrls)a.getParent()||a._draw(this._hud,this._pickbuffer);this._p.pop();this._drawHud()}}_drawHudP2D(){this._p.push();this._p.image(this._hud,0,0);this._p.pop()}_drawHudWEBGL(){this._p.push();let a=this._renderer,b=a.drawingContext,c=a.width,d=a.height,e=Number.MAX_VALUE;b.flush();let f=a.uMVMatrix.copy(),h=a.uPMatrix.copy();b.disable(b.DEPTH_TEST);a.resetMatrix();this._getCamera().ortho(0,
c,-d,0,-e,e);this._p.image(this._hud,0,0);b.flush();a.uMVMatrix.set(f);a.uPMatrix.set(h);b.enable(b.DEPTH_TEST);this._p.pop()}getPicked(a,b){let c=this._pickbuffer,d={control:null,part:-1};0<=a&&a<c.width&&0<=b&&b<c.height&&(a=c.get().get(a,b),a=(a[0]<<16)+(a[1]<<8)+a[2],d.control=this._colorKey.get(a&this._COLOR_MASK),d.part=a&this._PART_MASK);return d}static ANNOUNCE_CANVAS_GUI(){0==GUI._guis.size&&(CLOG("================================================"),CLOG(`  canvasGUI (${CANVAS_GUI_VERSION})   \u00A9 2025 Peter Lager`),
CLOG("================================================"))}static create(a,b,c=p5.instance){GUI.ANNOUNCE_CANVAS_GUI();if(GUI._guis.has(a))return CWARN(`You already have a  GUI called '${a} it will not be replaced`),GUI._guis.get(a);b=new GUI(b,c);GUI._guis.set(a,b);return b}static $$(a){return GUI._guis.get(a)}}GUI.VERSION="2.0.0";GUI._guis=new Map;const createGUI=function(a,b,c=p5.instance){return GUI.create(a,b,c)},getGUI=function(a){return GUI.$$(a)};
class BaseScheme{constructor(){this._greyTints()}_color(a){this.C_0=`hsb(${a}, 10%, 100%)`;this.C_1=`hsb(${a}, 20%, 100%)`;this.C_2=`hsb(${a}, 30%, 100%)`;this.C_3=`hsb(${a}, 40%, 100%)`;this.C_4=`hsb(${a}, 60%, 100%)`;this.C_5=`hsb(${a}, 70%, 90%)`;this.C_6=`hsb(${a}, 80%, 80%)`;this.C_7=`hsb(${a}, 90%, 75%)`;this.C_8=`hsb(${a}, 90%, 50%)`;this.C_9=`hsb(${a}, 90%, 40%)`}_mono(a,b){let c=0;for(let d=0;10>d;d++){let e=Math.floor(a+(b-a)*d/10);this[`C_${c++}`]=`rgb(${e}, ${e}, ${e})`}}_grey(a){let b=
[100,80,70,60,50,40,30,20,10,0];"dark"===a&&b.reverse();for(a=0;a<b.length;a++)this[`G_${a}`]=`hsb(0,0%,${b[a]}%)`}_greyTints(){let a=[.05,.075,.1,.25,.3,.4,.5,.6,.7];for(let b=0;b<a.length;b++)this[`T_${b}`]=`rgba(0,0,0,${a[b]})`}_whiteTints(){let a=[.25,.35,.4,.45,.5,.6,.7,.8,.9];for(let b=0;b<a.length;b++)this[`T_${b}`]=`rgba(255,255,255,${a[b]})`}}class RedScheme extends BaseScheme{constructor(){super();this._color(0);this._grey("light")}}
class OrangeScheme extends BaseScheme{constructor(){super();this._color(30);this._grey("light")}}class YellowScheme extends BaseScheme{constructor(){super();this._color(60);this._grey("light")}}class GreenScheme extends BaseScheme{constructor(){super();this._color(120);this._grey("light")}}class CyanScheme extends BaseScheme{constructor(){super();this._color(180);this._grey("light")}}class BlueScheme extends BaseScheme{constructor(){super();this._color(224);this._grey("light")}}
class PurpleScheme extends BaseScheme{constructor(){super();this._color(300);this._grey("light")}}class LightScheme extends BaseScheme{constructor(){super();this._mono(254,0);this._grey("light")}}class DarkScheme extends BaseScheme{constructor(){super();this._mono(0,254);this._grey("dark");this._whiteTints()}}class OrientNorth{getTransform(a,b){return{tx:0,ty:a,rot:1.5*Math.PI}}xy(a,b,c,d){return[c-b,a,d,c]}wh(a,b){return[b,a]}}
class OrientSouth{getTransform(a,b){return{tx:b,ty:0,rot:.5*Math.PI}}xy(a,b,c,d){return[b,d-a,d,c]}wh(a,b){return[b,a]}}class OrientEast{getTransform(a,b){return{tx:0,ty:0,rot:0}}xy(a,b,c,d){return[a,b,c,d]}wh(a,b){return[a,b]}}class OrientWest{getTransform(a,b){return{tx:a,ty:b,rot:Math.PI}}xy(a,b,c,d){return[c-a,d-b,c,d]}wh(a,b){return[a,b]}}
class CvsBaseControl{constructor(a,b,c,d,e,f){this._children=[];this._enabled=this._visible=!0;this._pover=this._over=this._h=this._w=this._y=this._x=this._z=0;this._clickAllowed=this._active=!1;this._bufferInvalid=this._opaque=!0;this.action=function(){};this._gui=a;this._p=this._gui._p;this._id=b;this._x=Math.round(c);this._y=Math.round(d);this._w=Math.round(e);this._h=Math.round(f);this._parent=void 0;this._enabled=this._visible=!0;this._scheme=void 0;this._orientation=CvsBaseControl.EAST;this._dragging=
!1;this._c=a.corners(void 0)}get x(){return this._x}set x(a){this._x=Math.round(a)}get y(){return this._y}set y(a){this._y=Math.round(a)}get z(){return this._z}set z(a){this._z=a}get w(){return this._w}set w(a){this._w=Math.round(a)}get h(){return this._h}set h(a){this._h=Math.round(a)}get id(){return this._id}get type(){return this.constructor.name.substring(3)}get isEnabled(){return this._enabled}get isVisible(){return this._visible}get isActive(){return this._active}moveTo(a,b){this.x=a;this.y=
b;return this}moveBy(a,b){this.x+=a;this.y+=b;return this}getAbsXY(){if(this._parent){let a=this._parent.getAbsXY();a.x+=this._x;a.y+=this._y;return a}return{x:this._x,y:this._y}}scheme(a,b){if(a){this._scheme=this._gui._getScheme(a);this.invalidateBuffer();if(b)for(let c of this._children)c.scheme(a,b);return this}return this._scheme}invalidateBuffer(){this._bufferInvalid=!0;return this}parent(a,b,c){a=this._gui.$(a);a.addChild(this,b,c);this.z=a.z+DELTA_Z;this._gui.setRenderOrder();return this}addChild(a,
b,c){a=this._gui.$(a);b=Number.isFinite(b)?Number(b):a.x;c=Number.isFinite(c)?Number(c):a.y;a._parent||a.leaveParent();a.x=b;a.y=c;a._parent=this;a.z=this.z+DELTA_Z;this._children.push(a);this._gui.setRenderOrder();return this}removeChild(a){a=this._gui.$(a);for(let b=0;b<this._children.length;b++)if(a===this._children[b]){let c=a.getAbsXY();a._x=c.x;a._y=c.y;a._parent=null;this._children[b]=void 0;break}this._children=this._children.filter(Boolean);this._gui.setRenderOrder();return this}leaveParent(){this._parent&&
(this._parent.removeChild(this),this.z=0);return this}getParent(){return this._parent}setAction(a){"function"===typeof a?this.action=a:console.error("The action for '$(this._id)' must be a function definition");return this}orient(a){a=a.toString().toLowerCase();switch(a){case "north":this._orientation=CvsBaseControl.NORTH;break;case "south":this._orientation=CvsBaseControl.SOUTH;break;case "west":this._orientation=CvsBaseControl.WEST;break;default:this._orientation=CvsBaseControl.EAST}return this}enable(a){this._enabled||
(this._enabled=!0,this.invalidateBuffer());if(a)for(let b of this._children)b.enable(a);return this}disable(a){this._enabled&&(this._enabled=!1,this.invalidateBuffer());if(a)for(let b of this._children)b.disable(a);return this}show(a){this._visible=!0;if(a)for(let b of this._children)b.show(a);return this}hide(a){this._visible=!1;if(a)for(let b of this._children)b.hide(a);return this}opaque(){this._opaque=!0;return this}transparent(){this._opaque=!1;return this}orientation(){return this._orientation}_minControlSize(){return null}_updateControlVisual(){}_doEvent(a,
b,c,d,e){return this}_doKeyEvent(a){return this}_draw(a,b){}_eq(a,b){return.001>Math.abs(a-b)}_neq(a,b){return.001<=Math.abs(a-b)}}CvsBaseControl.NORTH=new OrientNorth;CvsBaseControl.SOUTH=new OrientSouth;CvsBaseControl.EAST=new OrientEast;CvsBaseControl.WEST=new OrientWest;
class CvsBufferedControl extends CvsBaseControl{constructor(a,b,c,d,e,f){super(a,b,c,d,e,f);this._tooltip=void 0;this._isOver=!1;this._validateControlBuffers()}get isOver(){return this._isOver}set isOver(a){a!=this._isOver&&(this._isOver=a,this.invalidateBuffer())}_validateControlBuffers(){this._uiBfr&&this._uiBfr.width==this._w&&this._uiBfr.height==this._h||(this._uiBfr=this._p.createGraphics(this._w,this._h),this._uiBfr.pixelDensity(2),this._uiBfr.clear(),this._pkBfr=this._p.createGraphics(this._w,
this._h),this._pkBfr.pixelDensity(1),this._pkBfr.clear())}_validateBuffer(){let a=this._uiBfr;if(a.width!=this._w||a.height!=this._h)this._uiBfr=this._p.createGraphics(this._w,this._h),this.invalidateBuffer();this._bufferInvalid&&(this._updateControlVisual(),this._bufferInvalid=!1)}_updateRectControlPB(){let a=this._pkBfr;a.clear();let b=this._gui.pickColor(this);a.noStroke();a.fill(b.r,b.g,b.b);a.rect(1,1,this._w-1,this._h-1,...this._c)}_draw(a,b){this._validateBuffer();a.push();a.translate(this._x,
this._y);if(this._visible){let c=this._orientation.getTransform(this._w,this._h);a.translate(c.tx,c.ty);a.rotate(c.rot);a.image(this._uiBfr,0,0);this._enabled&&(b.drawingContext.setTransform(a.drawingContext.getTransform()),b.image(this._pkBfr,0,0))}for(let c of this._children)c._visible&&c._draw(a,b);a.pop()}_disable_hightlight(a,b,c,d,e,f){a.fill(b.T_5);a.noStroke();a.rect(c,d,e,f,...this._c)}shrink(a){let b=this._minControlSize();switch(a){case "w":this._w=b.w;break;case "h":this._h=b.h;break;
default:this._w=b.w,this._h=b.h}this._validateControlBuffers();this.invalidateBuffer();return this}corners(a){return Array.isArray(a)&&4==a.length?(this._c=[...a],this):[...this._c]}tooltip(a){a=this._gui.__tooltip(this._id+".tooltip").text(a).shrink();this.addChild(a);a instanceof CvsTooltip&&(a._validatePosition(),this._tooltip=a);return this}tipTextSize(a){this._tooltip&&a&&0<a&&this._tooltip.textSize(a);return this}}
class CvsSlider extends CvsBufferedControl{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||100,f||20);this._t01=.5;this._limit0=0;this._limit1=1;this._minorTicks=this._majorTicks=0;this._opaque=this._s2ticks=!1}limits(a,b){Number.isFinite(a)&&Number.isFinite(b)&&(this._limit0=a,this._limit1=b);return this}isInsideLimits(a){return Number.isFinite(a)&&0>=(a-this._limit0)*(a-this._limit1)}ticks(a,b,c){this._majorTicks=a;this._minorTicks=b;this._s2ticks=!!c;return this}value(a){return Number.isFinite(a)&&
0>=(a-this._limit0)*(a-this._limit1)?(this.invalidateBuffer(),this._t01=this._norm01(a),this):this._t2v(this._t01)}_t2v(a){return this._limit0+a*(this._limit1-this._limit0)}_v2t(a){return(a-this._limit0)/(this._limit1-this._limit0)}_norm01(a,b=this._limit0,c=this._limit1){return this._p.map(a,b,c,0,1,!0)}_doEvent(a,b=0,c=0,d,e){let f=this.getAbsXY();[b]=this._orientation.xy(b-f.x,c-f.y,this._w,this._h);switch(a.type){case "mousedown":case "touchstart":0==d.part&&(this.isOver=this._active=!0);break;
case "mouseout":case "mouseup":case "touchend":this.action({source:this,p5Event:a,value:this.value(),final:!0});this.isOver=this._active=!1;break;case "mousemove":case "touchmove":this.isActive&&(b=this._norm01(b-10,0,this._uiBfr.width-20),this._s2ticks&&(b=this._nearestTickT(b)),this._t01!=b&&(this._t01=b,this.action({source:this,p5Event:a,value:this.value(),final:!1}))),this.isOver=this==d.control&&0==d.part,this._tooltip?._updateState(e),this.invalidateBuffer()}return this.isActive?this:null}_nearestTickT(a){let b=
0<this._minorTicks?this._minorTicks*this._majorTicks:this._majorTicks;return 0<b?Math.round(a*b)/b:a}_updateControlVisual(){let a=this._scheme||this._gui.scheme();var b=a.C_3,c=a.G_7,d=a.G_3;const e=a.G_1,f=a.C_9,h=a.C_6;let g=this._uiBfr,l=g.width-20,q=Math.round(g.height/2);g.push();g.clear();this._opaque&&(g.noStroke(),g.fill(b),g.rect(0,0,this._w,this._h,...this._c));g.translate(10,q);g.stroke(c);g.strokeWeight(1);c=this._majorTicks*this._minorTicks;if(2<=c){b=l/c;for(var n=0;n<=c;n++){var p=
n*b;g.line(p,-7,p,7)}}c=this._majorTicks;if(2<=c)for(b=l/c,n=0;n<=c;n++)p=n*b,g.line(p,-10,p,10);g.fill(d);g.rect(0,-4,l,8);d=l*this._t01;g.fill(e);g.rect(0,-4,d,8,...this._c);g.fill(h);g.noStroke();this._isOver&&(g.strokeWeight(2),g.stroke(f));g.rect(d-6,-6,12,12,...this._c);this._enabled||this._disable_hightlight(g,a,-10,-this._h/2,this._w,this._h);this._updateSliderPickBuffer(q,l,8,d,12);g.pop();this._bufferInvalid=!1}_updateSliderPickBuffer(a,b,c,d,e){d=Math.round(d);let f=this._gui.pickColor(this),
h=this._pkBfr;h.push();h.clear();h.noStroke();h.translate(10,a);h.fill(f.r,f.g,f.b+5);h.rect(0,-c/2,b,c,...this._c);h.fill(f.r,f.g,f.b+6);h.rect(0,-c/2,d,c,...this._c);h.fill(f.r,f.g,f.b);h.rect(d-e/2,-e/2,e,e);h.pop()}_minControlSize(){return{w:this._w,h:20}}}
class CvsRanger extends CvsSlider{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||100,f||20);this._t=[.25,.75];this._tIdx=-1;this._limit0=0;this._limit1=1;this._opaque=!1}range(a,b){if(Number.isFinite(a)&&Number.isFinite(b)){let c=this._norm01(Math.min(a,b));a=this._norm01(Math.max(a,b));if(0<=c&&1>=c&&0<=a&&1>=a)return this._bufferInvalid=this._t[0]!=c||this._t[1]!=a,this._t[0]=c,this._t[1]=a,this}return{low:this._t2v(this._t[0]),high:this._t2v(this._t[1])}}low(){return this._t2v(this._t[0])}high(){return this._t2v(this._t[1])}value(a){return this}_doEvent(a,
b=0,c=0,d,e){let f=this.getAbsXY();[b]=this._orientation.xy(b-f.x,c-f.y,this._w,this._h);switch(a.type){case "mousedown":case "touchstart":if(0==d.part||1==d.part)this._active=!0,this._tIdx=d.part,this.isOver=!0;break;case "mouseout":case "mouseup":case "touchend":this.isActive&&(d=Math.min(this._t[0],this._t[1]),e=Math.max(this._t[0],this._t[1]),this._t[0]=d,this._t[1]=e,this._tIdx=-1,this.action({source:this,p5Event:a,low:this._t2v(d),high:this._t2v(e),final:!0}),this._active=!1,this.invalidateBuffer());
break;case "mousemove":case "touchmove":this.isActive&&(b=this._norm01(b-10,0,this._uiBfr.width-20),this._s2ticks&&(b=this._nearestTickT(b)),this._t[this._tIdx]!=b&&(this._t[this._tIdx]=b,b=Math.max(this._t[0],this._t[1]),this.action({source:this,p5Event:a,low:this._t2v(Math.min(this._t[0],this._t[1])),high:this._t2v(b),final:!1}))),this.isOver=this==d.control&&(0==d.part||1==d.part),this._tooltip?._updateState(e),this.invalidateBuffer()}return this.isActive?this:null}_updateControlVisual(){let a=
this._scheme||this._gui.scheme();var b=a.C_3,c=a.G_7,d=a.G_3,e=a.G_1;const f=a.C_9,h=a.C_6;let g=this._uiBfr,l=g.width-20,q=Math.round(g.height/2);g.push();g.clear();this._opaque&&(g.noStroke(),g.fill(b),g.rect(0,0,this._w,this._h,...this._c));g.translate(10,q);g.stroke(c);g.strokeWeight(1);c=this._majorTicks*this._minorTicks;if(2<=c){b=l/c;for(var n=0;n<=c;n++){var p=n*b;g.line(p,-7,p,7)}}c=this._majorTicks;if(2<=c)for(b=l/this._majorTicks,n=0;n<=c;n++)p=n*b,g.line(p,-10,p,10);g.fill(d);g.rect(0,
-4,l,8);d=l*Math.min(this._t[0],this._t[1]);b=l*Math.max(this._t[0],this._t[1]);g.fill(e);g.rect(d,-4,b-d,8,...this._c);for(e=0;2>e;e++)g.fill(h),g.noStroke(),(this.isActive||this.isOver)&&e==this._tIdx&&(g.strokeWeight(2),g.stroke(f)),g.rect(this._t[e]*l-6,-6,12,12,...this._c);this._enabled||this._disable_hightlight(g,a,-10,-this._h/2,this._w,this._h);this._updateRangerPickBuffer(q,l,8,d,b,12);g.pop();this._bufferInvalid=!1}_updateRangerPickBuffer(a,b,c,d,e,f){d=Math.round(d);e=Math.round(e);let h=
this._gui.pickColor(this),g=this._pkBfr;g.push();g.clear();g.noStroke();g.translate(10,a);g.fill(h.r,h.g,h.b+5);g.rect(0,-c/2,b,c,...this._c);g.fill(h.r,h.g,h.b+6);g.rect(d,-c/2,e-d,c,...this._c);g.fill(h.r,h.g,h.b);g.rect(d-f/2,-f/2,f,f);g.fill(h.r,h.g,h.b+1);g.rect(e-f/2,-f/2,f,f);g.pop()}}
class CvsText extends CvsBufferedControl{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||80,f||16);this._lines=[];this._textSize=void 0;this._textAlign=this._p.CENTER;this._tbox={w:0,h:0};this._gap=2}text(a,b){if(null==a||void 0==a)return this._lines.join("\n");Array.isArray(a)?this._lines=a.map(c=>c.toString()):this._lines=a.toString().split("\n").map(c=>c.toString());this.textAlign(b);a=this._minControlSize();this._w=Math.max(this._w,a.w);this._h=Math.max(this._h,a.h);this._validateControlBuffers();
this.invalidateBuffer();return this}textFont(a){if(!a)return this._gui.textFont();a instanceof p5.Font?this._textFont=a:IS_VALID_FONT(a.toLowerCase())?this._textFont=a:CWARN(`The font '${a}' is not a recognized so will be ignored!`);return this}textStyle(a){if(!a)return this._textStyle;a=a.toLowerCase();switch(a){case "normal":case "bold":case "italic":case "bold italic":this._textStyle=a;break;default:CWARN(`The text style '${a}' was not recognized so will be ignored!`)}return this}textAlign(a){!a||
a!=this._p.LEFT&&a!=this._p.CENTER&&a!=this._p.RIGHT||(this._textAlign=a,this.invalidateBuffer());return this}noText(){this._lines=[];this._tbox={w:0,h:0};this.invalidateBuffer();return this}textSize(a){let b=this._textSize||this._gui.textSize();if(!Number.isFinite(a))return b;a=Number(a);a!=b&&(this._textSize=a,a=this._minControlSize(),this._w=Math.max(this._w,a.w),this._h=Math.max(this._h,a.h),this._validateControlBuffers(),this.invalidateBuffer());return this}_minControlSize(){let a=this._uiBfr,
b=this._lines,c=this._textSize||this._gui.textSize(),d=this._tbox,e=0,f=0,h=this._gap;0<b.length&&(a||this._validateBuffer(),a.textSize(c),d.w=c+b.map(g=>a.textWidth(g)).reduce((g,l)=>g>l?g:l),d.h=(b.length-1)*a.textLeading(),h+=this._gap);e+=d.w+h;f=Math.max(d.h,f)+2*h;return{w:e,h:f}}}
class CvsTextIcon extends CvsText{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||80,f||16);this._icon=void 0;this._iconAlign=this._p.LEFT}icon(a,b){if(!a)return this._icon;this._icon=a;!b||b!=this._p.LEFT&&b!=this._p.RIGHT||(this._iconAlign=b);a=this._minControlSize();this._w=Math.max(this._w,a.w);this._h=Math.max(this._h,a.h);this._validateControlBuffers();this.invalidateBuffer();return this}iconAlign(a){!a||a!=this._p.LEFT&&a!=this._p.RIGHT||(this._iconAlign=a,a=this._minControlSize(),this._w=
Math.max(this._w,a.w),this._h=Math.max(this._h,a.h),this._validateControlBuffers(),this.invalidateBuffer());return this}noIcon(){this._icon&&(this._icon=void 0,this.invalidateBuffer());return this}_minControlSize(){let a=this._uiBfr,b=this._lines,c=this._icon,d=this._textSize||this._gui.textSize(),e=this._tbox,f=0,h=0,g=this._gap;c&&(f=c.width,h=c.height,g+=this._gap);0<b.length&&(a||this._validateBuffer(),a.textSize(d),e.w=d+b.map(l=>a.textWidth(l)).reduce((l,q)=>l>q?l:q),e.h=(b.length-1)*a.textLeading()+
a.textAscent()+a.textDescent(),g+=this._gap);f+=e.w+g;h=Math.max(this._tbox.h,h)+g;return{w:Math.ceil(f),h:Math.ceil(h)}}}
class CvsLabel extends CvsTextIcon{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||60,f||16)}tooltip(a){return this}tipTextSize(a){return this}setAction(a){return this}_updateControlVisual(){var a=this._textSize||this._gui.textSize(),b=this._textFont||this._gui.textFont(),c=this._textStyle||this._gui.textStyle(),d=this._scheme||this._gui.scheme();let e=this._p;var f=this._icon,h=this._iconAlign;let g=this._textAlign,l=this._lines,q=this._gap;const n=d.C_3;d=d.C_8;let p=this._uiBfr;p.push();p.clear();
p.textFont(b);p.textStyle(c);this._opaque&&(p.noStroke(),p.fill(n),p.rect(0,0,this._w,this._h,this._c[0],this._c[1],this._c[2],this._c[3]));if(f){b=0;switch(h){case e.LEFT:b=q;break;case e.RIGHT:b=this._w-f.width-q}0==l.length&&(b=(this._w-f.width)/2);p.image(this._icon,b,(this._h-f.height+q)/2)}if(0<l.length){p.textSize(a);a=q;b=this._w-q;c=0;f&&h==e.LEFT&&(a+=f.width);f&&h==e.RIGHT&&(b-=f.width);f=b-a;h=this._tbox.h;h=p.textAscent()+(this._h-h)/2;p.fill(d);for(let k of l){switch(g){case e.LEFT:c=
a;break;case e.CENTER:c=a+(f-p.textWidth(k))/2;break;case e.RIGHT:c=b-p.textWidth(k)-q}p.text(k,c,h);h+=p.textLeading()}}p.pop();this._bufferInvalid=!1}}
class CvsButton extends CvsTextIcon{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||80,f||16)}_updateControlVisual(){var a=this._textSize||this._gui.textSize();let b=this._scheme||this._gui.scheme();var c=this._iconAlign;let d=this._textAlign;var e=this._icon;let f=this._lines,h=this._gap;var g=b.C_3;const l=b.C_8,q=b.C_9;let n=this._uiBfr;n.push();n.clear();this._opaque&&(n.noStroke(),n.fill(g),n.rect(1,1,this._w-1,this._h-1,...this._c));if(e){g=0;switch(c){case this._p.LEFT:g=h;break;case this._p.RIGHT:g=
this._w-e.width-h}0==f.length&&(g=(this._w-e.width)/2);n.image(this._icon,g,(this._h-e.height)/2)}if(0<f.length){n.textSize(a);a=h;g=this._w-h;let p=0;e&&c==this._p.LEFT&&(a+=e.width);e&&c==this._p.RIGHT&&(g-=e.width);c=g-a;e=this._tbox.h;e=n.textAscent()+(this._h-e)/2;n.fill(l);for(let k of f){switch(d){case this._p.LEFT:p=a;break;case this._p.CENTER:p=a+(c-n.textWidth(k))/2;break;case this._p.RIGHT:p=g-n.textWidth(k)-h}n.text(k,p,e);e+=n.textLeading()}}this._isOver&&(n.stroke(q),n.strokeWeight(2),
n.noFill(),n.rect(1,1,this._w-2,this._h-2,...this._c));this._enabled||this._disable_hightlight(n,b,0,0,this._w,this._h);this._updateRectControlPB();n.pop();this._bufferInvalid=!1;this._parent instanceof CvsPane&&this._parent.validateTabs()}_doEvent(a,b,c,d,e){switch(a.type){case "mousedown":case "touchstart":this.isOver=this._clickAllowed=this._active=!0;break;case "mouseout":case "mouseup":case "touchend":this.isActive&&(this._clickAllowed&&this.action({source:this,p5Event:a}),this.isOver=this._clickAllowed=
this._active=!1);break;case "mousemove":case "touchmove":this._clickAllowed=!1,this.isOver=this==d.control,this._tooltip?._updateState(e)}return this.isActive?this:null}}
class CvsTooltip extends CvsText{constructor(a,b){super(a,b);this._gap=1;this._visible=!1}text(a){if(Array.isArray(a))this._lines=a;else{a=a.toString().split("\n");this._lines=[];for(var b of a)this._lines.push(b)}b=this._minControlSize();this._w=Math.max(this._w,b.w);this._h=Math.max(this._h,b.h);this.invalidateBuffer();return this}show(a){return this}hide(a){return this}_updateState(a){a&&!this._active&&(this._visible=this._active=!0,setTimeout(()=>{this._visible=!1},this._gui._show_time),setTimeout(()=>
{this._active=!1},this._gui._repeat_time))}_validatePosition(){let a=this._parent,{x:b,y:c}=a.getAbsXY(),[d,e]=a.orientation().wh(a.w,a.h);this._x=0;this._y=-this._h;0>c+this._y&&(this._y+=this._h+e);b+this._x+this._w>this._gui.canvasWidth()&&(this._x-=this._w-d)}_updateControlVisual(){var a=this._textSize||this._gui.tipTextSize(),b=this._parent.scheme()||this._gui.scheme(),c=this._lines;let d=this._gap;var e=b.C_3;const f=b.C_9;b=this._uiBfr;b.push();b.clear();b.stroke(f);b.fill(e);b.rect(0,0,this._w-
1,this._h-1);b.fill(f).noStroke();if(0<c.length){b.textSize(a);a=this._w-d-d;e=this._tbox.h;e=b.textAscent()+(this._h-e)/2;for(let h of c)c=d+(a-b.textWidth(h))/2,b.text(h,c,e),e+=b.textLeading()}b.pop();this._bufferInvalid=!1}_minControlSize(){let a=this._uiBfr,b=this._lines,c=this._textSize||this._gui.tipTextSize(),d=this._tbox,e=0,f=0,h=this._gap;0<b.length&&(a||this._validateBuffer(),a.textSize(c),d.w=c+b.map(g=>a.textWidth(g)).reduce((g,l)=>g>l?g:l),d.h=(b.length-1)*a.textLeading()+a.textAscent()+
a.textDescent(),h+=this._gap);e+=d.w+h;f=Math.max(d.h,f)+2*h;return{w:e,h:f}}}
class CvsScroller extends CvsBufferedControl{constructor(a,b,c=0,d=0,e=100,f=20){super(a,b,c,d,e,f);this._dvalue=this._value=.5;this._used=.1;this._s_mx=this._s_dvalue=this._s_value=.5;this._minV=this._used/2;this._maxV=1-this._used/2;this._inset=2;this._trackHeight=8;this._thumbHeight=12;this._minThumbWidth=10;this._trackWidth=e-2*this._inset;this._c=a.corners();this._opaque=!1}update(a,b){Number.isFinite(b)&&b!==this._used&&(this._used=b,this._minV=this._used/2,this._maxV=1-this._used/2,this.invalidateBuffer());
if(Number.isFinite(a)&&a!==this._value){b=a=this._p.constrain(a,0,1);let c=this._used/2;a<c?b=c:a>1-c&&(b=1-c);if(this._value!=a||this._dvalue!=b)this._value=a,this._dvalue=b,this.invalidateBuffer()}}getValue(){return this._value}getUsed(){return this._used}_doEvent(a,b=0,c=0,d,e){[b]=this._orientation.xy(b-this._x,c-this._y,this.w,this.h);let [f,h]=[this._trackWidth,this._used/2];switch(a.type){case "mousedown":case "touchstart":0==d.part&&(this._active=!0,this._s_value=this._value,this._s_mx=b,
this.isOver=!0);break;case "mouseout":case "mouseup":case "touchend":this.action({source:this,p5Event:a,value:this._value,used:this._used,final:!0});this.isOver=this._active=!1;break;case "mousemove":case "touchmove":this.isActive&&(b=this._s_value+(b-this._s_mx)/f,0<=b-h&&1>=b+h&&(this.update(b),this.action({source:this,p5Event:a,value:this._value,used:this._used,final:!1})),this.isOver=this==d.control,this.invalidateBuffer())}return this.isActive?this:null}_updateControlVisual(){let a=this._scheme||
this._gui.scheme();const b=a.C_3,c=a.G_8,d=a.G_3,e=a.C_9,f=a.C_5;let [h,g,l,q]=[this._w,this._h,this._inset,this._used],[n,p]=[this._trackWidth,this._trackHeight],k=Math.max(q*n,this._minThumbWidth),m=this._thumbHeight,t=this._dvalue*this._trackWidth,r=this._uiBfr;r.push();r.clear();this._opaque&&(r.noStroke(),r.fill(b),r.rect(0,0,h,g,...this._c));r.translate(l,this._uiBfr.height/2);r.fill(d);r.stroke(c);r.strokeWeight(1);r.rect(0,-p/2,n,p);r.fill(f);r.noStroke();if(this.isActive||this.isOver)r.strokeWeight(2),
r.stroke(e);r.rect(t-k/2,-m/2,k,m,...this._c);this._enabled||this._disable_hightlight(r,a,0,-g/2,h-20,g);this._updateScrollerPickBuffer(t-k/2,-m/2,k,m);r.pop();this._bufferInvalid=!1}_updateScrollerPickBuffer(a,b,c,d){let e=this._gui.pickColor(this),f=this._pkBfr;f.push();f.clear();f.noStroke();f.fill(e.r,e.g,e.b);f.translate(this._inset,this._pkBfr.height/2);f.rect(Math.round(a),Math.round(b),c,d);f.pop()}_minControlSize(){return{w:this._w,h:20}}}
class CvsOptionGroup{constructor(a){this._name=a;this._group=new Set}add(a){if(a.isSelected())for(let b of this._group)b._deselect();this._group.add(a)}remove(a){this._group.delete(a)}_prev(){let a=void 0;for(let b of this._group)if(b.isSelected()){a=b;break}return a}}
class CvsOption extends CvsText{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||100,f||18);this._selected=!1;this._optGroup=null;this._textAlign=this._iconAlign=this._p.LEFT}iconAlign(a){if(!a)return this._iconAlign;if(a==this._p.LEFT||a==this._p.RIGHT)this._iconAlign=a,this.invalidateBuffer();return this}select(){let a=this._optGroup?._prev();a&&(a._selected=!1,a.invalidateBuffer());this._selected=!0;this.invalidateBuffer();return this}_deselect(){this._selected=!1;return this}isSelected(){return this._selected}group(a){this._optGroup=
this._gui.getOptionGroup(a);this._optGroup.add(this);return this}_doEvent(a,b,c,d,e){switch(a.type){case "mousedown":case "touchstart":this.isOver=this._clickAllowed=this._active=!0;break;case "mouseout":case "mouseup":case "touchend":this.isActive&&this._clickAllowed&&!this._selected&&this._optGroup&&(this.select(),this.action({source:this,p5Event:a,selected:!0}));this.isOver=this._clickAllowed=this._active=!1;break;case "mousemove":case "touchmove":this._clickAllowed=!1,this.isOver=this==d.control,
this._tooltip?._updateState(e)}return this.isActive?this:null}_updateControlVisual(){var a=this._textSize||this._gui.textSize();let b=this._scheme||this._gui.scheme(),c=this._p;var d=c.constrain(.7*Number(a),12,16),e=this._iconAlign;let f=this._textAlign,h=this._lines,g=this._gap;var l=b.C_3;const q=b.C_8;var n=b.G_0;const p=b.G_9,k=b.C_9;let m=this._uiBfr;m.push();m.clear();this._opaque&&(m.noStroke(),m.fill(l),m.rect(0,0,this._w,this._h,this._c[0],this._c[1],this._c[2],this._c[3]));m.push();m.translate(e==
c.RIGHT?this._w-g-d/2:g+d/2,m.height/2);m.stroke(p);m.fill(n);m.strokeWeight(1.5);m.ellipse(0,0,d,d);this._selected&&(m.fill(p),m.noStroke(),m.ellipse(0,0,d/2,d/2));m.pop();if(0<h.length){m.textSize(a);a=g;l=this._w-g;n=0;e==c.LEFT&&(a+=d+g);e==c.RIGHT&&(l-=d+g);d=l-a;e=this._tbox.h;e=m.textAscent()+(this._h-e)/2;m.fill(q);for(let t of h){switch(f){case c.LEFT:n=a;break;case c.CENTER:n=a+(d-m.textWidth(t))/2;break;case c.RIGHT:n=l-m.textWidth(t)-g}m.text(t,n,e);e+=m.textLeading()}}this.isOver&&(m.stroke(k),
m.strokeWeight(2),m.noFill(),m.rect(1,1,this._w-2,this._h-2,this._c[0],this._c[1],this._c[2],this._c[3]));this._enabled||this._disable_hightlight(m,b,0,0,this._w,this._h);this._updateRectControlPB();m.pop();this._bufferInvalid=!1}_minControlSize(){let a=this._uiBfr,b=this._lines,c=this._tbox,d=0;var e=0;e=this._gap;var f=this._textSize||this._gui.textSize();f=this._p.constrain(.7*Number(f),12,16);if(0<b.length){a||this._validateBuffer();let h=this._textSize||this._gui.textSize();a.textSize(h);c.w=
h+b.map(g=>a.textWidth(g)).reduce((g,l)=>g>l?g:l);c.h=(b.length-1)*a.textLeading()+a.textAscent()+a.textDescent()}d+=c.w+e+f;e=Math.max(this._tbox.h,f+e)+2*e;return{w:d,h:e}}}
class CvsCheckbox extends CvsText{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||80,f||18);this._selected=!1;this._textAlign=this._iconAlign=this._p.LEFT}iconAlign(a){if(!a)return this._iconAlign;if(a==this._p.LEFT||a==this._p.RIGHT)this._iconAlign=a,this.invalidateBuffer();return this}select(){this._selected||(this._selected=!0,this.invalidateBuffer());return this}deselect(){this._selected&&(this._selected=!1,this.invalidateBuffer());return this}isSelected(){return this._selected}_doEvent(a,b,c,
d,e){switch(a.type){case "mousedown":case "touchstart":this.isOver=this._clickAllowed=this._active=!0;break;case "mouseout":case "mouseup":case "touchend":this.isActive&&this._clickAllowed&&(this._selected=!this._selected,this.action({source:this,p5Event:a,selected:this._selected}));this.isOver=this._clickAllowed=this._active=!1;break;case "mousemove":case "touchmove":this._clickAllowed=!1,this.isOver=this==d.control,this._tooltip?._updateState(e)}return this.isActive?this:null}_updateControlVisual(){var a=
this._textSize||this._gui.textSize();let b=this._scheme||this._gui.scheme(),c=this._p;var d=c.constrain(.7*Number(a),12,16),e=this._iconAlign;let f=this._textAlign,h=this._lines,g=this._gap;var l=b.C_3;const q=b.C_8;var n=b.G_0;const p=b.G_9,k=b.C_9;let m=this._uiBfr;m.push();m.clear();this._opaque&&(m.noStroke(),m.fill(l),m.rect(0,0,this._w,this._h,this._c[0],this._c[1],this._c[2],this._c[3]));m.push();m.translate(e==c.RIGHT?this._w-g-d/2:g+d/2,m.height/2);m.stroke(p);m.fill(n);m.strokeWeight(1.5);
m.rect(-d/2,-d/2,d,d,3);this._selected&&(m.strokeWeight(2.5),m.line(-.281*d,0,-.188*d,.313*d),m.line(.27*d,-.27*d,-.188*d,.313*d));m.pop();if(0<h.length){m.textSize(a);a=g;l=this._w-g;n=0;e==c.LEFT&&(a+=d+g);e==c.RIGHT&&(l-=d+g);d=l-a;e=this._tbox.h;e=m.textAscent()+(this._h-e)/2;m.fill(q);for(let t of h){switch(f){case c.LEFT:n=a;break;case c.CENTER:n=a+(d-m.textWidth(t))/2;break;case c.RIGHT:n=l-m.textWidth(t)-g}m.text(t,n,e);e+=m.textLeading()}}this._isOver&&(m.stroke(k),m.strokeWeight(2),m.noFill(),
m.rect(1,1,this._w-2,this._h-2,this._c[0],this._c[1],this._c[2],this._c[3]));this._enabled||this._disable_hightlight(m,b,0,0,this._w,this._h);this._updateRectControlPB();m.pop();this._bufferInvalid=!1}_minControlSize(){let a=this._uiBfr,b=this._lines,c=this._tbox,d=0;var e=0;e=this._gap;var f=this._textSize||this._gui.textSize();f=this._p.constrain(.7*Number(f),12,16);if(0<b.length){a||this._validateBuffer();let h=this._textSize||this._gui.textSize();a.textSize(h);c.w=h+b.map(g=>a.textWidth(g)).reduce((g,
l)=>g>l?g:l);c.h=(b.length-1)*a.textLeading()+a.textAscent()+a.textDescent()}d+=c.w+e+f;e=Math.max(this._tbox.h,f+e)+2*e;return{w:d,h:e}}}
class CvsViewer extends CvsBufferedControl{constructor(a,b,c,d,e,f){super(a,b,c,d,e,f);this._layers=[];this._hidden=new Set;this._wcy=this._wcx=this._lh=this._lw=0;this._wscale=1;this._usedY=this._usedX=0;this._scalerZone={x0:0,y0:0,x1:0,y1:0};this._frameWeight=0;this._c=[0,0,0,0];this._scrH=a.__scroller(this._id+"-scrH",4,f-24,e-28,20).hide().setAction(h=>{this.view(h.value*this._lw,this._wcy);this.invalidateBuffer()});this._scrV=a.__scroller(this._id+"-scrV",e-24,4,f-28,20).orient("south").hide().setAction(h=>
{this.view(this._wcx,h.value*this._lh);this.invalidateBuffer()});this.addChild(this._scrH);this.addChild(this._scrV)}scaler(a,b,c){if(Number.isFinite(a)&&Number.isFinite(b)&&Number.isFinite(c)){let d=Math.min(b,c);b=Math.max(b,c);a=this._p.constrain(a,d,b);if(!this._scaler){let [e,f]=[this._w,this._h];this._scaler=this._gui.slider(this._id+"-scaler",.25*e,.5*f-10,.5*e,20).hide().setAction(h=>{this._wscale=h.value;this.invalidateBuffer()});this.addChild(this._scaler);this._scalerZone={x0:.15*e,y0:.4*
f-10,x1:.85*e,y1:.6*f+10}}this._scaler.limits(d,b);this._scaler.value(a);this._wscale=a;0<this._lw&&0<this._lh&&(this._wcx=this._lw*this._scrH.getValue(),this._wcy=this._lh*this._scrV.getValue(),this.invalidateBuffer())}return this}scale(a){if(!Number.isFinite(a))return this._wscale;this._scaler&&this._scaler.value(a);this._wscale=a;this.view(this._wcx,this._wcy,this._wscale);this.invalidateBuffer();return this}status(){return{cX:this._wcx,cY:this._wcy,scale:this._wscale}}hide(){return super.hide(!0)}show(){return super.show(!0)}hideLayer(a){Number.isInteger(a)&&
0<=a&&a<this._layers.length&&!this._hidden.has(a)&&(this._hidden.add(a),this.invalidateBuffer());return this}showLayer(a){Number.isInteger(a)&&0<=a&&a<this._layers.length&&this._hidden.has(a)&&(this._hidden.delete(a),this.invalidateBuffer());return this}view(a,b,c){if(Number.isFinite(a)&&Number.isFinite(b)){if(this._neq(this._wcx,a)||this._neq(this._wcy,b))this._wcx=this._p.constrain(a,0,this._lw),this._wcy=this._p.constrain(b,0,this._lh),this._scrH.update(a/this._lw),this._scrV.update(b/this._lh),
this.invalidateBuffer();this._neq(this._wscale,c)&&(this._wscale=c,this._scaler&&this._scaler.value(c),this.invalidateBuffer());this.action({source:this,p5Event:void 0,cX:this._wcx,cY:this._wcy,scale:this._wscale})}return this}layers(a){this._layers=Array.isArray(a)?Array.from(a):[a];a=this._lw=this._layers[0].width;let b=this._lh=this._layers[0].height;for(let c=1;c<this._layers[c];c++){let d=this._layers[c];d.width==a&&d.height==b||d.resize(a,b)}this._wcx=this._scrH.getValue()*this._lw;this._wcy=
this._scrV.getValue()*this._lh;this.invalidateBuffer();return this}frame(a=0){this._frameWeight=0>a?0:a;return this}shrink(a){console.warn("Cannot 'shrink' a viewer");return this}_doEvent(a,b=0,c=0,d,e){d=this.getAbsXY();let [f,h,g,l]=this._orientation.xy(b-d.x,c-d.y,this._w,this._h);this.isOver=0<=f&&f<=g&&0<=h&&h<=l;switch(a.type){case "mousedown":case "touchstart":this._dragging=this.isOver=this._active=!0;this._mx0=this._pmx=f;this._my0=this._pmy=h;this._dcx=this._wcx;this._dcy=this._wcy;this._scrH.show();
this._scrV.show();this.invalidateBuffer();break;case "mouseout":this._scrH.hide(),this._scrV.hide();case "mouseup":case "touchend":this.action({source:this,p5Event:void 0,cX:this._wcx,cY:this._wcy,scale:this._wscale});this.isOver=this._dragging=this._active=!1;break;case "mousemove":case "touchmove":this.isOver?(this._dragging?(this._scaler?.hide(),this._validateMouseDrag(this._dcx+(this._mx0-f)/this._wscale,this._dcy+(this._my0-h)/this._wscale),this.invalidateBuffer()):this._scaler&&(a=this._scalerZone,
f>=a.x0&&f<=a.x1&&h>=a.y0&&h<=a.y1?this._scaler.show():this._scaler.hide()),this._scrH.show(),this._scrV.show()):(this._scrH.hide(),this._scrV.hide())}return this.isOver?this:null}_validateMouseDrag(a,b){let c=Math.round(.5*this._w/this._wscale);var d=Math.round(.5*this._h/this._wscale);let e=this._wcx+c;var f=this._wcy+d;f=0>this._wcy-d&&f>this._lh;let h=a-c,g=a+c,l=b-d;d=b+d;0>this._wcx-c&&e>this._lw||0>h&&g>this._lw?a=this._lw/2:this._xor(0>h,g>this._lw)&&(a=0>h?a-h:a+(this._lw-g));f||0>l&&d>this._lh?
b=this._lh/2:this._xor(0>l,d>this._lh)&&(b=0>l?b-l:b+(this._lh-d));this.view(a,b);this.invalidateBuffer()}_updateControlVisual(){var a=this._scheme||this._gui.scheme();let [b,c,d]=[this._wscale,this._wcx,this._wcy],[e,f,h,g]=[this._w,this._h,this._lw,this._lh];var l=a.C_2;a=a.C_7;let q=this._uiBfr;q.push();this._opaque?q.background(l):q.clear();l=Math.round(.5*e/b);var n=Math.round(.5*f/b);l=this._overlap(0,0,h,g,c-l,d-n,c+l,d+n);let [p,k]=[Math.round(l.offsetX*b),Math.round(l.offsetY*b)],[m,t]=[Math.round(l.width*
b),Math.round(l.height*b)];if(l.valid)for(let r=0,u=this._layers.length;r<u;r++)!this._hidden.has(r)&&this._layers[r]&&(n=this._layers[r].get(l.left,l.top,l.width,l.height),.01<Math.abs(b-1)&&n.resize(m,t),q.image(n,l.offsetX*b,l.offsetY*b,n.width,n.height));0<this._frameWeight&&(q.noFill(),q.stroke(a),q.strokeWeight(this._frameWeight),q.rect(0,0,q.width,q.height));this._updateViewerPickBuffer(p,k,m,t);q.pop()}_updateViewerPickBuffer(a,b,c,d){let e=this._gui.pickColor(this),f=this._pkBfr;f.push();
f.clear();f.noStroke();f.fill(e.r,e.g,e.b);f.rect(a,b,c,d);f.pop()}_overlap(a,b,c,d,e,f,h,g){var l=Math.min(b,d);b=Math.max(b,d);d=Math.min(a,c);c=Math.max(a,c);a=Math.min(f,g);g=Math.max(f,g);f=Math.min(e,h);h=Math.max(e,h);if(b<=a||g<=l||c<=f||h<=d)return{valid:!1};e=d<f?f:d;h=c>h?h:c;b=b>g?g:b;l=l<a?a:l;d=h-e;g=b-l;f=e-f;a=l-a;this._scrH.update(void 0,d/this._lw);this._scrV.update(void 0,g/this._lh);return{valid:!0,left:e,right:h,top:l,bottom:b,width:d,height:g,offsetX:f,offsetY:a}}_xor(a,b){return(a||
b)&&!(a&&b)}_minControlSize(){return{w:this._w,h:this._h}}orient(a){return this}tooltip(a){return this}tipTextSize(a){return this}}
class CvsTextField extends CvsText{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||80,f||16);this._nextActive=null;this._currCsrIdx=this._prevCsrIdx=this._linkOffset=0;this._cursorOn=this._textInvalid=!1;this.textAlign(this._p.LEFT);this._c=[0,0,0,0]}index(a,b){Number.isFinite(a)&&(Number.isFinite(b)&&(this._linkOffset=b),this._linkIndex=a,this._gui._links||(this._gui._links=new Map),this._gui._links.set(a,this));return this}text(a){if(!a)return this._getLine();this._textInvalid=!1;this._lines=[a.toString().replaceAll("\n",
" ")];this._validate();this.invalidateBuffer();return this}textSize(a){let b=this._textSize||this._gui.textSize();if(!Number.isFinite(a))return b;a=Number(a);a!=b&&(this._textSize=a,this.invalidateBuffer());return this}textAlign(a){return this}noText(){return this}noIndex(){Number.isFinite(this._linkIndex)&&!this._gui._links&&this._gui._links.delete(this._linkIndex);this._linkIndex=void 0;return this}isValid(){return!this._textInvalid}hasValidText(){return!this._textInvalid&&0<this._lines.length&&
0<this._lines[0].length}clearValid(){this._textInvalid&&(this._textInvalid=!1,this.invalidateBuffer());return this}validation(a){this._validation=a;return this}_validate(){if(this._validation){var a=this._getLine();a=this._validation(a);Array.isArray(a)&&0<a.length&&(this._textInvalid=!a[0],a[1]&&(this._lines[0]=a[1]))}else this._textInvalid=!1}_deactivate(){this._cursorOn=this.isOver=this._active=!1;this._validate();this._prevCsrIdx=this._currCsrIdx=this._getLine().length;this._textInvalid&&(this._prevCsrIdx=
0);this.invalidateBuffer();this._nextActive=null}_activate(a){this._cursorOn=this._active=!0;setTimeout(()=>this._flashCursor(),550);this.invalidateBuffer();this._nextActive=this}_flashCursor(){this._active?(this._cursorOn=!this._cursorOn,setTimeout(()=>this._flashCursor(),550)):this._cursorOn=!1;this.invalidateBuffer()}_activateNext(a){let b=this._gui._links,c;if(b){let d=this._linkIndex;do d+=a,c=b.get(d);while(c&&(!c.isEnabled||!c.isVisible));c?._activate();this._nextActive=c;this.invalidateBuffer()}}_getLine(){return 0<
this._lines.length?this._lines[0].toString():""}_cursorX(a,b,c){return c&&0!=c?a.textWidth(b.substring(0,c)):0}_doKeyEvent(a){this._nextActive=this;let b=this._getLine(),c=this._prevCsrIdx!=this._currCsrIdx,d=!(!this._linkIndex||c||0!=this._currCsrIdx),e=!!(this._linkIndex&&!c&&this._currCsrIdx>=b.length);if("keydown"==a.type){1==a.key.length&&(this._prevCsrIdx!=this._currCsrIdx&&(b=this._removeSelectedText(b)),b=b.substring(0,this._currCsrIdx)+a.key+b.substring(this._currCsrIdx),this._currCsrIdx++,
this._prevCsrIdx++,this._lines[0]=b,this.invalidateBuffer());switch(a.key){case "ArrowLeft":d?(this._deactivate(),this._activateNext(-1),this.action({source:this,p5Event:a,value:this._getLine(),valid:!this._textInvalid})):0<this._currCsrIdx&&(!a.shiftKey&&c?this._currCsrIdx=Math.min(this._currCsrIdx,this._prevCsrIdx):this._currCsrIdx--,a.shiftKey||(this._prevCsrIdx=this._currCsrIdx));break;case "ArrowRight":e?(this._deactivate(),this._activateNext(1),this.action({source:this,p5Event:a,value:this._getLine(),
valid:!this._textInvalid})):this._currCsrIdx<=b.length&&(!a.shiftKey&&c?this._currCsrIdx=Math.max(this._currCsrIdx,this._prevCsrIdx):this._currCsrIdx++,a.shiftKey||(this._prevCsrIdx=this._currCsrIdx));break;case "ArrowUp":c||(0!==this._linkOffset&&(this._deactivate(),this._activateNext(-this._linkOffset)),this.action({source:this,p5Event:a,value:this._getLine(),valid:!this._textInvalid}));break;case "ArrowDown":c||(0!==this._linkOffset&&(this._deactivate(),this._activateNext(this._linkOffset)),this.action({source:this,
p5Event:a,value:this._getLine(),valid:!this._textInvalid}));break;case "Enter":this._deactivate();this.action({source:this,p5Event:a,value:this._getLine(),valid:!this._textInvalid});break;case "Backspace":this._prevCsrIdx!=this._currCsrIdx?b=this._removeSelectedText(b):0<this._currCsrIdx&&(b=b.substring(0,this._currCsrIdx-1)+b.substring(this._currCsrIdx),this._currCsrIdx--,this._prevCsrIdx=this._currCsrIdx);this._lines[0]=b;break;case "Delete":this._prevCsrIdx!=this._currCsrIdx?b=this._removeSelectedText(b):
this._currCsrIdx<b.length&&(b=b.substring(0,this._currCsrIdx)+b.substring(this._currCsrIdx+1)),this._lines[0]=b}this.invalidateBuffer()}return this._nextActive}_doEvent(a,b,c,d,e){switch(a.type){case "mousedown":case "touchstart":this._activate();break;case "mousemove":case "touchmove":this.isOver=this==d.control,this._tooltip?._updateState(e),this.invalidateBuffer()}return this._nextActive}_removeSelectedText(a){let b=Math.min(this._prevCsrIdx,this._currCsrIdx),c=Math.max(this._prevCsrIdx,this._currCsrIdx);
this._prevCsrIdx=this._currCsrIdx=b;return a.substring(0,b)+a.substring(c)}_updateControlVisual(){function a(r){return r&&0!=r?MEASURE_TEXT(f.substring(0,r),k,c,d,b).fw:0}let b=Number(this._textSize||this._gui.textSize()),c=this._textFont||this._gui.textFont(),d=this._textStyle||this._gui.textStyle(),e=this._scheme||this._gui.scheme(),f=this._getLine();var h=this._textInvalid;let g=4+Math.max(this._c[0],this._c[3]);var l=this._w-(4+Math.max(this._c[1],this._c[2]));const q=e.G_9,n=e.C_9,p=e.C_3;let k=
this._uiBfr;k.clear();k.push();k.textFont(c);k.textStyle(d);k.textSize(b);var m=e.C_1;let t=e.C_9;this.isActive?k.fill(e.G_0):(m=h?e.C_9:e.C_1,t=h?e.C_3:e.C_9,k.fill(m));k.stroke(t);k.strokeWeight(2);k.rect(1,1,this._w-2,this._h-2,...this._c);k.push();k.beginClip();k.rect(g,1.5,l-g,this._h-3);k.endClip();k.fill(m);h=a(this._currCsrIdx);this.isActive&&(l=h-(l-g),0<l&&k.translate(-l,0),this._currCsrIdx!=this._prevCsrIdx&&(m=a(this._prevCsrIdx),l=g+Math.min(m,h),m=Math.abs(m-h),k.noStroke(),k.fill(p),
k.rect(l,1.5,m,this._h-3,...this._c)));k.textSize(b);k.textAlign(this._p.LEFT,this._p.TOP);k.noStroke();k.fill(t);k.text(f,g,(this._h-b)/2);this._active&&this._cursorOn&&(k.stroke(q),k.strokeWeight(1.75),k.line(g+h,4,g+h,this._h-5));k.pop();this.isOver&&(k.stroke(n),k.strokeWeight(2.5),k.noFill(),k.rect(1,1,this._w-2,this._h-2,...this._c));this._enabled||this._disable_hightlight(k,e,0,0,this._w,this._h);this._updateRectControlPB();k.pop();this._bufferInvalid=!1}}
class CvsJoystick extends CvsBufferedControl{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||40,f||40);this._size=Math.min(e,f);this._pr0=.05*this._size;this._pr1=.4*this._size;this._tSize=Math.max(.075*this._size,6);this._mode="X0";this._ang=this._mag=0;this._opaque=!1;this._tmrID=void 0}mode(a){if(!a)return this._mode;a=a.toUpperCase();switch(a){case "X0":case "X4":case "X8":this._mode!=a&&(this._mode=a,this.invalidateBuffer())}return this}thumbSize(a){this._tSize=a;return this}_getThumbXY(){return[this._mag*
Math.cos(this._ang),this._mag*Math.sin(this._ang)]}_validateThumbPosition(a,b){let c=this._p.constrain(Math.sqrt(a*a+b*b),0,this._pr1);a=Math.atan2(b,a);a+=0>a?2*Math.PI:0;b=c<=this._pr0;let d=-1,e;switch(this._mode){case "X4":e=Math.PI/2;d=Math.floor((a+e/2)/e)%4;a=e*d;d*=2;break;case "X8":e=Math.PI/4,d=Math.floor((a+e/2)/e)%8,a=e*d}[this._mag,this._ang,this._dir,this._dead]=[c,a,d,b]}_doEvent(a,b=0,c=0,d,e){function f(n,p,k){return{source:n,p5Event:p,final:k,mag:(n._mag-n._pr0)/(n._pr1-n._pr0),
angle:n._ang,dir:n._dir,dead:n._dead}}let [h,g,l,q]=this._orientation.xy(b-this._x,c-this._y,this.w,this.h);h-=l/2;g-=q/2;switch(a.type){case "mousedown":case "touchstart":this.isOver=this._active=!0;break;case "mouseout":case "mouseup":case "touchend":this._validateThumbPosition(h,g);this.action(f(this,a,!0));this._active=!1;this.invalidateBuffer();this._tmrID||(this._tmrID=setInterval(()=>{this._mag-=.07*this._size;0>=this._mag&&(clearInterval(this._tmrID),this._tmrID=void 0,this._mag=0);this.invalidateBuffer()},
25));break;case "mousemove":case "touchmove":this.isActive&&(this._validateThumbPosition(h,g),this.action(f(this,a,!1))),this.isOver=this==d.control,this._tooltip?._updateState(e),this.invalidateBuffer()}return this.isActive?this:null}_updateControlVisual(){var a=this._scheme||this._gui.scheme();let [b,c]=[this._mag*Math.cos(this._ang),this._mag*Math.sin(this._ang)];var d=a.C_3,e=a.C_1,f=a.T_0;const h=a.C_9,g=a.C_9,l=a.C_4,q=a.C_6,n=a.C_7;var p=a.C_8;a=a.T_5;let k=this._uiBfr;k.push();k.clear();this._opaque&&
(k.noStroke(),k.fill(d),k.rect(0,0,this._w,this._h,this._c[0],this._c[1],this._c[2],this._c[3]));k.translate(k.width/2,k.height/2);k.noStroke();k.fill(e);k.ellipse(0,0,2*this._pr1,2*this._pr1);d=.26*this._size;k.fill(f);k.noStroke();k.ellipse(0,0,2*d,2*d);k.ellipse(0,0,1.25*d,1.25*d);k.stroke(p);switch(this._mode){case "X0":f=this._pr1;p=Math.PI/8;k.push();k.strokeWeight(.75);d=.3*this._size;for(e=0;16>e;e++)k.line(f,0,d,0),k.rotate(p);k.pop();break;case "X8":f=this._pr0;d=.33*this._size;p=Math.PI/
4;k.push();k.strokeWeight(1);for(e=0;8>e;e++)k.line(f,0,d,0),k.rotate(p);k.pop();case "X4":f=this._pr0;d=this._pr1;p=Math.PI/2;k.push();k.strokeWeight(1.5);for(e=0;4>e;e++)k.line(f,0,d,0),k.rotate(p);k.pop()}k.stroke(h);k.strokeWeight(Math.max(3,.025*this._size));k.noFill();k.ellipse(0,0,2*this._pr1,2*this._pr1);k.fill(a);k.noStroke();k.ellipse(0,0,2*this._pr0,2*this._pr0);k.stroke(n);k.strokeWeight(.05*this._size);k.line(0,0,b,c);k.strokeWeight(2);k.stroke(g);this.isActive||this.isOver?k.fill(q):
k.fill(l);k.ellipse(b,c,2*this._tSize,2*this._tSize);this._updateJoystickPickBuffer(b,c,this._tSize);k.pop();this._bufferInvalid=!1}_updateJoystickPickBuffer(a,b,c){let d=this._gui.pickColor(this),e=this._pkBfr;e.push();e.clear();e.translate(e.width/2,e.height/2);e.noStroke();e.fill(d.r,d.g,d.b);e.ellipse(a,b,2*c,2*c);e.pop()}}
class CvsKnob extends CvsSlider{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||40,f||40);this._mode=CvsKnob.X_MODE;this._sensitivity=.005;this._size=Math.min(e,f);this._turnArc=2*Math.PI;this._gapPos=.5*Math.PI;this._tw=0;this._kRad=.5*this._size;this._gRad=this._kRad-4;this._opaque=!0}mode(a){switch(a){case "x":this._mode=CvsKnob.X_MODE;break;case "y":this._mode=CvsKnob.Y_MODE;break;case "a":this._mode=CvsKnob.A_MODE}return this}sensitivity(a){if(0!=a){let b=Math.abs(a);this._sensitivity=(0>a?-1:
1)*(.0025>b?.0025:b)}return this}track(a){a=this._p.constrain(a,6,this._kRad);this._gRad=this._kRad-a;this._tw=a;this.invalidateBuffer();return this}turnAngle(a){0<a&&360>=a&&(this._turnArc=this._p.radians(a),this.invalidateBuffer());return this}gap(a){0<=a&&360>=a&&(this._gapPos=this._p.radians(a),this.invalidateBuffer());return this}_tFromXY(a,b){function c(h){return 0>h?h+2*Math.PI:h}var d=this._t01;let e=!1,f=!1;switch(this._mode){case CvsKnob.X_MODE:d=this._t01+(a-this._prevX)*this._sensitivity;
e=0>d;f=1<d;d=this._p.constrain(d,0,1);break;case CvsKnob.Y_MODE:d=this._t01-(b-this._prevY)*this._sensitivity;e=0>d;f=1<d;d=this._p.constrain(d,0,1);break;case CvsKnob.A_MODE:d=Math.PI-this._turnArc/2;let h=2*Math.PI-d;a=c(Math.atan2(b,a));a=c(a-this._gapPos);e=a<d;f=a>h;d=this._p.map(a,d,h,0,1,!0)}return{t:d,under:e,over:f}}_doEvent(a,b=0,c=0,d,e){let [f,h,g,l]=this._orientation.xy(b-this._x,c-this._y,this.w,this.h);f-=g/2;h-=l/2;switch(a.type){case "mousedown":case "touchstart":this._prevX=f;this._prevY=
h;this.isOver=this._active=!0;this.invalidateBuffer();break;case "mouseout":case "mouseup":case "touchend":b=this._tFromXY(f,h);this._t01=this._s2ticks?this._nearestTickT(b.t):b.t;this.action({source:this,p5Event:a,value:this.value(),final:!0});this._active=!1;this.invalidateBuffer();break;case "mousemove":case "touchmove":this.isActive&&(b=this._tFromXY(f,h),b=this._s2ticks?this._nearestTickT(b.t):b.t,this._t01!=b&&(this._prevX=f,this._prevY=h,this._t01=b,this.action({source:this,p5Event:a,value:this.value(),
final:!1}))),this.isOver=this==d.control,this._tooltip?._updateState(e),this.invalidateBuffer()}return this.isActive?this:null}_updateControlVisual(){var a=this._scheme||this._gui.scheme(),b=a.C_3,c=a.C_7;const d=a.C_8,e=a.C_3,f=a.C_9;var h=a.C_3,g=a.C_1,l=a.G_8;const q=a.G_2,n=a.T_1;a=this._uiBfr;a.clear();this._opaque&&(a.noStroke(),a.fill(b),a.rect(0,0,this._w,this._h,this._c[0],this._c[1],this._c[2],this._c[3]));b=this._turnArc;var p=(2*Math.PI-b)/2;let k=this._gRad,m=2*this._kRad,t=2*k;a.push();
a.translate(a.width/2,a.height/2);a.rotate(this._gapPos+p);a.noStroke();a.fill(h);a.ellipse(0,0,m,m);a.fill(g);a.arc(0,0,m,m,0,this._turnArc);h=this._majorTicks*this._minorTicks;if(2<=h){g=this._tw;p=.65*g;a.stroke(l);l=b/h;a.push();a.strokeWeight(.9);for(let r=0;r<=h;r++)a.line(k,0,k+p,0),a.rotate(l);a.pop();h=this._majorTicks;if(2<=h){l=b/h;a.push();a.strokeWeight(1);for(p=0;p<=h;p++)a.line(k,0,k+g,0),a.rotate(l);a.pop()}a.noStroke();a.fill(n);a.arc(0,0,t+g,t+g,0,b);a.fill(q);a.arc(0,0,t+g,t+g,
0,this._t01*b)}a.stroke(d);a.strokeWeight(1.5);a.fill(c);a.ellipse(0,0,t,t);a.push();a.rotate(this._t01*b);c=.2*k;a.fill(e);a.noStroke();a.beginShape();a.vertex(-c,0);a.vertex(0,-c);a.vertex(k,0);a.vertex(0,c);a.endShape(this._p.CLOSE);a.pop();this.isOver&&(a.noFill(),a.stroke(f),a.strokeWeight(3),a.arc(0,0,2*this._kRad,2*this._kRad,0,b));this._updateKnobPickBuffer(m);a.pop();this._bufferInvalid=!1}_updateKnobPickBuffer(a){let b=this._gui.pickColor(this),c=this._pkBfr;c.push();c.clear();c.translate(c.width/
2,c.height/2);c.noStroke();c.fill(b.r,b.g,b.b);c.ellipse(0,0,a,a);c.pop()}_minControlSize(){return{w:this._size,h:this._size}}}CvsKnob.X_MODE=1;CvsKnob.Y_MODE=2;CvsKnob.A_MODE=3;
class CvsPanel extends CvsBufferedControl{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||100,f||100);this._constrainY=this._constrainX=this._canDragY=this._canDragX=!0;this._c=[0,0,0,0];this._opaque=!0;this._z=PANEL_Z}draggable(a=!0,b=!0){this._canDragX=a;this._canDragY=b;return this}constrain(a=!0,b=!0){this._constrainX=a;this._constrainY=b;return this}get isDraggable(){return this._opaque&&(this._canDragX||this._canDragY)}get canDragX(){return this._canDragX}get canDragY(){return this._canDragY}_doEvent(a,
b=0,c=0,d,e){e=this.getAbsXY();let [f,h]=this._orientation.xy(b-e.x,c-e.y,this._w,this._h);switch(a.type){case "mousedown":case "touchstart":0==d.part&&(this._canDragX||this._canDragY)&&(this.isOver=this._active=!0,this._dragData=[f,h]);break;case "mouseout":case "mouseup":case "touchend":this.isActive&&(this.isOver=this._active=!1,this.invalidateBuffer());break;case "mousemove":case "touchmove":if(this.isActive&&(this._canDragX||this._canDragY)){let [g,l]=this._dragData;a=this._x+(this._canDragX?
f-g:0);b=this._y+(this._canDragY?h-l:0);let [q,n]=[this._p.width,this._p.height],[p,k]=[this._w,this._h];this._constrainX&&p<=q&&(0>a?a=0:a>q-p&&(a=q-p));this._constrainY&&k<=n&&(0>b?b=0:b>n-k&&(b=n-k));this.moveTo(a,b)}this.isOver=this==d.control}return this.isActive?this:null}_updateControlVisual(){var a=this._scheme||this._gui.scheme();const b=a.C_0;a=a.C_3;let c=this._uiBfr;c.push();c.clear();c.strokeWeight(3);c.noStroke();c.noFill();this._opaque&&c.fill(b);this.isOver&&c.stroke(a);c.rect(0,0,
this._w,this._h);this._updatePanelControlPB();this._bufferInvalid=!1}_updatePanelControlPB(){let a=this._pkBfr;a.clear();a.noStroke();a.noFill();let b=this._gui.pickColor(this);this._opaque&&a.fill(b.r,b.g,b.b);a.rect(1,1,this._w-1,this._h-1)}_minControlSize(){return{w:this._w,h:this._h}}parent(a,b,c){return this}leaveParent(){return this}tooltip(a){return this}tipTextSize(a){return this}transparent(){return this}opaque(){return this}}
class CvsPane extends CvsBaseControl{constructor(a,b,c,d,e,f){super(a,b,c,d,e,f);this._background="rgba(0,0,0,0.6)";this._x=c;this._y=d;this._w=e;this._h=f;this._cornerRadius=5;this._status="closed";this._timer=0;this._z=PANE_Z}depth(){return this._depth}background(a){switch(a){case "dark":this._background="rgba(0,0,0,0.6)";break;case "light":this._background="rgba(255,255,255,0.6)";break;default:this._background=a}return this}close(){switch(this._status){case "opening":clearInterval(this._timer);
case "open":this._timer=setInterval(()=>{this._closing()},CvsPane._dI),this._status="closing",this.action({source:this,p5Event:void 0,state:"closed"})}return this}get isClosed(){return"closed"==this._status}get isClosing(){return"closing"==this._status}open(){switch(this._status){case "closing":clearInterval(this._timer);case "closed":this._gui._closePanes(),this._timer=setInterval(()=>{this._opening()},CvsPane._dI),this._status="opening",this.action({source:this,p5Event:void 0,state:"open"})}}get isOpen(){return"open"==
this._status}get isOpening(){return"opening"==this._status}_tabAction(a){a=a.source._parent;switch(a._status){case "open":a.close();break;case "closed":a.open()}}_draw(a,b){a.push();a.translate(this._x,this._y);b.push();b.drawingContext.setTransform(a.drawingContext.getTransform());if(this._visible&&"closed"!=this._tabstate){a.noStroke();a.fill(this._background);a.rect(0,0,this._w,this._h);b.noStroke();b.fill("white");b.rect(0,0,this._w,this._h);for(let c of this._children)c._visible&&c._draw(a,b)}b.pop();
a.pop()}text(a,b){this.tab().text(a,b);return this}noText(){this.tab().noText();return this}icon(a,b){this.tab().icon(a,b);return this}noIcon(){this.tab().noIcon();return this}textSize(a){this.tab().textSize(a);return this}shrink(a){return this.tab().shrink()}tab(){return this._children[0]}enable(){this.tab().enable();return this}disable(){this.close();this.tab().disable();return this}hide(){this.close();this.tab().hide();return this}show(){this.tab().show();return this}_minControlSize(){return{w:this._w,
h:this._h}}orient(a){return this}parent(a,b,c){return this}leaveParent(){return this}transparent(){return this}opaque(){return this}tooltip(a){return this}tipTextSize(a){return this}}CvsPane._dI=50;CvsPane._dC=60;CvsPane._dO=40;CvsPane._wExtra=20;CvsPane._tabID=1;
class CvsPaneNorth extends CvsPane{constructor(a,b,c){super(a,b,0,-c,a.canvasWidth(),c);this._depth=c;this._status="closed";b=this._tab=this._gui.button("Tab "+CvsPane._tabID++);b.text(b.id).setAction(this._tabAction);c=b._minControlSize();b._w=c.w+CvsPane._wExtra;b._c=[0,0,this._cornerRadius,this._cornerRadius];this.addChild(b);a._panesNorth.push(this);this._gui.validateTabsNorth()}_opening(){let a=this._y+CvsPane._dO;0<a&&(a=0,clearInterval(this._timer),this._status="open");this._y=a}_closing(){let a=
this._y-CvsPane._dC;a<-this._depth&&(a=-this._depth,clearInterval(this._timer),this._status="closed");this._y=a}validateTabs(){this._gui.validateTabsNorth();return this}}
class CvsPaneSouth extends CvsPane{constructor(a,b,c){super(a,b,0,a.canvasHeight(),a.canvasWidth(),c);this._depth=c;this._status="closed";a=this._tab=this._gui.button("Tab "+CvsPane._tabID++);a.text(a.id).setAction(this._tabAction);b=a._minControlSize();a._w=b.w+CvsPane._wExtra;a._c=[this._cornerRadius,this._cornerRadius,0,0];this.addChild(a);this._gui._panesSouth.push(this);this._gui.validateTabsSouth()}_opening(){let a=this._y-CvsPane._dO;a<this._gui.canvasHeight()-this._depth&&(a=this._gui.canvasHeight()-
this._depth,clearInterval(this._timer),this._status="open");this._y=a}_closing(){let a=this._y+CvsPane._dC;a>this._gui.canvasHeight()&&(a=this._gui.canvasHeight(),clearInterval(this._timer),this._status="closed");this._y=a}validateTabs(){this._gui.validateTabsSouth();return this}}
class CvsPaneEast extends CvsPane{constructor(a,b,c){super(a,b,a.canvasWidth(),0,c,a.canvasHeight());this._depth=c;this._status="closed";a=this._tab=this._gui.button("Tab "+CvsPane._tabID++);a.text(a.id).orient("north").setAction(this._tabAction);b=a._minControlSize();a._w=b.w+CvsPane._wExtra;a._c=[this._cornerRadius,this._cornerRadius,0,0];this.addChild(a);this._gui._panesEast.push(this);this._gui.validateTabsEast()}_opening(){let a=this._x-CvsPane._dO;a<this._gui.canvasWidth()-this._depth&&(a=this._gui.canvasWidth()-
this._depth,clearInterval(this._timer),this._status="open");this._x=a}_closing(){let a=this._x+CvsPane._dC;a>this._gui.canvasWidth()&&(a=this._gui.canvasWidth(),clearInterval(this._timer),this._status="closed");this._x=a}validateTabs(){this._gui.validateTabsEast();return this}}
class CvsPaneWest extends CvsPane{constructor(a,b,c){super(a,b,-c,0,c,a.canvasHeight());this._depth=c;this._status="closed";a=this._tab=this._gui.button("Tab "+CvsPane._tabID++);a.text(a.id).orient("south").setAction(this._tabAction);b=a._minControlSize();a._w=b.w+CvsPane._wExtra;a._c=[this._cornerRadius,this._cornerRadius,0,0];this.addChild(a);this._gui._panesWest.push(this);this._gui.validateTabsWest()}_opening(){let a=this._x+CvsPane._dO;0<a&&(a=0,clearInterval(this._timer),this._status="open");
this._x=a}_closing(){let a=this._x-CvsPane._dC;a<-this._depth&&(a=-this._depth,clearInterval(this._timer),this._status="closed");this._x=a}validateTabs(){this._gui.validateTabsWest();return this}}
class GridLayout{constructor(a,b,c,d){this._h=this._w=this._y=this._x=0;this._iy=this._ix=2;this._x=Math.round(a);this._y=Math.round(b);this._w=Math.round(c);this._h=Math.round(d);this._iy=this._ix=2;this._cx=[0,1];this._cy=[0,1]}get x(){return this._x}get y(){return this._y}get w(){return this._w}get h(){return this._h}get nbrCols(){return this._cx.length-1}get nbrRows(){return this._cy.length-1}get intPxlCols(){return this._cx.map(a=>Math.round(a*this._w))}get extPxlCols(){return this._cx.map(a=>
this._x+Math.round(a*this._w))}get normCols(){return[...this._cx]}get intPxlRows(){return this._cy.map(a=>Math.round(a*this._h))}get extPxlRows(){return this._cy.map(a=>this._y+Math.round(a*this._h))}get normRows(){return[...this._cy]}xy(a,b){this._x=Math.round(a);this._y=Math.round(b);return this}wh(a,b){this._w=Math.round(a);this._h=Math.round(b);return this}cols(a){a=this._makeNormArray(a);0<a.length&&(this._cx=a);return this}rows(a){a=this._makeNormArray(a);0<a.length&&(this._cy=a);return this}size(a,
b){this.cols(a);this.rows(b);return this}cell(a,b,c=1,d=1){return this._calcRect(a,b,c,d,this._ix,this._iy)}border(a,b,c=1,d=1){return this._calcRect(a,b,c,d)}insets(a=2,b=2){this._ix=Math.round(a);this._iy=Math.round(b);return this}_calcRect(a,b,c,d,e=0,f=0){[a,b,c,d]=this._validateCellPositions(a,b,c,d);return[Math.round(this._cx[a]*this._w+this._x+e),Math.round(this._cy[b]*this._h+this._y+f),Math.round((this._cx[a+c]-this._cx[a])*this._w-2*e),Math.round((this._cy[b+d]-this._cy[b])*this._h-2*f)]}_validateCellPositions(a,
b,c=1,d=1){function e(f,h,g){return f<h?h:f>g?g:f}a=e(a,0,this._cx.length-2);b=e(b,0,this._cy.length-2);c=e(c,1,this._cx.length-a-1);d=e(d,1,this._cy.length-b-1);return[a,b,c,d]}_makeNormArray(a){let b=[],c=[0];if(Array.isArray(a)){if(0<a.length){let e=0;a.forEach(f=>e+=f);a.forEach(f=>b.push(f/e))}}else for(let e=0;e<a;e++)b.push(1/a);let d=0;b.forEach(e=>c.push(d+=e));return c}};
