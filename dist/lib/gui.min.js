/*
 canvasGUI    (c) Peter Lager  2025
 @license MIT
 @version 2.0.0
*/
const CANVAS_GUI_VERSION="2.0.0",GUIS=new Map,ANNOUNCED=!1,CLOG=console.log,CWARN=console.warn,CERROR=console.error,CASSERT=console.assert,CCLEAR=console.clear;
class GUI{constructor(a,b=p5.instance){this._keyEventsEnabled=this._mouseEventsEnabled=this._touchEventsEnabled=!1;this._enabled=this._visible=this._eventsAllowed=!0;this._renderer=a;this._canvas=a.canvas;this._target=document.getElementById(a.canvas.id);this._p=b;this._is3D=void 0!=this._renderer.GL;this._controls=new Map;this._ctrls=[];this._corners=[4,4,4,4];this._optionGroups=new Map;this._textSize=12;this._tipTextSize=10;this._COLOR_STEP=8;this._PART_MASK=this._COLOR_STEP-1;this._COLOR_MASK=
16777215^this._PART_MASK;this._NEXT_COLOR=this._COLOR_STEP;this._colorKey=new Map;this._ctrlKey=new Map;this._panesEast=[];this._panesSouth=[];this._panesWest=[];this._panesNorth=[];this._initColorSchemes();this._addFocusHandlers();this._addMouseEventHandlers();this._addTouchEventHandlers();this._drawOverlay=this._is3D?this._drawHudWEBGL:this._drawHudP2D;this._validateGuiBuffers();this._getCamera=1==Number(b.VERSION.split(".")[0])?function(){return this._renderer._curCamera}:function(){return this._renderer.states.curCamera}}_validateGuiBuffers(){let a=
this._p;this._hud&&this._hud.width==a.width&&this._hud.height==a.height||(this._hud=a.createGraphics(a.width,a.height),this._hud.pixelDensity(window.devicePixelRatio),this._hud.clear(),this._pickbuffer=a.createGraphics(a.width,a.height),this._pickbuffer.pixelDensity(window.devicePixelRatio),this._pickbuffer.clear())}slider(a,b,c,d,e){return this.addControl(new CvsSlider(this,a,b,c,d,e),!0)}ranger(a,b,c,d,e){return this.addControl(new CvsRanger(this,a,b,c,d,e),!0)}button(a,b,c,d,e){return this.addControl(new CvsButton(this,
a,b,c,d,e),!0)}textfield(a,b,c,d,e){this._addKeyEventHandlers();return this.addControl(new CvsTextField(this,a,b,c,d,e),!0)}checkbox(a,b,c,d,e){return this.addControl(new CvsCheckbox(this,a,b,c,d,e),!0)}option(a,b,c,d,e){return this.addControl(new CvsOption(this,a,b,c,d,e),!0)}label(a,b,c,d,e){return this.addControl(new CvsLabel(this,a,b,c,d,e),!1)}viewer(a,b,c,d,e){return this.addControl(new CvsViewer(this,a,b,c,d,e),!0)}joystick(a,b,c,d,e){return this.addControl(new CvsJoystick(this,a,b,c,d,e),
!0)}knob(a,b,c,d,e){return this.addControl(new CvsKnob(this,a,b,c,d,e),!0)}__scroller(a,b,c,d,e){return this.addControl(new CvsScroller(this,a,b,c,d,e),!0)}__tooltip(a){return this.addControl(new CvsTooltip(this,a),!1)}pane(a,b,c){c=Math.round(c);switch(b){case "north":a=new CvsPaneNorth(this,a,c);break;case "south":a=new CvsPaneSouth(this,a,c);break;case "west":a=new CvsPaneWest(this,a,c);break;default:a=new CvsPaneEast(this,a,c)}return this.addControl(a,!1)}grid(a,b,c,d){return new GridLayout(a,
b,c,d)}name(){return this._uid}show(){this._visible=!0;return this}hide(){this._visible=!1;return this}isVisible(){return this._visible}enable(){this._enabled=!0;return this}disable(){this._enabled=!1;return this}isEnabled(){return this._enabled}stopEventHandling(){this._eventsAllowed=!1}startEventHandling(){this._eventsAllowed=!0}_addFocusHandlers(){let a=this._canvas;a.addEventListener("focusout",b=>{this._handleFocusEvents(b)});a.addEventListener("focusin",b=>{this._handleFocusEvents(b)})}_addMouseEventHandlers(){if(!this._mouseEventsEnabled){let a=
this._canvas;a.addEventListener("mousemove",b=>{this._handleMouseEvents(b)});a.addEventListener("mousedown",b=>{this._handleMouseEvents(b)});a.addEventListener("mouseup",b=>{this._handleMouseEvents(b)});a.addEventListener("wheel",b=>{this._handleMouseEvents(b)});a.addEventListener("mouseout",b=>{this._handleMouseEvents(b)});a.addEventListener("mouseenter",b=>{this._handleMouseEvents(b)});this._mouseEventsEnabled=!0}}_addKeyEventHandlers(){this._keyEventsEnabled||(this._target.setAttribute("tabindex",
"0"),this._target.focus(),this._target.addEventListener("keydown",a=>{this._handleKeyEvents(a);return!1}),this._target.addEventListener("keyup",a=>{this._handleKeyEvents(a);return!1}),this._keyEventsEnabled=!0)}_addTouchEventHandlers(){if(!this._touchEventsEnabled){let a=this._canvas;a.addEventListener("touchstart",b=>{this._handleTouchEvents(b)});a.addEventListener("touchend",b=>{this._handleTouchEvents(b)});a.addEventListener("touchcancel",b=>{this._handleTouchEvents(b)});a.addEventListener("touchmove",
b=>{this._handleTouchEvents(b)});this._touchEventsEnabled=!0}}_handleTouchEvents(a){if(this._eventsAllowed&&this._enabled&&this.isVisible()){let b;for(let c of this._ctrls)if(b=void 0,c.isActive()){b=c;c._handleTouch(a);break}if(void 0==b)for(let c of this._ctrls)c.isEnabled()&&c.isVisible()&&c._handleTouch(a)}}_handleFocusEvents(a){switch(a.type){case "focusout":for(let b of this._ctrls)b.isActive()&&(b._deactivate?.(),b.validate?.())}}_handleKeyEvents(a){if(this._eventsAllowed&&this._enabled&&this.isVisible())for(let b of this._ctrls)if(b.isActive()){b._handleKey(a);
break}return!1}_handleMouseEvents(a){if(this._eventsAllowed&&this._enabled&&this.isVisible()){let b=void 0;for(let c of this._ctrls)if(c.isActive())if(c._handleMouse){b=c;c._handleMouse(a);break}else c._active=!1;if(void 0==b)for(let c of this._ctrls)c.isEnabled()&&c.isVisible()&&c._handleMouse&&c._handleMouse(a)}return!1}$(a){return"string"===typeof a?this._controls.get(a):a}addControl(a,b=!1){CASSERT(!this._controls.has(a.id),`Control '${a.id}' already exists and will be replaced.`);this._controls.set(a.id,
a);this._ctrls=[...this._controls.values()];this.setRenderOrder();b&&this.register(a);return a}setRenderOrder(){this._ctrls.sort((a,b)=>a.z-b.z)}register(a){a&&!this._ctrlKey.has(a)&&(this._ctrlKey.set(a,this._NEXT_COLOR),this._colorKey.set(this._NEXT_COLOR,a),this._NEXT_COLOR+=this._COLOR_STEP)}deregister(a){if(a&&this._ctrlKey.has(a)){let b=this._ctrlKey.get(a);this._ctrlKey.delete(a);this._colorKey.delete(b)}}pickColor(a){if(this._ctrlKey.has(a))return a=this._ctrlKey.get(a),{r:a>>16&255,g:a>>
8&255,b:a&255}}showBuffer(a,b=this._pickbuffer){var c=document.getElementById(a);c||(c=document.createElement("canvas"),c.setAttribute("id",a),document.getElementsByTagName("body")[0].append(c));c.setAttribute("width",`${b.width}`);c.setAttribute("height",`${b.height}`);c.setAttribute("padding","3px");c.style.border="2px solid #000000";if(c instanceof HTMLCanvasElement){a=window.devicePixelRatio;let [d,e,f]=[b.canvas,b.width*a,b.height*a];b=c.getContext("2d");c=b.canvas;b.drawImage(d,0,0,e,f,0,0,
c.width,c.height)}}listControls(){CLOG("--------------------   List of controls   --------------------");this._ctrls.forEach(a=>{let b=`${a.id}                               `.substring(0,15),c=`${a.constructor.name}                   `.substring(0,15),d=`Z: ${a.z}      `.substring(0,10);a=`Color key: ${this._ctrlKey.get(a)}`;CLOG(b+c+d+a)});CLOG("--------------------------------------------------------------")}getOptionGroup(a){this._optionGroups.has(a)||this._optionGroups.set(a,new CvsOptionGroup(a));
return this._optionGroups.get(a)}textSize(a){if(!Number.isFinite(a))return this._textSize;this._textSize=a;this._controls.forEach(b=>{b.invalidateBuffer()});return this}tipTextSize(a){return a?(this._tipTextSize=a,this):this._tipTextSize}canvasWidth(){return this._renderer.width}canvasHeight(){return this._renderer.height}corners(a){Array.isArray(a)&&4==a.length&&(this._corners=[...a]);return[...this._corners]}context(){return this._renderer}is3D(){return this._is3D}_closePanes(){for(let a of this._panesEast)a.close();
for(let a of this._panesWest)a.close();for(let a of this._panesSouth)a.close();for(let a of this._panesNorth)a.close()}hidePanes(){this._closePanes();for(let a of this._panesEast)a.hide();for(let a of this._panesWest)a.hide();for(let a of this._panesSouth)a.hide();for(let a of this._panesNorth)a.hide()}showPanes(){for(let a of this._panesEast)a.show();for(let a of this._panesWest)a.show();for(let a of this._panesSouth)a.show();for(let a of this._panesNorth)a.show()}validateTabsEast(){let a=this._panesEast,
b=a.length,c=2*(b-1);a.forEach(e=>c+=e.tab()._w);let d=(this.canvasHeight()-c)/2;for(let e=0;e<b;e++){let f=a[e].tab(),h=-f._h,g=d;d+=f._w+2;f._x=h;f._y=g}}validateTabsWest(){let a=this._panesWest,b=a.length,c=2*(b-1);a.forEach(f=>c+=f.tab()._w);let d=(this.canvasHeight()-c)/2;for(let f=0;f<b;f++){var e=a[f];let h=e.tab();e=e.depth();let g=d;d+=h._w+2;h._x=e;h._y=g}}validateTabsSouth(){let a=this._panesSouth,b=a.length,c=2*(b-1);a.forEach(e=>c+=e.tab()._w);let d=(this.canvasWidth()-c)/2;for(let e=
0;e<b;e++){let f=a[e].tab(),h=d,g=-f._h;d+=f._w+2;f._x=h;f._y=g}}validateTabsNorth(){let a=this._panesNorth,b=a.length,c=2*(b-1);a.forEach(f=>c+=f.tab()._w);let d=(this.canvasWidth()-c)/2;for(let f=0;f<b;f++){var e=a[f];let h=e.tab(),g=d;e=e.depth();d+=h._w+2;h._x=g;h._y=e}}_initColorSchemes(){this._schemes=[];this._schemes.blue=new BlueScheme;this._schemes.green=new GreenScheme;this._schemes.red=new RedScheme;this._schemes.cyan=new CyanScheme;this._schemes.yellow=new YellowScheme;this._schemes.purple=
new PurpleScheme;this._schemes.orange=new OrangeScheme;this._schemes.light=new LightScheme;this._schemes.dark=new DarkScheme;this._scheme=this._schemes.blue}scheme(a){if(!a)return this._scheme;this._schemes[a]?(this._scheme=this._schemes[a],this._controls.forEach(b=>{b.scheme()||b.invalidateBuffer()})):CERROR(`'${a}' is not a valid color scheme`);return this}_getScheme(a){if(a&&this._schemes[a])return Object.assign({},this._schemes[a]);CWARN(`Unable to retrieve color scheme '${a}'`)}addScheme(a,b){"string"!==
typeof a||b||(this._schemes[a]?CERROR(`Cannot add scheme '${a}' because it already exists.'`):this._schemes[a]=b);return this}draw(){this._hud.clear();this._pickbuffer.clear();if(this._visible){this._p.push();for(let a of this._ctrls)a.getParent()||a._draw(this._hud,this._pickbuffer);this._p.pop();this._drawOverlay()}}_drawHudP2D(){this._visible&&(this._p.push(),this._p.image(this._hud,0,0),this._p.pop())}_drawHudWEBGL(){if(this._visible){this._p.push();let a=this._renderer,b=a.drawingContext,c=a.width,
d=a.height,e=Number.MAX_VALUE;b.flush();let f=a.uMVMatrix.copy(),h=a.uPMatrix.copy();b.disable(b.DEPTH_TEST);a.resetMatrix();this._getCamera().ortho(0,c,-d,0,-e,e);this._p.image(this._hud,0,0);b.flush();a.uMVMatrix.set(f);a.uPMatrix.set(h);b.enable(b.DEPTH_TEST);this._p.pop()}}getPicked(a,b){let c=this._pickbuffer;return 0<=a&&a<c.width&&0<=b&&b<c.height&&(a=c.get().get(a,b),b=(a[0]<<16)+(a[1]<<8)+a[2],a=this._colorKey.get(b&this._COLOR_MASK),b&=this._PART_MASK,a)?{hit:a,part:b}:{hit:void 0,part:void 0}}}
const ANNOUNCE_CANVAS_GUI=function(){0==GUIS.size&&(CLOG("================================================"),CLOG(`  canvasGUI (${CANVAS_GUI_VERSION})   \u00A9 2025 Peter Lager`),CLOG("================================================"))},createGUI=function(a,b,c=p5.instance){ANNOUNCE_CANVAS_GUI();if(GUIS.has(a))return CWARN(`You already have a  GUI called '${a} it will not be replaced`),GUIS.get(a);b=new GUI(b,c);GUIS.set(a,b);return b},getGUI=function(a){return GUIS.get(a)};
class BaseScheme{constructor(){this._greyTints()}_color(a){this.C_0=`hsb(${a}, 10%, 100%)`;this.C_1=`hsb(${a}, 20%, 100%)`;this.C_2=`hsb(${a}, 30%, 100%)`;this.C_3=`hsb(${a}, 40%, 100%)`;this.C_4=`hsb(${a}, 60%, 100%)`;this.C_5=`hsb(${a}, 70%, 90%)`;this.C_6=`hsb(${a}, 80%, 80%)`;this.C_7=`hsb(${a}, 90%, 75%)`;this.C_8=`hsb(${a}, 90%, 50%)`;this.C_9=`hsb(${a}, 90%, 40%)`}_mono(a,b){let c=0;for(let d=0;10>d;d++){let e=Math.floor(a+(b-a)*d/10);this[`C_${c++}`]=`rgb(${e}, ${e}, ${e})`}}_grey(a){let b=
[100,80,70,60,50,40,30,20,10,0];"dark"===a&&b.reverse();for(a=0;a<b.length;a++)this[`G_${a}`]=`hsb(0,0%,${b[a]}%)`}_greyTints(){let a=[.05,.075,.1,.25,.3,.4,.5,.6,.7];for(let b=0;b<a.length;b++)this[`T_${b}`]=`rgba(0,0,0,${a[b]})`}_whiteTints(){let a=[.25,.35,.4,.45,.5,.6,.7,.8,.9];for(let b=0;b<a.length;b++)this[`T_${b}`]=`rgba(255,255,255,${a[b]})`}}class RedScheme extends BaseScheme{constructor(){super();this._color(0);this._grey("light")}}
class OrangeScheme extends BaseScheme{constructor(){super();this._color(30);this._grey("light")}}class YellowScheme extends BaseScheme{constructor(){super();this._color(60);this._grey("light")}}class GreenScheme extends BaseScheme{constructor(){super();this._color(120);this._grey("light")}}class CyanScheme extends BaseScheme{constructor(){super();this._color(180);this._grey("light")}}class BlueScheme extends BaseScheme{constructor(){super();this._color(224);this._grey("light")}}
class PurpleScheme extends BaseScheme{constructor(){super();this._color(300);this._grey("light")}}class LightScheme extends BaseScheme{constructor(){super();this._mono(254,0);this._grey("light")}}class DarkScheme extends BaseScheme{constructor(){super();this._mono(0,254);this._grey("dark");this._whiteTints()}}class OrientNorth{getTransform(a,b){return{tx:0,ty:a,rot:1.5*Math.PI}}xy(a,b,c,d){return[c-b,a,d,c]}wh(a,b){return[b,a]}}
class OrientSouth{getTransform(a,b){return{tx:b,ty:0,rot:.5*Math.PI}}xy(a,b,c,d){return[b,d-a,d,c]}wh(a,b){return[b,a]}}class OrientEast{getTransform(a,b){return{tx:0,ty:0,rot:0}}xy(a,b,c,d){return[a,b,c,d]}wh(a,b){return[a,b]}}class OrientWest{getTransform(a,b){return{tx:a,ty:b,rot:Math.PI}}xy(a,b,c,d){return[c-a,d-b,c,d]}wh(a,b){return[a,b]}}
class CvsBaseControl{constructor(a,b,c,d,e,f){this._children=[];this._enabled=this._visible=!0;this._pover=this._over=this._h=this._w=this._y=this._x=this._z=0;this._active=this._clickAllowed=!1;this._bufferInvalid=this._opaque=!0;this.action=function(){};this._gui=a;this._p=this._gui._p;this._id=b;this._x=Math.round(c);this._y=Math.round(d);this._w=Math.round(e);this._h=Math.round(f);this._parent=void 0;this._enabled=this._visible=!0;this._scheme=void 0;this._orientation=CvsBaseControl.EAST;this._dragging=
!1;this._c=a.corners(void 0)}get x(){return this._x}set x(a){this._x=Math.round(a)}get y(){return this._y}set y(a){this._y=Math.round(a)}get z(){return this._z}set z(a){this._z=a}get w(){return this._w}set w(a){this._w=Math.round(a)}get h(){return this._h}set h(a){this._h=Math.round(a)}get id(){return this._id}moveTo(a,b){this.x=a;this.y=b;return this}moveBy(a,b){this.x+=a;this.y+=b;return this}getAbsXY(){if(this._parent){let a=this._parent.getAbsXY();a.x+=this._x;a.y+=this._y;return a}return{x:this._x,
y:this._y}}scheme(a,b){if(a){this._scheme=this._gui._getScheme(a);this.invalidateBuffer();if(b)for(let c of this._children)c.scheme(a,b);return this}return this._scheme}invalidateBuffer(){this._bufferInvalid=!0;return this}parent(a,b,c){a=this._gui.$(a);a.addChild(this,b,c);this.z=a.z+128;this._gui.setRenderOrder();return this}addChild(a,b,c){a=this._gui.$(a);b=Number.isFinite(b)?Number(b):a.x;c=Number.isFinite(c)?Number(c):a.y;a._parent||a.leaveParent();a.x=b;a.y=c;a._parent=this;a.z=this.z+128;
this._children.push(a);this._gui.setRenderOrder();return this}removeChild(a){a=this._gui.$(a);for(let b=0;b<this._children.length;b++)if(a===this._children[b]){let c=a.getAbsXY();a._x=c.x;a._y=c.y;a._parent=null;this._children[b]=void 0;break}this._children=this._children.filter(Boolean);this._gui.setRenderOrder();return this}leaveParent(){this._parent&&(this._parent.removeChild(this),this.z=0);return this}getParent(){return this._parent}setAction(a){"function"===typeof a?this.action=a:console.error("The action for '$(this._id)' must be a function definition");
return this}orient(a){a=a.toString().toLowerCase();switch(a){case "north":this._orientation=CvsBaseControl.NORTH;break;case "south":this._orientation=CvsBaseControl.SOUTH;break;case "west":this._orientation=CvsBaseControl.WEST;break;default:this._orientation=CvsBaseControl.EAST}return this}isActive(){return this._active}isEnabled(){return this._enabled}enable(a){this._enabled||(this._enabled=!0,this.invalidateBuffer());if(a)for(let b of this._children)b.enable(a);return this}disable(a){this._enabled&&
(this._enabled=!1,this.invalidateBuffer());if(a)for(let b of this._children)b.disable(a);return this}show(a){this._visible=!0;if(a)for(let b of this._children)b.show(a);return this}hide(a){this._visible=!1;if(a)for(let b of this._children)b.hide(a);return this}isVisible(){return this._visible}opaque(){this._opaque=!0;return this}transparent(){this._opaque=!1;return this}_whereOver(a,b,c){if(0<a&&a<this._w&&0<b&&b<this._h){if(5<this._c[0]){c=a-this._c[0];var d=b-this._c[0];if(0>c&&0>d&&c*c+d*d>this._c[0]*
this._c[0])return 0}return 5<this._c[1]&&(c=a-(this._w-this._c[1]),d=b-this._c[1],0<c&&0>d&&c*c+d*d>this._c[1]*this._c[1])||5<this._c[2]&&(c=a-(this._w-this._c[2]),d=b-(this._h-this._c[2]),0<c&&0<d&&c*c+d*d>this._c[2]*this._c[2])||5<this._c[3]&&(a-=this._c[3],b-=this._h-this._c[3],0>a&&0<b&&a*a+b*b>this._c[3]*this._c[3])?0:1}return 0}_minControlSize(){return null}_updateControlVisual(){}_handleKey(a){return!0}_handleTouch(a){}_processEvent(a,...b){}_draw(a,b){}_eq(a,b){return.001>Math.abs(a-b)}_neq(a,
b){return.001<=Math.abs(a-b)}over(){return this._over}pover(){return this._pover}orientation(){return this._orientation}}CvsBaseControl.NORTH=new OrientNorth;CvsBaseControl.SOUTH=new OrientSouth;CvsBaseControl.EAST=new OrientEast;CvsBaseControl.WEST=new OrientWest;
const processMouse={_handleMouse(a){let b=this.getAbsXY(),[c,d,e,f]=this._orientation.xy(this._p.mouseX-b.x,this._p.mouseY-b.y,this._w,this._h);this._pover=this._over;this._over=this._whereOver(c,d);this._bufferInvalid=this._bufferInvalid||this._pover!=this._over;this._tooltip&&this._tooltip._updateState(this,this._pover,this._over);this._processEvent(a,c,d,e,f);return!1}},processTouch={_handleTouch(a){a.preventDefault();let b=this.getAbsXY();const c=this._gui._canvas.getBoundingClientRect(),d=a.changedTouches[0];
let [e,f,h,g]=this._orientation.xy(d.clientX-c.left-b.x,d.clientY-c.top-b.y,this._w,this._h);this._pover=this._over;this._over=this._whereOver(e,f,5);this._bufferInvalid=this._bufferInvalid||this._pover!=this._over;this._tooltip&&this._tooltip._updateState(this,this._pover,this._over);this._processEvent(a,e,f,h,g)}};
class CvsBufferedControl extends CvsBaseControl{constructor(a,b,c,d,e,f){super(a,b,c,d,e,f);this._tooltip=void 0;this._validateControlBuffers()}_validateControlBuffers(){this._uiBfr&&this._uiBfr.width==this._w&&this._uiBfr.height==this._h||(this._uiBfr=this._p.createGraphics(this._w,this._h),this._uiBfr.pixelDensity(2),this._uiBfr.clear(),this._pkBfr=this._p.createGraphics(this._w,this._h),this._pkBfr.pixelDensity(1),this._pkBfr.clear())}_validateBuffer(){let a=this._uiBfr;if(a.width!=this._w||a.height!=
this._h)this._uiBfr=this._p.createGraphics(this._w,this._h),this.invalidateBuffer();this._bufferInvalid&&(this._updateControlVisual(),this._bufferInvalid=!1)}_updateRectControlPB(){let a=this._pkBfr;a.clear();let b=this._gui.pickColor(this);a.noStroke();a.fill(b.r,b.g,b.b);a.rect(1,1,this._w-1,this._h-1,...this._c)}_draw(a,b){this._validateBuffer();a.push();a.translate(this._x,this._y);if(this._visible){let c=this._orientation.getTransform(this._w,this._h);a.translate(c.tx,c.ty);a.rotate(c.rot);a.image(this._uiBfr,
0,0);this._enabled&&(b.drawingContext.setTransform(a.drawingContext.getTransform()),b.image(this._pkBfr,0,0))}for(let c of this._children)c._visible&&c._draw(a,b);a.pop()}_disable_hightlight(a,b,c,d,e,f){a.fill(b.T_5);a.noStroke();a.rect(c,d,e,f,...this._c)}shrink(a){let b=this._minControlSize();switch(a){case "w":this._w=b.w;break;case "h":this._h=b.h;break;default:this._w=b.w,this._h=b.h}this._validateControlBuffers();this.invalidateBuffer();return this}corners(a){return Array.isArray(a)&&4==a.length?
(this._c=[...a],this):[...this._c]}tooltip(a,b=1600){a=this._gui.__tooltip(this._id+".tooltip").text(a).showTime(b).shrink();this.addChild(a);a instanceof CvsTooltip&&(a._validatePosition(),this._tooltip=a);return this}tipTextSize(a){this._tooltip&&a&&0<a&&this._tooltip.textSize(a);return this}}
class CvsSlider extends CvsBufferedControl{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||100,f||20);this._t01=.5;this._limit0=0;this._limit1=1;this._minorTicks=this._majorTicks=0;this._opaque=this._s2ticks=!1}limits(a,b){Number.isFinite(a)&&Number.isFinite(b)&&(this._limit0=a,this._limit1=b);return this}isValid(a){return Number.isFinite(a)&&0>=(a-this._limit0)*(a-this._limit1)}ticks(a,b,c){this._majorTicks=a;this._minorTicks=b;this._s2ticks=!!c;return this}value(a){return Number.isFinite(a)&&0>=
(a-this._limit0)*(a-this._limit1)?(this.invalidateBuffer(),this._t01=this._norm01(a),this):this._t2v(this._t01)}_t2v(a){return this._limit0+a*(this._limit1-this._limit0)}_v2t(a){return(a-this._limit0)/(this._limit1-this._limit0)}_norm01(a,b=this._limit0,c=this._limit1){return this._p.constrain(this._p.map(a,b,c,0,1),0,1)}_whereOver(a,b,c=8){let d=this._uiBfr.height/2;return Math.abs(this._t01*(this._uiBfr.width-20)-(a-10))<=c&&Math.abs(d-b)<=c?1:0}_processEvent(a,...b){b=b[0];switch(a.type){case "mousedown":case "touchstart":0<
this._over&&(this._active=!0,this.invalidateBuffer());break;case "mouseout":case "mouseup":case "touchend":this._active&&(this.action({source:this,p5Event:a,value:this.value(),final:!0}),this._active=!1,this.invalidateBuffer());break;case "mousemove":case "touchmove":this._active&&(b=this._norm01(b-10,0,this._uiBfr.width-20),this._s2ticks&&(b=this._nearestTickT(b)),this._t01!=b&&(this._t01=b,this.action({source:this,p5Event:a,value:this.value(),final:!1})),this.invalidateBuffer())}}_nearestTickT(a){let b=
0<this._minorTicks?this._minorTicks*this._majorTicks:this._majorTicks;return 0<b?Math.round(a*b)/b:a}_updateControlVisual(){let a=this._scheme||this._gui.scheme();var b=a.C_3,c=a.G_7,d=a.G_3;const e=a.G_1,f=a.C_9,h=a.C_6;let g=this._uiBfr,l=g.width-20,p=Math.round(g.height/2);g.push();g.clear();this._opaque&&(g.noStroke(),g.fill(b),g.rect(0,0,this._w,this._h,...this._c));g.translate(10,p);g.stroke(c);g.strokeWeight(1);c=this._majorTicks*this._minorTicks;if(2<=c){b=l/c;for(var k=0;k<=c;k++){var q=
k*b;g.line(q,-7,q,7)}}c=this._majorTicks;if(2<=c)for(b=l/c,k=0;k<=c;k++)q=k*b,g.line(q,-10,q,10);g.fill(d);g.rect(0,-4,l,8);d=l*this._t01;g.fill(e);g.rect(0,-4,d,8,...this._c);g.fill(h);g.noStroke();if(this._active||0<this._over)g.strokeWeight(2),g.stroke(f);g.rect(d-6,-6,12,12,...this._c);this._enabled||this._disable_hightlight(g,a,-10,-this._h/2,this._w,this._h);this._updateSliderPickBuffer(p,l,8,d,12);g.pop();this._bufferInvalid=!1}_updateSliderPickBuffer(a,b,c,d,e){d=Math.round(d);let f=this._gui.pickColor(this),
h=this._pkBfr;h.push();h.clear();h.noStroke();h.translate(10,a);h.fill(f.r,f.g,f.b+5);h.rect(0,-c/2,b,c,...this._c);h.fill(f.r,f.g,f.b+6);h.rect(0,-c/2,d,c,...this._c);h.fill(f.r,f.g,f.b);h.rect(d-e/2,-e/2,e,e);h.pop()}_minControlSize(){return{w:this._w,h:20}}}Object.assign(CvsSlider.prototype,processMouse,processTouch);
class CvsRanger extends CvsSlider{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||100,f||20);this._t=[.25,.75];this._tIdx=-1;this._limit0=0;this._limit1=1;this._opaque=!1}range(a,b){if(Number.isFinite(a)&&Number.isFinite(b)){let c=this._norm01(Math.min(a,b));a=this._norm01(Math.max(a,b));if(0<=c&&1>=c&&0<=a&&1>=a)return this._bufferInvalid=this._t[0]!=c||this._t[1]!=a,this._t[0]=c,this._t[1]=a,this}return{low:this._t2v(this._t[0]),high:this._t2v(this._t[1])}}low(){return this._t2v(this._t[0])}high(){return this._t2v(this._t[1])}value(a){console.warn("Ranger controls require 2 values - use range(v0, v1) instead")}_whereOver(a,
b,c=8){if(8>=Math.abs(b-this._uiBfr.height/2)){b=this._uiBfr.width-20;let d=this._t;a-=10;if(Math.abs(d[0]*b-a)<=c)return 1;if(Math.abs(d[1]*b-a)<=c)return 2}return 0}_processEvent(a,...b){b=b[0];this._tIdx=this._active?this._tIdx:this._over-1;switch(a.type){case "mousedown":case "touchstart":0<this._over&&(this._active=!0,this._tIdx=this._over-1,this.invalidateBuffer());break;case "mouseout":case "mouseup":case "touchend":if(this._active){b=Math.min(this._t[0],this._t[1]);let c=Math.max(this._t[0],
this._t[1]);this._t[0]=b;this._t[1]=c;this._tIdx=-1;this.action({source:this,p5Event:a,low:this._t2v(b),high:this._t2v(c),final:!0});this._active=!1;this.invalidateBuffer()}break;case "mousemove":case "touchmove":this._active&&(b=this._norm01(b-10,0,this._uiBfr.width-20),this._s2ticks&&(b=this._nearestTickT(b)),this._t[this._tIdx]!=b&&(this._t[this._tIdx]=b,b=Math.max(this._t[0],this._t[1]),this.action({source:this,p5Event:a,low:this._t2v(Math.min(this._t[0],this._t[1])),high:this._t2v(b),final:!1})),
this.invalidateBuffer())}}_updateControlVisual(){let a=this._scheme||this._gui.scheme();var b=a.C_3,c=a.G_7,d=a.G_3,e=a.G_1;const f=a.C_9,h=a.C_6;let g=this._uiBfr,l=g.width-20,p=Math.round(g.height/2);g.push();g.clear();this._opaque&&(g.noStroke(),g.fill(b),g.rect(0,0,this._w,this._h,...this._c));g.translate(10,p);g.stroke(c);g.strokeWeight(1);c=this._majorTicks*this._minorTicks;if(2<=c){b=l/c;for(var k=0;k<=c;k++){var q=k*b;g.line(q,-7,q,7)}}c=this._majorTicks;if(2<=c)for(b=l/this._majorTicks,k=
0;k<=c;k++)q=k*b,g.line(q,-10,q,10);g.fill(d);g.rect(0,-4,l,8);d=l*Math.min(this._t[0],this._t[1]);b=l*Math.max(this._t[0],this._t[1]);g.fill(e);g.rect(d,-4,b-d,8,...this._c);for(e=0;2>e;e++)g.fill(h),g.noStroke(),(this._active||0<this._over)&&e==this._tIdx&&(g.strokeWeight(2),g.stroke(f)),g.rect(this._t[e]*l-6,-6,12,12,...this._c);this._enabled||this._disable_hightlight(g,a,-10,-this._h/2,this._w,this._h);this._updateRangerPickBuffer(p,l,8,d,b,12);g.pop();this._bufferInvalid=!1}_updateRangerPickBuffer(a,
b,c,d,e,f){d=Math.round(d);e=Math.round(e);let h=this._gui.pickColor(this),g=this._pkBfr;g.push();g.clear();g.noStroke();g.translate(10,a);g.fill(h.r,h.g,h.b+5);g.rect(0,-c/2,b,c,...this._c);g.fill(h.r,h.g,h.b+6);g.rect(d,-c/2,e-d,c,...this._c);g.fill(h.r,h.g,h.b);g.rect(d-f/2,-f/2,f,f);g.fill(h.r,h.g,h.b+1);g.rect(e-f/2,-f/2,f,f);g.pop()}}Object.assign(CvsRanger.prototype,processMouse,processTouch);
class CvsText extends CvsBufferedControl{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||80,f||16);this._lines=[];this._textSize=void 0;this._textAlign=this._p.CENTER;this._tbox={w:0,h:0};this._gap=2}text(a,b){if(null==a||void 0==a)return this._lines.join("\n");Array.isArray(a)?this._lines=a.map(c=>c.toString()):this._lines=a.toString().split("\n").map(c=>c.toString());this.textAlign(b);a=this._minControlSize();this._w=Math.max(this._w,a.w);this._h=Math.max(this._h,a.h);this._validateControlBuffers();
this.invalidateBuffer();return this}textAlign(a){!a||a!=this._p.LEFT&&a!=this._p.CENTER&&a!=this._p.RIGHT||(this._textAlign=a,this.invalidateBuffer());return this}noText(){this._lines=[];this._tbox={w:0,h:0};this.invalidateBuffer();return this}textSize(a){let b=this._textSize||this._gui.textSize();if(!Number.isFinite(a))return b;a=Number(a);a!=b&&(this._textSize=a,a=this._minControlSize(),this._w=Math.max(this._w,a.w),this._h=Math.max(this._h,a.h),this._validateControlBuffers(),this.invalidateBuffer());
return this}_minControlSize(){let a=this._uiBfr,b=this._lines,c=this._textSize||this._gui.textSize(),d=this._tbox,e=0,f=0,h=this._gap;0<b.length&&(a||this._validateBuffer(),a.textSize(c),d.w=c+b.map(g=>a.textWidth(g)).reduce((g,l)=>g>l?g:l),d.h=(b.length-1)*a.textLeading(),h+=this._gap);e+=d.w+h;f=Math.max(d.h,f)+2*h;return{w:e,h:f}}}
class CvsTextIcon extends CvsText{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||80,f||16);this._icon=void 0;this._iconAlign=this._p.LEFT}icon(a,b){if(!a)return this._icon;this._icon=a;!b||b!=this._p.LEFT&&b!=this._p.RIGHT||(this._iconAlign=b);a=this._minControlSize();this._w=Math.max(this._w,a.w);this._h=Math.max(this._h,a.h);this._validateControlBuffers();this.invalidateBuffer();return this}iconAlign(a){!a||a!=this._p.LEFT&&a!=this._p.RIGHT||(this._iconAlign=a,a=this._minControlSize(),this._w=
Math.max(this._w,a.w),this._h=Math.max(this._h,a.h),this._validateControlBuffers(),this.invalidateBuffer());return this}noIcon(){this._icon&&(this._icon=void 0,this.invalidateBuffer());return this}_minControlSize(){let a=this._uiBfr,b=this._lines,c=this._icon,d=this._textSize||this._gui.textSize(),e=this._tbox,f=0,h=0,g=this._gap;c&&(f=c.width,h=c.height,g+=this._gap);0<b.length&&(a||this._validateBuffer(),a.textSize(d),e.w=d+b.map(l=>a.textWidth(l)).reduce((l,p)=>l>p?l:p),e.h=(b.length-1)*a.textLeading()+
a.textAscent()+a.textDescent(),g+=this._gap);f+=e.w+g;h=Math.max(this._tbox.h,h)+g;return{w:Math.ceil(f),h:Math.ceil(h)}}}
class CvsLabel extends CvsTextIcon{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||60,f||16)}_updateControlVisual(){var a=this._textSize||this._gui.textSize(),b=this._scheme||this._gui.scheme();let c=this._p;var d=this._icon,e=this._iconAlign;let f=this._textAlign,h=this._lines,g=this._gap;var l=b.C_3;b=b.C_8;let p=this._uiBfr;p.push();p.clear();this._opaque&&(p.noStroke(),p.fill(l),p.rect(0,0,this._w,this._h,this._c[0],this._c[1],this._c[2],this._c[3]));if(d){l=0;switch(e){case c.LEFT:l=g;break;
case c.RIGHT:l=this._w-d.width-g}0==h.length&&(l=(this._w-d.width)/2);p.image(this._icon,l,(this._h-d.height+g)/2)}if(0<h.length){p.textSize(a);a=g;l=this._w-g;let k=0;d&&e==c.LEFT&&(a+=d.width);d&&e==c.RIGHT&&(l-=d.width);d=l-a;e=this._tbox.h;e=p.textAscent()+(this._h-e)/2;p.fill(b);for(let q of h){switch(f){case c.LEFT:k=a;break;case c.CENTER:k=a+(d-p.textWidth(q))/2;break;case c.RIGHT:k=l-p.textWidth(q)-g}p.text(q,k,e);e+=p.textLeading()}}p.pop();this._bufferInvalid=!1}}
class CvsButton extends CvsTextIcon{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||80,f||16)}_updateControlVisual(){var a=this._textSize||this._gui.textSize();let b=this._scheme||this._gui.scheme();var c=this._iconAlign;let d=this._textAlign;var e=this._icon;let f=this._lines,h=this._gap;var g=b.C_3;const l=b.C_8,p=b.C_9;let k=this._uiBfr;k.push();k.clear();this._opaque&&(k.noStroke(),k.fill(g),k.rect(1,1,this._w-1,this._h-1,...this._c));if(e){g=0;switch(c){case this._p.LEFT:g=h;break;case this._p.RIGHT:g=
this._w-e.width-h}0==f.length&&(g=(this._w-e.width)/2);k.image(this._icon,g,(this._h-e.height)/2)}if(0<f.length){k.textSize(a);a=h;g=this._w-h;let q=0;e&&c==this._p.LEFT&&(a+=e.width);e&&c==this._p.RIGHT&&(g-=e.width);c=g-a;e=this._tbox.h;e=k.textAscent()+(this._h-e)/2;k.fill(l);for(let m of f){switch(d){case this._p.LEFT:q=a;break;case this._p.CENTER:q=a+(c-k.textWidth(m))/2;break;case this._p.RIGHT:q=g-k.textWidth(m)-h}k.text(m,q,e);e+=k.textLeading()}}0<this._over&&(k.stroke(p),k.strokeWeight(2),
k.noFill(),k.rect(1,1,this._w-2,this._h-2,...this._c));this._enabled||this._disable_hightlight(k,b,0,0,this._w,this._h);this._updateRectControlPB();k.pop();this._bufferInvalid=!1;this._parent instanceof CvsPane&&this._parent.validateTabs()}_processEvent(a,...b){switch(a.type){case "mousedown":case "touchstart":0<this._over&&(this._active=this._dragging=this._clickAllowed=!0,this.invalidateBuffer());break;case "mouseout":case "mouseup":case "touchend":this._active&&(this._clickAllowed&&this.action({source:this,
p5Event:a}),this._over=0,this._active=this._dragging=this._clickAllowed=!1,this.invalidateBuffer());break;case "mousemove":case "touchmove":this._clickAllowed=!1}}}Object.assign(CvsButton.prototype,processMouse,processTouch);
class CvsTooltip extends CvsText{constructor(a,b){super(a,b);this._gap=1;this._visible=!1;this._showTime=0}text(a){if(Array.isArray(a))this._lines=a;else{a=a.toString().split("\n");this._lines=[];for(var b of a)this._lines.push(b)}b=this._minControlSize();this._w=Math.max(this._w,b.w);this._h=Math.max(this._h,b.h);this.invalidateBuffer();return this}showTime(a){this._showTime=a;return this}_updateState(a,b,c){a.isVisible()&&b!=c&&0<c&&(this.show(),setTimeout(()=>{this.hide()},this._showTime))}_validatePosition(){let a=
this._parent,{x:b,y:c}=a.getAbsXY(),[d,e]=a.orientation().wh(a.w,a.h);this._x=0;this._y=-this._h;0>c+this._y&&(this._y+=this._h+e);b+this._x+this._w>this._gui.canvasWidth()&&(this._x-=this._w-d)}_updateControlVisual(){var a=this._textSize||this._gui.tipTextSize(),b=this._parent.scheme()||this._gui.scheme(),c=this._lines;let d=this._gap;var e=b.C_3;const f=b.C_9;b=this._uiBfr;b.push();b.clear();b.stroke(f);b.fill(e);b.rect(0,0,this._w-1,this._h-1);b.fill(f).noStroke();if(0<c.length){b.textSize(a);
a=this._w-d-d;e=this._tbox.h;e=b.textAscent()+(this._h-e)/2;for(let h of c)c=d+(a-b.textWidth(h))/2,b.text(h,c,e),e+=b.textLeading()}b.pop();this._bufferInvalid=!1}_minControlSize(){let a=this._uiBfr,b=this._lines,c=this._textSize||this._gui.tipTextSize(),d=this._tbox,e=0,f=0,h=this._gap;0<b.length&&(a||this._validateBuffer(),a.textSize(c),d.w=c+b.map(g=>a.textWidth(g)).reduce((g,l)=>g>l?g:l),d.h=(b.length-1)*a.textLeading()+a.textAscent()+a.textDescent(),h+=this._gap);e+=d.w+h;f=Math.max(d.h,f)+
2*h;return{w:e,h:f}}}
class CvsScroller extends CvsBufferedControl{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||100,f||20);this._dvalue=this._value=.5;this._used=.1;this._s_mx=this._s_dvalue=this._s_value=.5;this._minV=this._used/2;this._maxV=1-this._used/2;this._BORDER=10;this._THEIGHT=8;this._THUMB_HEIGHT=12;this._MIN_THUMB_WIDTH=10;this._TLENGTH=this._w-3*this._BORDER;this._c=a.corners();this._opaque=!1}update(a,b){Number.isFinite(b)&&b!==this._used&&(this._used=b,this._minV=this._used/2,this._maxV=1-this._used/
2,this.invalidateBuffer());if(Number.isFinite(a)&&a!==this._value){b=a=this._p.constrain(a,0,1);let c=this._used/2;a<c?b=c:a>1-c&&(b=1-c);if(this._value!=a||this._dvalue!=b)this._value=a,this._dvalue=b,this.invalidateBuffer()}}getValue(){return this._value}getUsed(){return this._used}_whereOver(a,b,c=20){let d=this._h/2;return Math.abs(this._BORDER+this._dvalue*this._TLENGTH-a)<=Math.max(this._used*this._TLENGTH,this._MIN_THUMB_WIDTH)/2&&Math.abs(d-b)<=c/2?1:0}_processEvent(a,...b){b=b[0];switch(a.type){case "mousedown":case "touchstart":0<
this._over&&(this._active=!0,this._s_value=this._value,this._s_mx=b,this.invalidateBuffer());break;case "mouseout":case "mouseup":case "touchend":this._active&&(this.action({source:this,p5Event:a,value:this._value,used:this._used,final:!0}),this._active=!1,this.invalidateBuffer());break;case "mousemove":case "touchmove":this._active&&(this.update(this._s_value+(b-this._s_mx)/this._TLENGTH),this.action({source:this,p5Event:a,value:this._value,used:this._used,final:!1}),this.invalidateBuffer())}}_updateControlVisual(){let a=
this._scheme||this._gui.scheme();const b=a.C_3,c=a.G_8,d=a.G_3,e=a.C_9,f=a.C_5;let h=Math.max(this._used*this._TLENGTH,this._MIN_THUMB_WIDTH),g=this._THUMB_HEIGHT,l=this._dvalue*this._TLENGTH,p=this._uiBfr;p.push();p.clear();this._opaque&&(p.noStroke(),p.fill(b),p.rect(0,0,this._w,this._h,...this._c));p.translate(this._BORDER,p.height/2);p.fill(d);p.stroke(c);p.strokeWeight(1);p.rect(0,-this._THEIGHT/2,this._TLENGTH,this._THEIGHT);p.fill(f);p.noStroke();if(this._active||0<this._over)p.strokeWeight(2),
p.stroke(e);p.rect(l-h/2,-g/2,h,g,...this._c);this._enabled||this._disable_hightlight(p,a,0,-this._h/2,this._w-20,this._h);this._updateScrollerPickBuffer(l-h/2,-g/2,h,g);p.pop();this._bufferInvalid=!1}_updateScrollerPickBuffer(a,b,c,d){b=this._gui.pickColor(this);let e=this._pkBfr;e.push();e.clear();e.noStroke();e.fill(b.r,b.g,b.b);e.translate(this._BORDER,0);e.rect(Math.round(a),Math.round((e.height-d)/2),c,d);e.pop()}_minControlSize(){return{w:this._w,h:20}}}
Object.assign(CvsScroller.prototype,processMouse,processTouch);class CvsOptionGroup{constructor(a){this._name=a;this._group=new Set}add(a){if(a.isSelected())for(let b of this._group)b._deselect();this._group.add(a)}remove(a){this._group.delete(a)}_prev(){let a=void 0;for(let b of this._group)if(b.isSelected()){a=b;break}return a}}
class CvsOption extends CvsText{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||100,f||18);this._selected=!1;this._optGroup=null;this._textAlign=this._iconAlign=this._p.LEFT}iconAlign(a){if(!a)return this._iconAlign;if(a==this._p.LEFT||a==this._p.RIGHT)this._iconAlign=a,this.invalidateBuffer();return this}select(){let a=this._optGroup?._prev();a&&(a._selected=!1,a.invalidateBuffer());this._selected=!0;this.invalidateBuffer();return this}_deselect(){this._selected=!1;return this}isSelected(){return this._selected}group(a){this._optGroup=
this._gui.getOptionGroup(a);this._optGroup.add(this);return this}_processEvent(a,...b){switch(a.type){case "mousedown":case "touchstart":0<this._over&&(this._active=this._dragging=this._clickAllowed=!0,this.invalidateBuffer());break;case "mouseout":case "mouseup":case "touchend":this._active&&this._clickAllowed&&!this._selected&&this._optGroup&&(this.select(),this.action({source:this,p5Event:a,selected:!0}));this._over=0;this._active=this._dragging=this._clickAllowed=!1;this.invalidateBuffer();break;
case "mousemove":case "touchmove":this._clickAllowed=!1}}_updateControlVisual(){var a=this._textSize||this._gui.textSize();let b=this._scheme||this._gui.scheme(),c=this._p;var d=c.constrain(.7*Number(a),12,16),e=this._iconAlign;let f=this._textAlign,h=this._lines,g=this._gap;var l=b.C_3;const p=b.C_8;var k=b.G_0;const q=b.G_9,m=b.C_9;let n=this._uiBfr;n.push();n.clear();this._opaque&&(n.noStroke(),n.fill(l),n.rect(0,0,this._w,this._h,this._c[0],this._c[1],this._c[2],this._c[3]));n.push();n.translate(e==
c.RIGHT?this._w-g-d/2:g+d/2,n.height/2);n.stroke(q);n.fill(k);n.strokeWeight(1.5);n.ellipse(0,0,d,d);this._selected&&(n.fill(q),n.noStroke(),n.ellipse(0,0,d/2,d/2));n.pop();if(0<h.length){n.textSize(a);a=g;l=this._w-g;k=0;e==c.LEFT&&(a+=d+g);e==c.RIGHT&&(l-=d+g);d=l-a;e=this._tbox.h;e=n.textAscent()+(this._h-e)/2;n.fill(p);for(let r of h){switch(f){case c.LEFT:k=a;break;case c.CENTER:k=a+(d-n.textWidth(r))/2;break;case c.RIGHT:k=l-n.textWidth(r)-g}n.text(r,k,e);e+=n.textLeading()}}0<this._over&&(n.stroke(m),
n.strokeWeight(2),n.noFill(),n.rect(1,1,this._w-2,this._h-2,this._c[0],this._c[1],this._c[2],this._c[3]));this._enabled||this._disable_hightlight(n,b,0,0,this._w,this._h);this._updateRectControlPB();n.pop();this._bufferInvalid=!1}_minControlSize(){let a=this._uiBfr,b=this._lines,c=this._tbox,d=0;var e=0;e=this._gap;var f=this._textSize||this._gui.textSize();f=this._p.constrain(.7*Number(f),12,16);if(0<b.length){a||this._validateBuffer();let h=this._textSize||this._gui.textSize();a.textSize(h);c.w=
h+b.map(g=>a.textWidth(g)).reduce((g,l)=>g>l?g:l);c.h=(b.length-1)*a.textLeading()+a.textAscent()+a.textDescent()}d+=c.w+e+f;e=Math.max(this._tbox.h,f+e)+2*e;return{w:d,h:e}}}Object.assign(CvsOption.prototype,processMouse,processTouch);
class CvsCheckbox extends CvsText{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||80,f||18);this._selected=!1;this._textAlign=this._iconAlign=this._p.LEFT}iconAlign(a){if(!a)return this._iconAlign;if(a==this._p.LEFT||a==this._p.RIGHT)this._iconAlign=a,this.invalidateBuffer();return this}select(){this._selected||(this._selected=!0,this.invalidateBuffer());return this}deselect(){this._selected&&(this._selected=!1,this.invalidateBuffer());return this}isSelected(){return this._selected}_processEvent(a,
...b){switch(a.type){case "mousedown":case "touchstart":0<this._over&&(this._active=this._dragging=this._clickAllowed=!0,this.invalidateBuffer());break;case "mouseout":case "mouseup":case "touchend":this._active&&(this._clickAllowed&&(this._selected=!this._selected,this.action({source:this,p5Event:a,selected:this._selected})),this._over=0,this._active=this._dragging=this._clickAllowed=!1,this.invalidateBuffer());break;case "mousemove":case "touchmove":this._clickAllowed=!1}}_updateControlVisual(){var a=
this._textSize||this._gui.textSize();let b=this._scheme||this._gui.scheme(),c=this._p;var d=c.constrain(.7*Number(a),12,16),e=this._iconAlign;let f=this._textAlign,h=this._lines,g=this._gap;var l=b.C_3;const p=b.C_8;var k=b.G_0;const q=b.G_9,m=b.C_9;let n=this._uiBfr;n.push();n.clear();this._opaque&&(n.noStroke(),n.fill(l),n.rect(0,0,this._w,this._h,this._c[0],this._c[1],this._c[2],this._c[3]));n.push();n.translate(e==c.RIGHT?this._w-g-d/2:g+d/2,n.height/2);n.stroke(q);n.fill(k);n.strokeWeight(1.5);
n.rect(-d/2,-d/2,d,d,3);this._selected&&(n.strokeWeight(2.5),n.line(-.281*d,0,-.188*d,.313*d),n.line(.27*d,-.27*d,-.188*d,.313*d));n.pop();if(0<h.length){n.textSize(a);a=g;l=this._w-g;k=0;e==c.LEFT&&(a+=d+g);e==c.RIGHT&&(l-=d+g);d=l-a;e=this._tbox.h;e=n.textAscent()+(this._h-e)/2;n.fill(p);for(let r of h){switch(f){case c.LEFT:k=a;break;case c.CENTER:k=a+(d-n.textWidth(r))/2;break;case c.RIGHT:k=l-n.textWidth(r)-g}n.text(r,k,e);e+=n.textLeading()}}0<this._over&&(n.stroke(m),n.strokeWeight(2),n.noFill(),
n.rect(1,1,this._w-2,this._h-2,this._c[0],this._c[1],this._c[2],this._c[3]));this._enabled||this._disable_hightlight(n,b,0,0,this._w,this._h);this._updateRectControlPB();n.pop();this._bufferInvalid=!1}_minControlSize(){let a=this._uiBfr,b=this._lines,c=this._tbox,d=0;var e=0;e=this._gap;var f=this._textSize||this._gui.textSize();f=this._p.constrain(.7*Number(f),12,16);if(0<b.length){a||this._validateBuffer();let h=this._textSize||this._gui.textSize();a.textSize(h);c.w=h+b.map(g=>a.textWidth(g)).reduce((g,
l)=>g>l?g:l);c.h=(b.length-1)*a.textLeading()+a.textAscent()+a.textDescent()}d+=c.w+e+f;e=Math.max(this._tbox.h,f+e)+2*e;return{w:d,h:e}}}Object.assign(CvsCheckbox.prototype,processMouse,processTouch);
class CvsViewer extends CvsBufferedControl{constructor(a,b,c,d,e,f){super(a,b,c,d,e,f);this._layers=[];this._hidden=new Set;this._wcy=this._wcx=this._lh=this._lw=0;this._wscale=1;this._frameWeight=this._usedY=this._usedX=0;this._scrH=a.__scroller(this._id+"-scrH",0,f-20,e,20).hide().setAction(h=>{this.view(h.value*this._lw,this._wcy);this.invalidateBuffer()});this._scrV=a.__scroller(this._id+"-scrV",e-20,0,f,20).orient("south").hide().setAction(h=>{this.view(this._wcx,h.value*this._lh);this.invalidateBuffer()});
this.addChild(this._scrH);this.addChild(this._scrV)}scaler(a,b,c){if(Number.isFinite(a)&&Number.isFinite(b)&&Number.isFinite(c)){let d=Math.min(b,c);b=Math.max(b,c);a=this._p.constrain(a,d,b);this._scaler||(this._scaler=this._gui.slider(this._id+"-scaler",.25*this._w,.5*this._h-10,.5*this._w,20).hide().setAction(e=>{this.scale(e.value);this.invalidateBuffer()}),this.addChild(this._scaler));this._scaler.limits(d,b);this._scaler.value(a);this._wscale=a;0<this._lw&&0<this._lh&&(this._wcx=this._lw*this._scrH.getValue(),
this._wcy=this._lh*this._scrV.getValue(),this.invalidateBuffer())}return this}scale(a){if(!Number.isFinite(a))return this._wscale;this._scaler&&this._scaler.value(a);this._wscale=a;this.view(this._wcx,this._wcy,this._wscale);this.invalidateBuffer();return this}status(){return{cX:this._wcx,cY:this._wcy,scale:this._wscale}}hide(){return super.hide(!0)}show(){return super.show(!0)}hideLayer(a){Number.isInteger(a)&&0<=a&&a<this._layers.length&&!this._hidden.has(a)&&(this._hidden.add(a),this.invalidateBuffer());
return this}showLayer(a){Number.isInteger(a)&&0<=a&&a<this._layers.length&&this._hidden.has(a)&&(this._hidden.delete(a),this.invalidateBuffer());return this}view(a,b,c){if(Number.isFinite(a)&&Number.isFinite(b)){if(this._neq(this._wcx,a)||this._neq(this._wcy,b))this._wcx=this._p.constrain(a,0,this._lw),this._wcy=this._p.constrain(b,0,this._lh),this._scrH.update(a/this._lw),this._scrV.update(b/this._lh),this.invalidateBuffer();this._neq(this._wscale,c)&&(this._wscale=c,this._scaler&&this._scaler.value(c),
this.invalidateBuffer());this.action({source:this,p5Event:void 0,cX:this._wcx,cY:this._wcy,scale:this._wscale})}return this}layers(a){Array.isArray(a)?this._layers=Array.from(a):this._layers[0]=a;a=this._lw=this._layers[0].width;let b=this._lh=this._layers[0].height;for(let c=1;c<this._layers[c];c++){let d=this._layers[c];d.width==a&&d.height==b||d.resize(a,b)}this._wcx=this._scrH.getValue()*this._lw;this._wcy=this._scrV.getValue()*this._lh;this.invalidateBuffer();return this}frame(a=0){this._frameWeight=
0>a?0:a;return this}_whereOver(a,b){if(a>this._w-20&&a<this._w&&0<b&&b<this._h-20||0<a&&a<this._w-20&&b>this._h-20&&b<this._h)return 3;let c=this._w,d=this._h;return this._scaler&&a>.2*c&&a<.8*c&&b>.35*d&&b<.65*d?2:0<a&&a<c&&0<b&&b<d?1:0}_handleMouse(a){var b=this.getAbsXY();let c=this._p.mouseX-b.x;b=this._p.mouseY-b.y;this._pover=this._over;this._over=this._whereOver(c,b);this._bufferInvalid=this._bufferInvalid||this._pover!=this._over;this._tooltip&&this._tooltip._updateState(this,this._pover,
this._over);this._scaler&&(2==this._over?this._scaler.show():this._scaler.hide());1<=this._over?(1>this._scrH.getUsed()?this._scrH.show():this._scrH.hide(),1>this._scrV.getUsed()?this._scrV.show():this._scrV.hide()):(this._scrH.hide(),this._scrV.hide());this._processEvent(a,c,b);return!1}_handleTouch(a){a.preventDefault();var b=this.getAbsXY();const c=this._gui._canvas.getBoundingClientRect(),d=a.changedTouches[0];let e=d.clientX-c.left-b.x;b=d.clientY-c.top-b.y;this._pover=this._over;this._over=
this._whereOver(e,b);this._bufferInvalid=this._bufferInvalid||this._pover!=this._over;this._tooltip&&this._tooltip._updateState(this,this._pover,this._over);this._scaler&&(2==this._over?this._scaler.show():this._scaler.hide());1<=this._over?(1>this._scrH.getUsed()?this._scrH.show():this._scrH.hide(),1>this._scrV.getUsed()?this._scrV.show():this._scrV.hide()):(this._scrH.hide(),this._scrV.hide());this._processEvent(a,e,b)}_processEvent(a,...b){let c=b[0];b=b[1];switch(a.type){case "mousedown":case "touchstart":1==
this._over&&(this._clickAllowed=!1,this._active=this._dragging=!0,this.invalidateBuffer(),this._mx0=this._pmx=c,this._my0=this._pmy=b,this._dcx=this._wcx,this._dcy=this._wcy);break;case "mouseout":this._scrH.hide(),this._scrV.hide(),this._active&&(this._over=0,this._clickAllowed=!1);case "mouseup":case "touchend":this._active&&(this._active=this._dragging=!1,this.invalidateBuffer());break;case "mousemove":case "touchmove":this._active&&this._dragging&&(this._scaler&&this._scaler.hide(),this._validateMouseDrag(this._dcx+
(this._mx0-c)/this._wscale,this._dcy+(this._my0-b)/this._wscale))}}_validateMouseDrag(a,b){let c=Math.round(.5*this._w/this._wscale);var d=Math.round(.5*this._h/this._wscale);let e=this._wcx+c;var f=this._wcy+d;f=0>this._wcy-d&&f>this._lh;let h=a-c,g=a+c,l=b-d;d=b+d;0>this._wcx-c&&e>this._lw||0>h&&g>this._lw?a=this._lw/2:this._xor(0>h,g>this._lw)&&(a=0>h?a-h:a+(this._lw-g));f||0>l&&d>this._lh?b=this._lh/2:this._xor(0>l,d>this._lh)&&(b=0>l?b-l:b+(this._lh-d));this.view(a,b);this.invalidateBuffer()}_xor(a,
b){return(a||b)&&!(a&&b)}_updateControlVisual(){var a=this._scheme||this._gui.scheme();let b=this._wscale;var c=this._wcx,d=this._wcy,e=a.C_2;a=a.C_7;let f=this._uiBfr;f.push();this._opaque?f.background(e):f.clear();e=Math.round(.5*this._w/b);let h=Math.round(.5*this._h/b);c=this._overlap(0,0,this._lw,this._lh,c-e,d-h,c+e,d+h);let [g,l]=[Math.round(c.offsetX*b),Math.round(c.offsetY*b)],[p,k]=[Math.round(c.width*b),Math.round(c.height*b)];if(c.valid)for(let q=0,m=this._layers.length;q<m;q++)!this._hidden.has(q)&&
this._layers[q]&&(d=this._layers[q].get(c.left,c.top,c.width,c.height),.01<Math.abs(b-1)&&d.resize(p,k),f.image(d,c.offsetX*b,c.offsetY*b,d.width,d.height));0<this._frameWeight&&(f.noFill(),f.stroke(a),f.strokeWeight(this._frameWeight),f.rect(0,0,f.width,f.height));this._updateViewerPickBuffer(g,l,p,k);f.pop()}_updateViewerPickBuffer(a,b,c,d){let e=this._gui.pickColor(this),f=this._pkBfr;f.push();f.clear();f.noStroke();f.fill(e.r,e.g,e.b);f.rect(a,b,c,d);f.pop()}_overlap(a,b,c,d,e,f,h,g){var l=Math.min(b,
d);b=Math.max(b,d);d=Math.min(a,c);c=Math.max(a,c);a=Math.min(f,g);g=Math.max(f,g);f=Math.min(e,h);h=Math.max(e,h);if(b<=a||g<=l||c<=f||h<=d)return{valid:!1};e=d<f?f:d;h=c>h?h:c;b=b>g?g:b;l=l<a?a:l;d=h-e;g=b-l;f=e-f;a=l-a;this._scrH.update(void 0,d/this._lw);this._scrV.update(void 0,g/this._lh);return{valid:!0,left:e,right:h,top:l,bottom:b,width:d,height:g,offsetX:f,offsetY:a}}shrink(a){console.warn("Cannot change 'shrink' a viewer");return this}orient(a){console.warn(`Cannot change orientation of a viewer to ${a}`);
return this}_minControlSize(){return{w:this._w,h:this._h}}}
class CvsTextField extends CvsText{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||80,f||16);this._currCsrIdx=this._prevCsrIdx=this._linkOffset=0;this._cursorOn=this._textInvalid=!1;this.textAlign(this._p.LEFT);this._c=[0,0,0,0]}index(a,b){Number.isFinite(a)&&(Number.isFinite(b)&&(this._linkOffset=b),this._linkIndex=a,this._gui._links||(this._gui._links=new Map),this._gui._links.set(a,this));return this}text(a){if(null==a||void 0==a)return this._getLine();this._textInvalid=!1;for(a=a.toString().replaceAll("\n",
" ");0<a.length&&this._uiBfr.textWidth(a)>=this._maxTextWidthPixels();)a=a.substring(0,a.length-1);this._lines=[a];this.validate();this.invalidateBuffer();return this}textSize(a){let b=this._textSize||this._gui.textSize();if(!Number.isFinite(a))return b;a=Number(a);a!=b&&(this._textSize=a,this.invalidateBuffer());return this}noIndex(){Number.isFinite(this._linkIndex)&&!this._gui._links&&this._gui._links.delete(this._linkIndex);this._linkIndex=void 0;return this}isValid(){return!this._textInvalid}hasValidText(){return!this._textInvalid&&
0<this._lines.length&&0<this._lines[0].length}clearValid(){this._textInvalid&&(this._textInvalid=!1,this.invalidateBuffer());return this}validation(a){this._validation=a;return this}validate(){this._validate();return this}_validate(){if(this._validation){var a=this._getLine();a=this._validation(a);Array.isArray(a)&&0<a.length&&(this._textInvalid=!a[0],a[1]&&(this._uiBfr.textWidth(a[1])<this._maxTextWidthPixels()?this._lines[0]=a[1]:this._textInvalid=!0))}}_activate(a=!1){this._active=!0;let b=this._getLine();
this._currCsrIdx=b.length;this._prevCsrIdx=a||this._textInvalid?0:b.length;this._cursorOn=!0;this._clock=setInterval(()=>{this._cursorOn=!this._cursorOn;this.invalidateBuffer()},550);this.invalidateBuffer()}_activateNext(a){this._deactivate();this._validate();let b=this._gui._links;if(b){let c=this._linkIndex,d;do c+=a,d=b.get(c);while(d&&(!d.isEnabled()||!d.isVisible()));d?._activate()}}_deactivate(){this._cursorOn=this._active=!1;clearInterval(this._clock);this.invalidateBuffer()}_getLine(){return 0<
this._lines.length?this._lines[0]:""}_cursorX(a,b,c){return 0==c?0:a.textWidth(b.substring(0,c))}_processEvent(a,...b){switch(a.type){case "mousedown":0<this._over&&this._activate()}}_maxTextWidthPixels(){let a=Number(this._textSize||this._gui.textSize());return this._w-2*this._gap-a/2}_handleKey(a){let b=this._maxTextWidthPixels(),c=this._getLine(),d=this._prevCsrIdx!=this._currCsrIdx,e=!(!this._linkIndex||d||0!=this._currCsrIdx),f=!!(this._linkIndex&&!d&&this._currCsrIdx>=c.length);if("keydown"==
a.type){if(1==a.key.length)return this._prevCsrIdx!=this._currCsrIdx&&(c=this._removeSelectedText(c)),c=c.substring(0,this._currCsrIdx)+a.key+c.substring(this._currCsrIdx),this._uiBfr.textWidth(c)<b&&(this._currCsrIdx++,this._prevCsrIdx++,this._lines[0]=c),this.invalidateBuffer(),!0;switch(a.key){case "ArrowLeft":e?(this._activateNext(-1),this.action({source:this,p5Event:a,value:c})):0<this._currCsrIdx&&(!a.shiftKey&&d?this._currCsrIdx=Math.min(this._currCsrIdx,this._prevCsrIdx):this._currCsrIdx--,
a.shiftKey||(this._prevCsrIdx=this._currCsrIdx));break;case "ArrowRight":f?(this._activateNext(1),this.action({source:this,p5Event:a,value:c})):this._currCsrIdx<=c.length&&(!a.shiftKey&&d?this._currCsrIdx=Math.max(this._currCsrIdx,this._prevCsrIdx):this._currCsrIdx++,a.shiftKey||(this._prevCsrIdx=this._currCsrIdx));break;case "ArrowUp":d||(0!==this._linkOffset&&this._activateNext(-this._linkOffset),this.action({source:this,p5Event:a,value:c}));break;case "ArrowDown":d||(0!==this._linkOffset&&this._activateNext(this._linkOffset),
this.action({source:this,p5Event:a,value:c}));break;case "Enter":this._deactivate();this._validate();this.action({source:this,p5Event:a,value:c});break;case "Backspace":this._prevCsrIdx!=this._currCsrIdx?c=this._removeSelectedText(c):0<this._currCsrIdx&&(c=c.substring(0,this._currCsrIdx-1)+c.substring(this._currCsrIdx),this._currCsrIdx--,this._prevCsrIdx=this._currCsrIdx);this._lines[0]=c;break;case "Delete":this._prevCsrIdx!=this._currCsrIdx?c=this._removeSelectedText(c):this._currCsrIdx<c.length&&
(c=c.substring(0,this._currCsrIdx)+c.substring(this._currCsrIdx+1)),this._lines[0]=c}this.invalidateBuffer();return!1}return!0}_removeSelectedText(a){let b=Math.min(this._prevCsrIdx,this._currCsrIdx),c=Math.max(this._prevCsrIdx,this._currCsrIdx);this._prevCsrIdx=this._currCsrIdx=b;return a.substring(0,b)+a.substring(c)}_updateControlVisual(){var a=Number(this._textSize||this._gui.textSize());let b=this._scheme||this._gui.scheme(),c=0<this._lines.length?this._lines[0]:"";var d=this._textInvalid;let e=
2*this._gap;const f=b.G_9,h=b.C_9,g=b.C_3;let l=b.C_1,p=b.C_9,k=this._uiBfr;k.push();k.textSize(a);k.background(b.G_0);k.noStroke();if(!this._active)l=d?b.C_9:b.C_1,p=d?b.C_3:b.C_9,k.stroke(p),k.strokeWeight(1.5),k.fill(l),k.rect(0,0,this._w,this._h);else if(this._currCsrIdx!=this._prevCsrIdx){d=this._cursorX(k,c,this._prevCsrIdx);let q=this._cursorX(k,c,this._currCsrIdx);k.noStroke();k.fill(g);k.rect(e+Math.min(d,q),1,Math.abs(d-q),this._h-2)}k.fill(l);k.textSize(a);k.textAlign(this._p.LEFT,this._p.TOP);
k.noStroke();k.fill(p);k.text(c,e,(this._h-a)/2);this._activate&&this._cursorOn&&(a=this._cursorX(k,c,this._currCsrIdx),k.stroke(f),k.strokeWeight(1.5),k.line(e+a,4,e+a,this._h-5));0<this._over&&(k.stroke(h),k.strokeWeight(2),k.noFill(),k.rect(1,1,this._w-2,this._h-2,this._c[0],this._c[1],this._c[2],this._c[3]));this._enabled||this._disable_hightlight(k,b,0,0,this._w,this._h);this._updateRectControlPB();k.pop();this._bufferInvalid=!1}}Object.assign(CvsTextField.prototype,processMouse,processTouch);
class CvsJoystick extends CvsBufferedControl{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||40,f||40);this._size=Math.min(e,f);this._pr0=.05*this._size;this._pr1=.4*this._size;this._tSize=Math.max(.075*this._size,6);this._mode="X0";this._ang=this._mag=0;this._opaque=!1;this._tmrID=void 0}mode(a){if(!a)return this._mode;a=a.toUpperCase();switch(a){case "X0":case "X4":case "X8":this._mode!=a&&(this._mode=a,this.invalidateBuffer())}return this}thumbSize(a){this._tSize=a;return this}_whereOver(a,b,c=
this._tSize){a-=this._w/2;b-=this._h/2;let [d,e]=this._getThumbXY();return Math.abs(d-a)<=c&&Math.abs(e-b)<=c?1:0}_getThumbXY(){return[this._mag*Math.cos(this._ang),this._mag*Math.sin(this._ang)]}_validateThumbPosition(a,b){let c=this._p.constrain(Math.sqrt(a*a+b*b),0,this._pr1);a=Math.atan2(b,a);a+=0>a?2*Math.PI:0;b=c<=this._pr0;let d=-1,e;switch(this._mode){case "X4":e=Math.PI/2;d=Math.floor((a+e/2)/e)%4;a=e*d;d*=2;break;case "X8":e=Math.PI/4,d=Math.floor((a+e/2)/e)%8,a=e*d}[this._mag,this._ang,
this._dir,this._dead]=[c,a,d,b]}_processEvent(a,...b){function c(e,f,h){return{source:e,p5Event:f,final:h,mag:(e._mag-e._pr0)/(e._pr1-e._pr0),angle:e._ang,dir:e._dir,dead:e._dead}}let d=b[0];b=b[1];d-=this._w/2;b-=this._h/2;switch(a.type){case "mousedown":case "touchstart":0<this._over&&(this._active=!0,this.invalidateBuffer());break;case "mouseout":case "mouseup":case "touchend":this._active&&(this._validateThumbPosition(d,b),this.action(c(this,a,!0)),this._active=!1,this.invalidateBuffer(),this._tmrID||
(this._tmrID=setInterval(()=>{this._mag-=.07*this._size;0>=this._mag&&(clearInterval(this._tmrID),this._tmrID=void 0,this._mag=0);this.invalidateBuffer()},25)));break;case "mousemove":case "touchmove":this._active&&(this._validateThumbPosition(d,b),this.action(c(this,a,!1)),this.invalidateBuffer())}}_updateControlVisual(){var a=this._scheme||this._gui.scheme();let [b,c]=[this._mag*Math.cos(this._ang),this._mag*Math.sin(this._ang)];var d=a.C_3,e=a.C_1,f=a.T_0;const h=a.C_9,g=a.C_9,l=a.C_4,p=a.C_6,
k=a.C_7;var q=a.C_8;a=a.T_5;let m=this._uiBfr;m.push();m.clear();this._opaque&&(m.noStroke(),m.fill(d),m.rect(0,0,this._w,this._h,this._c[0],this._c[1],this._c[2],this._c[3]));m.translate(m.width/2,m.height/2);m.noStroke();m.fill(e);m.ellipse(0,0,2*this._pr1,2*this._pr1);d=.26*this._size;m.fill(f);m.noStroke();m.ellipse(0,0,2*d,2*d);m.ellipse(0,0,1.25*d,1.25*d);m.stroke(q);switch(this._mode){case "X0":f=this._pr1;q=Math.PI/8;m.push();m.strokeWeight(.75);d=.3*this._size;for(e=0;16>e;e++)m.line(f,0,
d,0),m.rotate(q);m.pop();break;case "X8":f=this._pr0;d=.33*this._size;q=Math.PI/4;m.push();m.strokeWeight(1);for(e=0;8>e;e++)m.line(f,0,d,0),m.rotate(q);m.pop();case "X4":f=this._pr0;d=this._pr1;q=Math.PI/2;m.push();m.strokeWeight(1.5);for(e=0;4>e;e++)m.line(f,0,d,0),m.rotate(q);m.pop()}m.stroke(h);m.strokeWeight(Math.max(3,.025*this._size));m.noFill();m.ellipse(0,0,2*this._pr1,2*this._pr1);m.fill(a);m.noStroke();m.ellipse(0,0,2*this._pr0,2*this._pr0);m.stroke(k);m.strokeWeight(.05*this._size);m.line(0,
0,b,c);m.strokeWeight(2);m.stroke(g);this._active||0<this._over?m.fill(p):m.fill(l);m.ellipse(b,c,2*this._tSize,2*this._tSize);this._updateJoystickPickBuffer(b,c,this._tSize);m.pop();this._bufferInvalid=!1}_updateJoystickPickBuffer(a,b,c){let d=this._gui.pickColor(this),e=this._pkBfr;e.push();e.clear();e.translate(e.width/2,e.height/2);e.noStroke();e.fill(d.r,d.g,d.b);e.ellipse(a,b,2*c,2*c);e.pop()}}Object.assign(CvsJoystick.prototype,processMouse,processTouch);
class CvsKnob extends CvsSlider{constructor(a,b,c,d,e,f){super(a,b,c||0,d||0,e||40,f||40);this._mode=CvsKnob.X_MODE;this._sensitivity=.005;this._size=Math.min(e,f);this._turnArc=2*Math.PI;this._gapPos=.5*Math.PI;this._tw=0;this._kRad=.5*this._size;this._gRad=this._kRad-4;this._opaque=!0}mode(a){switch(a){case "x":this._mode=CvsKnob.X_MODE;break;case "y":this._mode=CvsKnob.Y_MODE;break;case "a":this._mode=CvsKnob.A_MODE}return this}sensitivity(a){if(0!=a){let b=Math.abs(a);this._sensitivity=(0>a?-1:
1)*(.0025>b?.0025:b)}return this}track(a){a=this._p.constrain(a,6,this._kRad);this._gRad=this._kRad-a;this._tw=a;this.invalidateBuffer();return this}turnAngle(a){0<a&&360>=a&&(this._turnArc=this._p.radians(a),this.invalidateBuffer());return this}gap(a){0<=a&&360>=a&&(this._gapPos=this._p.radians(a),this.invalidateBuffer());return this}_tFromXY(a,b){function c(g){return 0>g?g+2*Math.PI:g}var d=this._p.constrain,e=this._t01;let f=!1,h=!1;switch(this._mode){case CvsKnob.X_MODE:e=this._t01+(a-this._prevX)*
this._sensitivity;f=0>e;h=1<e;e=d(e,0,1);break;case CvsKnob.Y_MODE:e=this._t01-(b-this._prevY)*this._sensitivity;f=0>e;h=1<e;e=d(e,0,1);break;case CvsKnob.A_MODE:d=Math.PI-this._turnArc/2,e=2*Math.PI-d,a=c(Math.atan2(b,a)),a=c(a-this._gapPos),f=a<d,h=a>e,e=this._p.map(a,d,e,0,1,!0)}return{t:e,under:f,over:h}}_processEvent(a,...b){let [c,d]=b;c-=this._w/2;d-=this._h/2;switch(a.type){case "mousedown":case "touchstart":0<this._over&&(this._prevX=c,this._prevY=d,this._active=!0,this.invalidateBuffer());
break;case "mouseout":case "mouseup":case "touchend":this._active&&(b=this._tFromXY(c,d),this._t01=this._s2ticks?this._nearestTickT(b.t):b.t,this.action({source:this,p5Event:a,value:this.value(),final:!0}),this._active=!1,this.invalidateBuffer());break;case "mousemove":case "touchmove":this._active&&(b=this._tFromXY(c,d),b=this._s2ticks?this._nearestTickT(b.t):b.t,this._t01!=b&&(this._prevX=c,this._prevY=d,this._t01=b,this.action({source:this,p5Event:a,value:this.value(),final:!1}),this.invalidateBuffer()))}}_whereOver(a,
b,c=0){a-=this._w/2;b-=this._h/2;c=this._kRad+c;return a*a+b*b<=c*c?1:0}_updateControlVisual(){var a=this._scheme||this._gui.scheme(),b=a.C_3,c=a.C_7;const d=a.C_8,e=a.C_3,f=a.C_9;var h=a.C_3,g=a.C_1,l=a.G_8;const p=a.G_2,k=a.T_1;a=this._uiBfr;a.clear();this._opaque&&(a.noStroke(),a.fill(b),a.rect(0,0,this._w,this._h,this._c[0],this._c[1],this._c[2],this._c[3]));b=this._turnArc;var q=(2*Math.PI-b)/2;let m=this._gRad,n=2*this._kRad,r=2*m;a.push();a.translate(a.width/2,a.height/2);a.rotate(this._gapPos+
q);a.noStroke();a.fill(h);a.ellipse(0,0,n,n);a.fill(g);a.arc(0,0,n,n,0,this._turnArc);h=this._majorTicks*this._minorTicks;if(2<=h){g=this._tw;q=.65*g;a.stroke(l);l=b/h;a.push();a.strokeWeight(.9);for(let t=0;t<=h;t++)a.line(m,0,m+q,0),a.rotate(l);a.pop();h=this._majorTicks;if(2<=h){l=b/h;a.push();a.strokeWeight(1);for(q=0;q<=h;q++)a.line(m,0,m+g,0),a.rotate(l);a.pop()}a.noStroke();a.fill(k);a.arc(0,0,r+g,r+g,0,b);a.fill(p);a.arc(0,0,r+g,r+g,0,this._t01*b)}a.stroke(d);a.strokeWeight(1.5);a.fill(c);
a.ellipse(0,0,r,r);a.push();a.rotate(this._t01*b);c=.2*m;a.fill(e);a.noStroke();a.beginShape();a.vertex(-c,0);a.vertex(0,-c);a.vertex(m,0);a.vertex(0,c);a.endShape(this._p.CLOSE);a.pop();if(this._over||this._active)a.noFill(),a.stroke(f),a.strokeWeight(3),a.arc(0,0,2*this._kRad,2*this._kRad,0,b);this._updateKnobPickBuffer(n);a.pop();this._bufferInvalid=!1}_updateKnobPickBuffer(a){let b=this._gui.pickColor(this),c=this._pkBfr;c.push();c.clear();c.translate(c.width/2,c.height/2);c.noStroke();c.fill(b.r,
b.g,b.b);c.ellipse(0,0,a,a);c.pop()}_minControlSize(){return{w:this._size,h:this._size}}}CvsKnob.X_MODE=1;CvsKnob.Y_MODE=2;CvsKnob.A_MODE=3;Object.assign(CvsKnob.prototype,processMouse,processTouch);
class CvsPane extends CvsBaseControl{constructor(a,b,c,d,e,f){super(a,b,c,d,e,f);this._background="rgba(0,0,0,0.6)";this._x=c;this._y=d;this._w=e;this._h=f;this._cornerRadius=5;this._status="closed";this._timer=0;this._z=8192}parent(a,b,c){console.warn("Panes cannot have a parent")}leaveParent(){console.warn("Panes cannot have a parent")}depth(){return this._depth}background(a){switch(a){case "dark":this._background="rgba(0,0,0,0.6)";break;case "light":this._background="rgba(255,255,255,0.6)";break;
default:this._background=a}return this}close(){switch(this._status){case "opening":clearInterval(this._timer);case "open":this._timer=setInterval(()=>{this._closing()},CvsPane._dI),this._status="closing",this.action({source:this,p5Event:void 0,state:"closed"})}return this}isClosed(){return"closed"==this._status}isClosing(){return"closing"==this._status}open(){switch(this._status){case "closing":clearInterval(this._timer);case "closed":this._gui._closePanes(),this._timer=setInterval(()=>{this._opening()},
CvsPane._dI),this._status="opening",this.action({source:this,p5Event:void 0,state:"open"})}}isOpen(){return"open"==this._status}isOpening(){return"opening"==this._status}_tabAction(a){a=a.source._parent;switch(a._status){case "open":a.close();break;case "closed":a.open()}}_draw(a,b){a.push();a.translate(this._x,this._y);b.push();b.drawingContext.setTransform(a.drawingContext.getTransform());if(this._visible&&"closed"!=this._tabstate){a.noStroke();a.fill(this._background);a.rect(0,0,this._w,this._h);
b.noStroke();b.fill(255,0,0);b.rect(0,0,this._w,this._h);for(let c of this._children)c._visible&&c._draw(a,b)}b.pop();a.pop()}text(a,b){this.tab().text(a,b);return this}noText(){this.tab().noText();return this}icon(a,b){this.tab().icon(a,b);return this}noIcon(){this.tab().noIcon();return this}textSize(a){this.tab().textSize(a);return this}shrink(a){return this.tab().shrink()}isActive(){return this.tab()._active}opaque(a){console.warn("This method is not applicable to a pane");return this}transparent(a){console.warn("This methis is not applicable to a pane");
return this}orient(a){console.warn("Cannot change orientation of a pane}");return this}tab(){return this._children[0]}enable(){this.tab().enable();return this}disable(){this.close();this.tab().disable();return this}hide(){this.close();this.tab().hide();return this}show(){this.tab().show();return this}_minControlSize(){return{w:this._w,h:this._h}}}CvsPane._dI=50;CvsPane._dC=60;CvsPane._dO=40;CvsPane._wExtra=20;CvsPane._tabID=1;
class CvsPaneNorth extends CvsPane{constructor(a,b,c){super(a,b,0,-c,a.canvasWidth(),c);this._depth=c;this._status="closed";b=this._tab=this._gui.button("Tab "+CvsPane._tabID++);b.text(b.id).setAction(this._tabAction);c=b._minControlSize();b._w=c.w+CvsPane._wExtra;b._c=[0,0,this._cornerRadius,this._cornerRadius];this.addChild(b);a._panesNorth.push(this);this._gui.validateTabsNorth()}_opening(){let a=this._y+CvsPane._dO;0<a&&(a=0,clearInterval(this._timer),this._status="open");this._y=a}_closing(){let a=
this._y-CvsPane._dC;a<-this._depth&&(a=-this._depth,clearInterval(this._timer),this._status="closed");this._y=a}validateTabs(){this._gui.validateTabsNorth();return this}}
class CvsPaneSouth extends CvsPane{constructor(a,b,c){super(a,b,0,a.canvasHeight(),a.canvasWidth(),c);this._depth=c;this._status="closed";a=this._tab=this._gui.button("Tab "+CvsPane._tabID++);a.text(a.id).setAction(this._tabAction);b=a._minControlSize();a._w=b.w+CvsPane._wExtra;a._c=[this._cornerRadius,this._cornerRadius,0,0];this.addChild(a);this._gui._panesSouth.push(this);this._gui.validateTabsSouth()}_opening(){let a=this._y-CvsPane._dO;a<this._gui.canvasHeight()-this._depth&&(a=this._gui.canvasHeight()-
this._depth,clearInterval(this._timer),this._status="open");this._y=a}_closing(){let a=this._y+CvsPane._dC;a>this._gui.canvasHeight()&&(a=this._gui.canvasHeight(),clearInterval(this._timer),this._status="closed");this._y=a}validateTabs(){this._gui.validateTabsSouth();return this}}
class CvsPaneEast extends CvsPane{constructor(a,b,c){super(a,b,a.canvasWidth(),0,c,a.canvasHeight());this._depth=c;this._status="closed";a=this._tab=this._gui.button("Tab "+CvsPane._tabID++);a.text(a.id).orient("north").setAction(this._tabAction);b=a._minControlSize();a._w=b.w+CvsPane._wExtra;a._c=[this._cornerRadius,this._cornerRadius,0,0];this.addChild(a);this._gui._panesEast.push(this);this._gui.validateTabsEast()}_opening(){let a=this._x-CvsPane._dO;a<this._gui.canvasWidth()-this._depth&&(a=this._gui.canvasWidth()-
this._depth,clearInterval(this._timer),this._status="open");this._x=a}_closing(){let a=this._x+CvsPane._dC;a>this._gui.canvasWidth()&&(a=this._gui.canvasWidth(),clearInterval(this._timer),this._status="closed");this._x=a}validateTabs(){this._gui.validateTabsEast();return this}}
class CvsPaneWest extends CvsPane{constructor(a,b,c){super(a,b,-c,0,c,a.canvasHeight());this._depth=c;this._status="closed";a=this._tab=this._gui.button("Tab "+CvsPane._tabID++);a.text(a.id).orient("south").setAction(this._tabAction);b=a._minControlSize();a._w=b.w+CvsPane._wExtra;a._c=[this._cornerRadius,this._cornerRadius,0,0];this.addChild(a);this._gui._panesWest.push(this);this._gui.validateTabsWest()}_opening(){let a=this._x+CvsPane._dO;0<a&&(a=0,clearInterval(this._timer),this._status="open");
this._x=a}_closing(){let a=this._x-CvsPane._dC;a<-this._depth&&(a=-this._depth,clearInterval(this._timer),this._status="closed");this._x=a}validateTabs(){this._gui.validateTabsWest();return this}}
class GridLayout{constructor(a,b,c,d){this._h=this._w=this._y=this._x=0;this._iy=this._ix=2;this._x=Math.round(a);this._y=Math.round(b);this._w=Math.round(c);this._h=Math.round(d);this._iy=this._ix=2;this._cx=[0,1];this._cy=[0,1]}get x(){return this._x}get y(){return this._y}get w(){return this._w}get h(){return this._h}get nbrCols(){return this._cx.length-1}get nbrRows(){return this._cy.length-1}get intPxlCols(){return this._cx.map(a=>Math.round(a*this._w))}get extPxlCols(){return this._cx.map(a=>
this._x+Math.round(a*this._w))}get normCols(){return[...this._cx]}get intPxlRows(){return this._cy.map(a=>Math.round(a*this._h))}get extPxlRows(){return this._cy.map(a=>this._y+Math.round(a*this._h))}get normRows(){return[...this._cy]}xy(a,b){this._x=Math.round(a);this._y=Math.round(b);return this}wh(a,b){this._w=Math.round(a);this._h=Math.round(b);return this}cols(a){a=this._makeNormArray(a);0<a.length&&(this._cx=a);return this}rows(a){a=this._makeNormArray(a);0<a.length&&(this._cy=a);return this}size(a,
b){this.cols(a);this.rows(b);return this}cell(a,b,c=1,d=1){return this._calcRect(a,b,c,d,this._ix,this._iy)}border(a,b,c=1,d=1){return this._calcRect(a,b,c,d)}insets(a=2,b=2){this._ix=Math.round(a);this._iy=Math.round(b);return this}_calcRect(a,b,c,d,e=0,f=0){[a,b,c,d]=this._validateCellPositions(a,b,c,d);return[Math.round(this._cx[a]*this._w+this._x+e),Math.round(this._cy[b]*this._h+this._y+f),Math.round((this._cx[a+c]-this._cx[a])*this._w-2*e),Math.round((this._cy[b+d]-this._cy[b])*this._h-2*f)]}_validateCellPositions(a,
b,c=1,d=1){function e(f,h,g){return f<h?h:f>g?g:f}a=e(a,0,this._cx.length-2);b=e(b,0,this._cy.length-2);c=e(c,1,this._cx.length-a-1);d=e(d,1,this._cy.length-b-1);return[a,b,c,d]}_makeNormArray(a){let b=[],c=[0];if(Array.isArray(a)){if(0<a.length){let e=0;a.forEach(f=>e+=f);a.forEach(f=>b.push(f/e))}}else for(let e=0;e<a;e++)b.push(1/a);let d=0;b.forEach(e=>c.push(d+=e));return c}};
